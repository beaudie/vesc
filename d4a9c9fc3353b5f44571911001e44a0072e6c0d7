{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "1ec06f61_4f6979de",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-11-06T18:45:06Z",
      "side": 1,
      "message": "Comparing the 2 approaches shows that restoring the CWD doesn\u0027t always work correctly.   In particular, it can no longer find libvk_swiftshader.so or libVkLayer_khronos_validation.so when restoring the CWD.\n\nI\u0027ll leave it up to you guys to decide which you like better before landing this.\n\n[[[ Patchset 3: (rebuild absolute path) ]]]\n\nBacktrace:\nangle::PrintStackBacktrace() at crash_handler_posix.cpp:119\nangle::Handler(int) at crash_handler_posix.cpp:237\n__restore_rt at sigaction.c:?\nvk::XcbSurfaceKHR::getSurfaceCapabilities(VkSurfaceCapabilitiesKHR*) const at XcbSurfaceKHR.cpp:101\nvkGetPhysicalDeviceSurfaceCapabilitiesKHR at libVulkan.cpp:3594\nterminator_GetPhysicalDeviceSurfaceCapabilitiesKHR at wsi.c:310\nDispatchGetPhysicalDeviceSurfaceCapabilitiesKHR(VkPhysicalDevice_T*, VkSurfaceKHR_T*, VkSurfaceCapabilitiesKHR*) at layer_chassis_dispatch.cpp:4009\nvulkan_layer_chassis::GetPhysicalDeviceSurfaceCapabilitiesKHR(VkPhysicalDevice_T*, VkSurfaceKHR_T*, VkSurfaceCapabilitiesKHR*) at chassis.cpp:4702\n?? ??:0\nrx::WindowSurfaceVk::queryAndAdjustSurfaceCaps(rx::ContextVk*, VkSurfaceCapabilitiesKHR*) at SurfaceVk.cpp:1065\nrx::WindowSurfaceVk::checkForOutOfDateSwapchain(rx::ContextVk*, bool) at SurfaceVk.cpp:1098\nrx::WindowSurfaceVk::doDeferredAcquireNextImage(gl::Context const*, bool) at SurfaceVk.cpp:1494\nrx::WindowSurfaceVk::getAttachmentRenderTarget(gl::Context const*, unsigned int, gl::ImageIndex const\u0026, int, rx::FramebufferAttachmentRenderTarget**) at SurfaceVk.cpp:731\ngl::FramebufferAttachmentObject::getAttachmentRenderTarget(gl::Context const*, unsigned int, gl::ImageIndex const\u0026, int, rx::FramebufferAttachmentRenderTarget**) const at FramebufferAttachment.cpp:299\ngl::FramebufferAttachment::getRenderTargetImpl(gl::Context const*, int, rx::FramebufferAttachmentRenderTarget**) const at FramebufferAttachment.h:262\nangle::Result gl::FramebufferAttachment::getRenderTarget\u003crx::RenderTargetVk\u003e(gl::Context const*, int, rx::RenderTargetVk**) const at FramebufferAttachment.h:145\nrx::RenderTargetCache\u003crx::RenderTargetVk\u003e::updateCachedRenderTarget(gl::Context const*, gl::FramebufferAttachment const*, rx::RenderTargetVk**) at RenderTargetCache.h:163\nrx::RenderTargetCache\u003crx::RenderTargetVk\u003e::updateReadColorRenderTarget(gl::Context const*, gl::FramebufferState const\u0026) at RenderTargetCache.h:124\nrx::RenderTargetCache\u003crx::RenderTargetVk\u003e::updateColorRenderTarget(gl::Context const*, gl::FramebufferState const\u0026, unsigned long) at RenderTargetCache.h:137\nrx::FramebufferVk::updateColorAttachment(gl::Context const*, bool, unsigned int) at FramebufferVk.cpp:1549\nrx::FramebufferVk::syncState(gl::Context const*, unsigned int, angle::BitSetT\u003c27ul, unsigned long, unsigned long\u003e const\u0026, gl::Command) at FramebufferVk.cpp:1722\ngl::Framebuffer::syncState(gl::Context const*, unsigned int, gl::Command) const at Framebuffer.cpp:1863\ngl::State::syncReadFramebuffer(gl::Context const*, gl::Command) at State.cpp:3145\ngl::State::syncDirtyObjects(gl::Context const*, angle::BitSetT\u003c12ul, unsigned long, unsigned long\u003e const\u0026, gl::Command) at State.h:1097\ngl::State::syncDirtyObject(gl::Context const*, unsigned int) at State.cpp:3255\ngl::Context::invalidateFramebuffer(unsigned int, int, unsigned int const*) at Context.cpp:4390\n?? ??:0\n(anonymous namespace)::TracePerfTest::onReplayInvalidateFramebuffer(unsigned int, int, unsigned int const*) at TracePerfTest.cpp:697\n(anonymous namespace)::InvalidateFramebufferProc(unsigned int, int, unsigned int const*) at TracePerfTest.cpp:139\nangry_birds_2_1500::ReplayContext2Frame1500() at angry_birds_2_1500_capture_context2_frame1500.cpp:10784\nangry_birds_2_1500::ReplayContext2Frame(unsigned int) at angry_birds_2_1500_capture_context2.cpp:58\n?? ??:0\n(anonymous namespace)::TracePerfTest::drawBenchmark() at TracePerfTest.cpp:447\nANGLERenderTest::step() at ANGLEPerfTest.cpp:759\nANGLEPerfTest::doRunLoop(double, int, ANGLEPerfTest::RunLoopPolicy) at ANGLEPerfTest.cpp:278\nANGLERenderTest::SetUp() at ANGLEPerfTest.cpp:659\nvoid testing::internal::HandleSehExceptionsInMethodIfSupported\u003ctesting::Test, void\u003e(testing::Test*, void (testing::Test::*)(), char const*) at gtest.cc:2614\nvoid testing::internal::HandleExceptionsInMethodIfSupported\u003ctesting::Test, void\u003e(testing::Test*, void (testing::Test::*)(), char const*) at gtest.cc:2669\ntesting::Test::Run() at gtest.cc:2687\ntesting::TestInfo::Run() at gtest.cc:2869\ntesting::TestSuite::Run() at gtest.cc:3021\ntesting::internal::UnitTestImpl::RunAllTests() at gtest.cc:5731\nbool testing::internal::HandleSehExceptionsInMethodIfSupported\u003ctesting::internal::UnitTestImpl, bool\u003e(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) at gtest.cc:2614\nbool testing::internal::HandleExceptionsInMethodIfSupported\u003ctesting::internal::UnitTestImpl, bool\u003e(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) at gtest.cc:2669\ntesting::UnitTest::Run() at gtest.cc:5313\nRUN_ALL_TESTS() at gtest.h:2485\nangle::TestSuite::run() at TestSuite.cpp:1441\nmain at angle_perftests_main.cpp:20\n?? ??:0\n?? ??:0\n\n\n[[[ Patchset 5: RestoreStartingCWD() ]]]\nBacktrace:\nangle::PrintStackBacktrace() at crash_handler_posix.cpp:119\nangle::Handler(int) at crash_handler_posix.cpp:203\n__restore_rt at sigaction.c:?\n/usr/bin/addr2line: \u0027././libvk_swiftshader.so\u0027: No such file\n/usr/bin/addr2line: \u0027././libvk_swiftshader.so\u0027: No such file\nterminator_GetPhysicalDeviceSurfaceCapabilitiesKHR at wsi.c:310\n/usr/bin/addr2line: \u0027angledata/../libVkLayer_khronos_validation.so\u0027: No such file\n/usr/bin/addr2line: \u0027angledata/../libVkLayer_khronos_validation.so\u0027: No such file\n?? ??:0\nrx::WindowSurfaceVk::queryAndAdjustSurfaceCaps(rx::ContextVk*, VkSurfaceCapabilitiesKHR*) at SurfaceVk.cpp:1065\nrx::WindowSurfaceVk::checkForOutOfDateSwapchain(rx::ContextVk*, bool) at SurfaceVk.cpp:1098\nrx::WindowSurfaceVk::doDeferredAcquireNextImage(gl::Context const*, bool) at SurfaceVk.cpp:1494\nrx::WindowSurfaceVk::getAttachmentRenderTarget(gl::Context const*, unsigned int, gl::ImageIndex const\u0026, int, rx::FramebufferAttachmentRenderTarget**) at SurfaceVk.cpp:731\ngl::FramebufferAttachmentObject::getAttachmentRenderTarget(gl::Context const*, unsigned int, gl::ImageIndex const\u0026, int, rx::FramebufferAttachmentRenderTarget**) const at FramebufferAttachment.cpp:299\ngl::FramebufferAttachment::getRenderTargetImpl(gl::Context const*, int, rx::FramebufferAttachmentRenderTarget**) const at FramebufferAttachment.h:262\nangle::Result gl::FramebufferAttachment::getRenderTarget\u003crx::RenderTargetVk\u003e(gl::Context const*, int, rx::RenderTargetVk**) const at FramebufferAttachment.h:145\nrx::RenderTargetCache\u003crx::RenderTargetVk\u003e::updateCachedRenderTarget(gl::Context const*, gl::FramebufferAttachment const*, rx::RenderTargetVk**) at RenderTargetCache.h:163\nrx::RenderTargetCache\u003crx::RenderTargetVk\u003e::updateReadColorRenderTarget(gl::Context const*, gl::FramebufferState const\u0026) at RenderTargetCache.h:124\nrx::RenderTargetCache\u003crx::RenderTargetVk\u003e::updateColorRenderTarget(gl::Context const*, gl::FramebufferState const\u0026, unsigned long) at RenderTargetCache.h:137\nrx::FramebufferVk::updateColorAttachment(gl::Context const*, bool, unsigned int) at FramebufferVk.cpp:1549\nrx::FramebufferVk::syncState(gl::Context const*, unsigned int, angle::BitSetT\u003c27ul, unsigned long, unsigned long\u003e const\u0026, gl::Command) at FramebufferVk.cpp:1722\ngl::Framebuffer::syncState(gl::Context const*, unsigned int, gl::Command) const at Framebuffer.cpp:1863\ngl::State::syncReadFramebuffer(gl::Context const*, gl::Command) at State.cpp:3145\ngl::State::syncDirtyObjects(gl::Context const*, angle::BitSetT\u003c12ul, unsigned long, unsigned long\u003e const\u0026, gl::Command) at State.h:1097\ngl::State::syncDirtyObject(gl::Context const*, unsigned int) at State.cpp:3255\ngl::Context::invalidateFramebuffer(unsigned int, int, unsigned int const*) at Context.cpp:4390\n?? ??:0\n(anonymous namespace)::TracePerfTest::onReplayInvalidateFramebuffer(unsigned int, int, unsigned int const*) at TracePerfTest.cpp:697\n(anonymous namespace)::InvalidateFramebufferProc(unsigned int, int, unsigned int const*) at TracePerfTest.cpp:139\nangry_birds_2_1500::ReplayContext2Frame1500() at angry_birds_2_1500_capture_context2_frame1500.cpp:10784\nangry_birds_2_1500::ReplayContext2Frame(unsigned int) at angry_birds_2_1500_capture_context2.cpp:58\n?? ??:0\n(anonymous namespace)::TracePerfTest::drawBenchmark() at TracePerfTest.cpp:447\nANGLERenderTest::step() at ANGLEPerfTest.cpp:759\nANGLEPerfTest::doRunLoop(double, int, ANGLEPerfTest::RunLoopPolicy) at ANGLEPerfTest.cpp:278\nANGLERenderTest::SetUp() at ANGLEPerfTest.cpp:659\nvoid testing::internal::HandleSehExceptionsInMethodIfSupported\u003ctesting::Test, void\u003e(testing::Test*, void (testing::Test::*)(), char const*) at gtest.cc:2614\nvoid testing::internal::HandleExceptionsInMethodIfSupported\u003ctesting::Test, void\u003e(testing::Test*, void (testing::Test::*)(), char const*) at gtest.cc:2669\ntesting::Test::Run() at gtest.cc:2687\ntesting::TestInfo::Run() at gtest.cc:2869\ntesting::TestSuite::Run() at gtest.cc:3021\ntesting::internal::UnitTestImpl::RunAllTests() at gtest.cc:5731\nbool testing::internal::HandleSehExceptionsInMethodIfSupported\u003ctesting::internal::UnitTestImpl, bool\u003e(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) at gtest.cc:2614\nbool testing::internal::HandleExceptionsInMethodIfSupported\u003ctesting::internal::UnitTestImpl, bool\u003e(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*) at gtest.cc:2669\ntesting::UnitTest::Run() at gtest.cc:5313\nRUN_ALL_TESTS() at gtest.h:2485\nangle::TestSuite::run() at TestSuite.cpp:1441\nmain at angle_perftests_main.cpp:20\n?? ??:0\n?? ??:0\n",
      "revId": "d4a9c9fc3353b5f44571911001e44a0072e6c0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2c8a0f1f_5cf3f69e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-11-06T18:48:55Z",
      "side": 1,
      "message": "Is this because addr2line can\u0027t handle \u0027.\u0027 and \u0027..\u0027? Can we use realpath?\n\nhttps://man7.org/linux/man-pages/man3/realpath.3.html",
      "parentUuid": "1ec06f61_4f6979de",
      "revId": "d4a9c9fc3353b5f44571911001e44a0072e6c0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4972dab2_8cc84883",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-11-06T19:01:43Z",
      "side": 1,
      "message": "No luck:\n\n        static char resolvedPath[PATH_MAX];\n        realpath(module.c_str(), resolvedPath);\n        std::cout \u003c\u003c \"TIMTIM \u003e\u003e module.c_str() \u003d \u0027\" \u003c\u003c module.c_str() \u003c\u003c \"\u0027\" \u003c\u003c std::endl;\n        std::cout \u003c\u003c \"TIMTIM \u003e\u003e resolvedPath \u003d \u0027\" \u003c\u003c resolvedPath \u003c\u003c \"\u0027\" \u003c\u003c std::endl;\n\n...\n\n    TIMTIM \u003e\u003e module.c_str() \u003d \u0027././libvk_swiftshader.so\u0027\n    TIMTIM \u003e\u003e resolvedPath \u003d \u0027/home/timvp/code/angle/libvk_swiftshader.so\u0027\n    /usr/bin/addr2line: \u0027/home/timvp/code/angle/libvk_swiftshader.so\u0027: No such file\n\n    TIMTIM \u003e\u003e module.c_str() \u003d \u0027angledata/../libVkLayer_khronos_validation.so\u0027\n    TIMTIM \u003e\u003e resolvedPath \u003d \u0027/home/timvp/code/angle/angledata\u0027\n    /usr/bin/addr2line: \u0027/home/timvp/code/angle/angledata\u0027: No such file\n\n...\n\n    timvp@timvp-glaptop:~/code/angle$ fd libvk_swiftshader.so\n    out/LinuxDebug/libvk_swiftshader.so\n    timvp@timvp-glaptop:~/code/angle$ fd libVkLayer_khronos_validation.so\n    out/LinuxDebug/libVkLayer_khronos_validation.so\n\nSeems to be something special about when/how those libraries are loaded.",
      "parentUuid": "2c8a0f1f_5cf3f69e",
      "revId": "d4a9c9fc3353b5f44571911001e44a0072e6c0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "678c34dc_d1bd7626",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-11-06T19:48:56Z",
      "side": 1,
      "message": "Argh, that\u0027s unfortunate. These are special in a sense that the vulkan loader loads them in a very particular way. Alright, going back to your original solution SGTM.\n\n\n.. and this is I didn\u0027t want to finish off this cl, lol. Thanks for taking it on.",
      "parentUuid": "4972dab2_8cc84883",
      "revId": "d4a9c9fc3353b5f44571911001e44a0072e6c0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4da93058_d891f6a3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-11-06T21:54:05Z",
      "side": 1,
      "message": "You should probably restore CWD before generating the backtrace.",
      "parentUuid": "678c34dc_d1bd7626",
      "revId": "d4a9c9fc3353b5f44571911001e44a0072e6c0d7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}