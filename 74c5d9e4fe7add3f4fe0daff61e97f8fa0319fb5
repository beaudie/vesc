{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "51ce0ae8_b58762cd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 23
      },
      "lineNbr": 0,
      "author": {
        "id": 1105344
      },
      "writtenOn": "2021-07-02T22:30:53Z",
      "side": 1,
      "message": "My copy of this CL that removes the shader cache hooking is:\nhttps://chromium-review.googlesource.com/c/angle/angle/+/3002944\n\nUnfortunately it doesn\u0027t solve the problem of the failed tryjobs. The angle_end2end_tests invocations on the slightly older MacBook Pros running 10.14.6 are actually killing the bots. See https://bugs.chromium.org/p/angleproject/issues/detail?id\u003d6127#c8 .\n\nLet\u0027s not send any more dry runs of this CL until we make more progress figuring out what is going on.\n",
      "revId": "74c5d9e4fe7add3f4fe0daff61e97f8fa0319fb5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b3fd3d07_32801124",
        "filename": "src/libANGLE/renderer/metal/DisplayMtl.mm",
        "patchSetId": 23
      },
      "lineNbr": 272,
      "author": {
        "id": 1374244
      },
      "writtenOn": "2021-07-05T20:10:57Z",
      "side": 1,
      "message": "EGL_POWER_PREFERENCE_ANGLE has the same value as EGL_PLATFORM_ANGLE_PLATFORM_METHODS_ANGLEX.\n\nI don\u0027t think the usage of EGL_POWER_PREFERENCE_ANGLE is correct here. Based on spec, it is context\u0027s attribute not display\u0027s attribute. Here is it used as if it is display\u0027s attribute :)\n\nAnd because end2end test\u0027s EGLWindow utility class always inserts EGL_PLATFORM_ANGLE_PLATFORM_METHODS_ANGLEX attribute to display, it leads to low power device being chosen by accident. https://github.com/google/angle/blob/955b4620db389ff8a44059853cc28991f2114339/util/EGLWindow.cpp#L188\n\nI did try to run this CL\u0027s tests with ASAN enabled on mac 10.14 and it crashed (one specific test is BlitSameBufferOriginal). High chance it is low power device\u0027s 10.14 specific bug. This might be related to the kernel panic issues on 10.14 bots with dual GPUs (AMD \u0026 NVIDIA).\n\nI suggest removing this EGL_POWER_PREFERENCE_ANGLE selection from DisplayMtl for now (it is not correct anw). Because the way end2end tests are written (the high level layer always assumes default device is active), it will lead to many wrong IsIntel(), IsAMD(), etc detections. Removing this might also fix the kernel panic issues. Even if it might not, it is still worth to try out imo :)",
      "range": {
        "startLine": 272,
        "startChar": 20,
        "endLine": 272,
        "endChar": 46
      },
      "revId": "74c5d9e4fe7add3f4fe0daff61e97f8fa0319fb5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "424856d2_ee95c7c7",
        "filename": "src/libANGLE/renderer/metal/DisplayMtl.mm",
        "patchSetId": 23
      },
      "lineNbr": 272,
      "author": {
        "id": 1374244
      },
      "writtenOn": "2021-07-05T20:50:52Z",
      "side": 1,
      "message": "Confirmed kernel panic/swarming failures were fixed by removing the EGL_POWER_PREFERENCE_ANGLE selection in this copying CL.\nhttps://chromium-review.googlesource.com/c/angle/angle/+/3006563/1..2\n\nThough the CL is still not clean, there are failed tests remaining.",
      "parentUuid": "b3fd3d07_32801124",
      "range": {
        "startLine": 272,
        "startChar": 20,
        "endLine": 272,
        "endChar": 46
      },
      "revId": "74c5d9e4fe7add3f4fe0daff61e97f8fa0319fb5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e4a8110_f47bf5a8",
        "filename": "src/libANGLE/renderer/metal/DisplayMtl.mm",
        "patchSetId": 23
      },
      "lineNbr": 272,
      "author": {
        "id": 1105344
      },
      "writtenOn": "2021-07-06T20:42:34Z",
      "side": 1,
      "message": "Thank you so much Quyen for tracking this down!\n\nApple also found the collision between EGL_POWER_PREFERENCE_ANGLE and EGL_PLATFORM_ANGLE_PLATFORM_METHODS_ANGLEX and recently fixed it in https://bugs.webkit.org/show_bug.cgi?id\u003d227408 . However, it wasn\u0027t obvious that the GPU selection, and defaulting to the low-power GPU, could be the cause of the kernel panics. Thank you for figuring that out!\n\nThe use of EGL_POWER_PREFERENCE_ANGLE as a display creation attribute is actually the most compatible way to use the idea. As specified in EGL_ANGLE_power_preference as a context creation attribute, it\u0027s only compatible with the OpenGL backend on macOS. We\u0027ll update the extension specification to allow this use and deprecate the OpenGL-specific semantics.\n\nWill remove the default low-power GPU selection in my copy of this CL:\nhttps://chromium-review.googlesource.com/c/angle/angle/+/3002944\n\nand try to figure out the remaining test failures.",
      "parentUuid": "424856d2_ee95c7c7",
      "range": {
        "startLine": 272,
        "startChar": 20,
        "endLine": 272,
        "endChar": 46
      },
      "revId": "74c5d9e4fe7add3f4fe0daff61e97f8fa0319fb5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93281842_8fbf1b82",
        "filename": "src/libANGLE/renderer/metal/DisplayMtl.mm",
        "patchSetId": 23
      },
      "lineNbr": 272,
      "author": {
        "id": 1105344
      },
      "writtenOn": "2021-07-06T22:41:58Z",
      "side": 1,
      "message": "Removed in the latest patch set of:\nhttps://chromium-review.googlesource.com/c/angle/angle/+/3002944",
      "parentUuid": "7e4a8110_f47bf5a8",
      "range": {
        "startLine": 272,
        "startChar": 20,
        "endLine": 272,
        "endChar": 46
      },
      "revId": "74c5d9e4fe7add3f4fe0daff61e97f8fa0319fb5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0731564f_16706c75",
        "filename": "src/libANGLE/renderer/metal/DisplayMtl.mm",
        "patchSetId": 23
      },
      "lineNbr": 272,
      "author": {
        "id": 1105344
      },
      "writtenOn": "2021-07-08T06:33:18Z",
      "side": 1,
      "message": "Jonah\u0027s picking this CL up again and has incorporated this change. Thanks again Quyen for tracking it down.",
      "parentUuid": "93281842_8fbf1b82",
      "range": {
        "startLine": 272,
        "startChar": 20,
        "endLine": 272,
        "endChar": 46
      },
      "revId": "74c5d9e4fe7add3f4fe0daff61e97f8fa0319fb5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "709f6d43_c9c67d2d",
        "filename": "src/libANGLE/renderer/metal/DisplayMtl.mm",
        "patchSetId": 23
      },
      "lineNbr": 272,
      "author": {
        "id": 1326275
      },
      "writtenOn": "2021-07-08T12:35:50Z",
      "side": 1,
      "message": "Thanks Quyen for this excellent catch!",
      "parentUuid": "93281842_8fbf1b82",
      "range": {
        "startLine": 272,
        "startChar": 20,
        "endLine": 272,
        "endChar": 46
      },
      "revId": "74c5d9e4fe7add3f4fe0daff61e97f8fa0319fb5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}