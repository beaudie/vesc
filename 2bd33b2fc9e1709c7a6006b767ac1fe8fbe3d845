{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "7c4eccd7_1b4c5521",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2021-07-09T23:43:24Z",
      "side": 1,
      "message": "LGTM.\n\nAdding Shabi for the +2.",
      "revId": "2bd33b2fc9e1709c7a6006b767ac1fe8fbe3d845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "899b9756_856b70cb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2021-07-09T23:44:11Z",
      "side": 1,
      "message": "Also, it looks like CQ is failing the new tests, so there may be some more work required for that.",
      "revId": "2bd33b2fc9e1709c7a6006b767ac1fe8fbe3d845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9e560cfd_aac0ab5d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-07-11T01:54:36Z",
      "side": 1,
      "message": "This is not the right fix; as described below I could modify the test in such a way that still fails after this change.\n\n+Jamie",
      "revId": "2bd33b2fc9e1709c7a6006b767ac1fe8fbe3d845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "620ceb5f_ce846f1b",
        "filename": "src/libANGLE/State.cpp",
        "patchSetId": 5
      },
      "lineNbr": 964,
      "author": {
        "id": 1106289
      },
      "writtenOn": "2021-07-10T03:37:34Z",
      "side": 1,
      "message": "Note that there are two masks (per polygon orientation), that affect stencil operations. The mask parameter set by glStencilFunc() is essentially a read mask, while the one set by glStencilMask() is a write mask.\n\nThis flag indicates that the write mask is dirty, but this function is part of the glStencilFunc() state tracking, which only affects the read mask.\n\nI suspect there\u0027s a bug deeper down instead.",
      "range": {
        "startLine": 964,
        "startChar": 23,
        "endLine": 964,
        "endChar": 56
      },
      "revId": "2bd33b2fc9e1709c7a6006b767ac1fe8fbe3d845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e725d09a_d59604f5",
        "filename": "src/libANGLE/State.cpp",
        "patchSetId": 5
      },
      "lineNbr": 964,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-07-11T01:54:36Z",
      "side": 1,
      "message": "Thanks for pointing this out Nicolas. I diagnosed the problem, and here\u0027s what happens:\n\n-- This dirty bit is set by default, so it doesn\u0027t need to be set here\n-- In the test, glClear is called on the framebuffer when there\u0027s no stencil attachment.\n  * The backend syncs the stencil bits, ignoring them because there\u0027s no stencil attachment.\n  * The stencil dirty bits are cleared\n-- The test then adds a stencil attachment\n  * The stencil dirty bits are not set at this point\n  * On next sync, stencil dirty bits are not processed\n\nThe fact that this change makes the test pass is somewhat coincidental. If the test set up the stencil function and ops and even write mask, before adding the stencil attachment, it would still fail after this change.\n\nJamie might have a better idea, but what I\u0027m thinking is this: See how ContextVk::syncState handles gl::State::DIRTY_BIT_DRAW_FRAMEBUFFER_BINDING. A lot of state that depends on the framebuffer is updated when the binding changes. I think FramebufferVk::syncState should also call (a subset of) these functions when its bindings change (in particular, when an attachment is added/removed, not necessarily. See how shouldUpdateColorMask solves this for one particular situation, but everything else is missing.",
      "parentUuid": "620ceb5f_ce846f1b",
      "range": {
        "startLine": 964,
        "startChar": 23,
        "endLine": 964,
        "endChar": 56
      },
      "revId": "2bd33b2fc9e1709c7a6006b767ac1fe8fbe3d845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3d467c7_48dc53d4",
        "filename": "src/tests/gl_tests/DepthStencilTest.cpp",
        "patchSetId": 5
      },
      "lineNbr": 399,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-07-11T01:33:14Z",
      "side": 1,
      "message": "Please use `GLFramebuffer fbo;` instead, from gl_raii. Same below which can use GLRenderbuffer. No need to glDelete* anything (including the program) as they all have destructors.",
      "range": {
        "startLine": 398,
        "startChar": 0,
        "endLine": 399,
        "endChar": 31
      },
      "revId": "2bd33b2fc9e1709c7a6006b767ac1fe8fbe3d845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "00ae6bc5_ac1e60eb",
        "filename": "src/tests/gl_tests/DepthStencilTest.cpp",
        "patchSetId": 5
      },
      "lineNbr": 421,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-07-11T01:33:14Z",
      "side": 1,
      "message": "EXPECT_PIXEL_COLOR_EQ(0, 0, GLColor::transparentBlack);",
      "revId": "2bd33b2fc9e1709c7a6006b767ac1fe8fbe3d845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d6a9de54_c439fefb",
        "filename": "src/tests/gl_tests/DepthStencilTest.cpp",
        "patchSetId": 5
      },
      "lineNbr": 426,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-07-11T01:33:14Z",
      "side": 1,
      "message": "Use `angle::essl1_shaders::ColorUniform()` instead",
      "range": {
        "startLine": 426,
        "startChar": 57,
        "endLine": 426,
        "endChar": 66
      },
      "revId": "2bd33b2fc9e1709c7a6006b767ac1fe8fbe3d845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "77bc9b69_4acdd394",
        "filename": "src/tests/gl_tests/DepthStencilTest.cpp",
        "patchSetId": 5
      },
      "lineNbr": 436,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-07-11T01:33:14Z",
      "side": 1,
      "message": "EXPECT_PIXEL_COLOR_EQ(0, 0, GLColor::red);",
      "revId": "2bd33b2fc9e1709c7a6006b767ac1fe8fbe3d845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6ef5da78_5e5eebb7",
        "filename": "src/tests/test_utils/ANGLETest.h",
        "patchSetId": 5
      },
      "lineNbr": 326,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-07-11T01:33:14Z",
      "side": 1,
      "message": "This is generating errors on some backends. Probably needs an extension on ES3?",
      "revId": "2bd33b2fc9e1709c7a6006b767ac1fe8fbe3d845",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}