{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "31a76b79_7f42f95c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1520902
      },
      "writtenOn": "2024-09-24T21:05:09Z",
      "side": 1,
      "message": "This change broke an Android test `org.skia.skqp.SkQPRunner#UnitTest_DMSAA_dst_read`.\n\nTo repro:\n\n```\ncd \u003cyour aosp-main repo\u003e\nsource build/envsetup.sh\nlunch aosp_cf_x86_64_phone-trunk_staging-userdebug\nm\nm cts\ncvd reset -y; cvd create --gpu_mode\u003dguest_swiftshader\ncts-tradefed run commandAndExit cts-dev --log-level-display\u003dINFO -m CtsSkQPTestCases -t org.skia.skqp.SkQPRunner#UnitTest_DMSAA_dst_read\n```\n\nAfter this change, the test hanged and eventually timedout.",
      "revId": "bffcd235ba6c031603d798daaa98f1cf9a3f3e46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "854496f3_7657216f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2024-09-24T21:17:35Z",
      "side": 1,
      "message": "thanks for reporting this but im surprised the change causes a test hang / timeout. Unfortunately i dont have access to the bug tagged in the revert, could you post the details to the anglebug of this change? Also, i do not have an AOSP environment to repro the failure, is there an end2end test or a deqp test that can repro the issue?",
      "parentUuid": "31a76b79_7f42f95c",
      "revId": "bffcd235ba6c031603d798daaa98f1cf9a3f3e46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "514c9640_9ded32a0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1520902
      },
      "writtenOn": "2024-09-24T21:44:21Z",
      "side": 1,
      "message": "I added some information in https://g-issues.angleproject.org/issues/40644776. I should say that it is more accurate to say the test crashed rather than hanging / time out.\n\nI am not very familiar with Skia APIs. @nscobie@google.com, do you happen to know how to translate this `DMSAA_dst_read` test https://cs.android.com/android/platform/superproject/main/+/main:external/skia/tests/DMSAATest.cpp;l\u003d166;drc\u003dd262a68a1e0c3b640274b094a7f1e3a5b75563e9 to a test that only involves EGL/GLES calls?",
      "parentUuid": "854496f3_7657216f",
      "revId": "bffcd235ba6c031603d798daaa98f1cf9a3f3e46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b05484b1_97711fcd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2024-09-24T21:49:33Z",
      "side": 1,
      "message": "thanks for the log @yuxinhu@google.com but in the attached file `org.skia.skqp.SkQPRunner#UnitTest_DMSAA_dst_read.txt` i dont see any crash signature. All i see is this and nothing else -\n```\n09-24 19:44:11.537  4633  4645 I TestRunner: run started: 1 tests\n09-24 19:44:11.538  4633  4645 I TestRunner: started: UnitTest_DMSAA_dst_read(org.skia.skqp.SkQPRunner)\n09-24 19:44:11.542  4633  4645 E libEGL  : validate_display:547 error 3008 (EGL_BAD_DISPLAY)\n```\nand then nothing else. There is a display validation error, im not sure if that is normal for this test though",
      "parentUuid": "514c9640_9ded32a0",
      "revId": "bffcd235ba6c031603d798daaa98f1cf9a3f3e46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b4812921_49800a69",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1520902
      },
      "writtenOn": "2024-09-24T21:58:12Z",
      "side": 1,
      "message": "The `validate_display` error is not relevant. It showed up in the passing test logs, too. Below is the log of the same test when it passes:\n\n```\n09-24 19:29:22.059  4547  4559 I TestRunner: run started: 1 tests\n09-24 19:29:22.060  4547  4559 I TestRunner: started: UnitTest_DMSAA_dst_read(org.skia.skqp.SkQPRunner)\n09-24 19:29:22.062  4547  4559 E libEGL  : validate_display:547 error 3008 (EGL_BAD_DISPLAY)\n...\n09-24 19:29:22.314  4547  4559 W SwiftShader: external/swiftshader/src/Vulkan/VkPhysicalDevice.cpp:675 WARNING: UNSUPPORTED: curExtension-\u003esType: 1000338000\n09-24 19:29:22.314  4547  4559 W SwiftShader: external/swiftshader/src/Vulkan/VkPhysicalDevice.cpp:675 WARNING: UNSUPPORTED: curExtension-\u003esType: 1000437000\n09-24 19:29:22.316  4547  4559 E libEGL  : validate_display:547 error 3008 (EGL_BAD_DISPLAY)\n09-24 19:29:22.464  4547  4559 I TestRunner: finished: UnitTest_DMSAA_dst_read(org.skia.skqp.SkQPRunner)\n09-24 19:29:22.466  4547  4559 I org.skia.skqp: Test \u0027UnitTest_DMSAA_dst_read\u0027 complete (1/1). [pass]\n```\n\nIn the failed test log, if you search for the PID of the test 4645, you will see these lines:\n\n```\n09-24 19:44:11.538  4633  4645 I TestRunner: started: UnitTest_DMSAA_dst_read(org.skia.skqp.SkQPRunner)\n09-24 19:44:11.542  4633  4645 E libEGL  : validate_display:547 error 3008 (EGL_BAD_DISPLAY)\n09-24 19:55:29.365  4645  4645 E crash_dump64: failed to get the guest state header for thread 3697: Bad address\n09-24 19:55:29.367  4645  4645 I crash_dump64: obtaining output fd from tombstoned, type: kDebuggerdNativeBacktrace\n09-24 19:55:29.368  4645  4645 I crash_dump64: performing dump of process 642 (target tid \u003d 642)\n```\n\nMy read is that `crash_dump64` indicates the process crashed. Let me try to get a symbolized crash callstack.",
      "parentUuid": "b05484b1_97711fcd",
      "revId": "bffcd235ba6c031603d798daaa98f1cf9a3f3e46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f30533e8_fe655238",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2024-09-24T22:04:15Z",
      "side": 1,
      "message": "\u003e The validate_display error is not relevant. It showed up in the passing test logs, too\n\nAck\n\n\u003e Let me try to get a symbolized crash callstack\n\nappreciate it, that would be very helpful. The attached log dint even have a stack trace which is what made me think the failure was a mutex deadlock or some other type of hang\n\nalso, i see this failure was reported for swiftshader, does this mean vendor ICDs like pixel bots had no issues with this test?",
      "parentUuid": "b4812921_49800a69",
      "revId": "bffcd235ba6c031603d798daaa98f1cf9a3f3e46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "24dc33b6_277c2fc3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1520902
      },
      "writtenOn": "2024-09-25T01:54:03Z",
      "side": 1,
      "message": "\u003e The attached log dint even have a stack trace which is what made me think the failure was a mutex deadlock or some other type of hang.\n\nI think you are right. The test indeed hanged, instead of crashing.\n\n\u003e also, i see this failure was reported for swiftshader, does this mean vendor ICDs like pixel bots had no issues with this test?\n\nOn other pixel devices the test still passed with this change. Yes the test hang so far is only reported on swiftshader backend.",
      "parentUuid": "f30533e8_fe655238",
      "revId": "bffcd235ba6c031603d798daaa98f1cf9a3f3e46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9a30801c_7ba000cb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2024-09-25T11:46:30Z",
      "side": 1,
      "message": "\u003e The test indeed hanged\n\nif you do have to access to it, could you grab the tombstone files? they will have the state of all threads in the process just before the hang\n\n\u003e On other pixel devices the test still passed with this change\n\ndo you know if the failure with swiftshader is intermittent or is does it repro 100%? if it is a timing issue, it could show up on other vendor ICDs as well",
      "parentUuid": "24dc33b6_277c2fc3",
      "revId": "bffcd235ba6c031603d798daaa98f1cf9a3f3e46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0c5d8fd8_b9625d11",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 36
      },
      "lineNbr": 0,
      "author": {
        "id": 1520902
      },
      "writtenOn": "2024-09-25T17:40:49Z",
      "side": 1,
      "message": "\u003e If you do have to access to it, could you grab the tombstone files?\n\nWhen I ran the test locally I don\u0027t see any tombstone files. The logcat stops printing any information on the test process after the test starts.\n\n\u003e do you know if the failure with swiftshader is intermittent or is does it repro 100%? if it is a timing issue, it could show up on other vendor ICDs as well.\n\nThe failure is 100% repro with swiftshader.\n\nThe best next action I can think of is reaching out to Skia team and understand what the test tries to do. Let me comment on the bug angleproject:40644776.",
      "parentUuid": "9a30801c_7ba000cb",
      "revId": "bffcd235ba6c031603d798daaa98f1cf9a3f3e46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}