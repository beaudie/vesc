{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "01efa410_1d4a9741",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001921
      },
      "writtenOn": "2021-09-17T20:54:48Z",
      "side": 1,
      "message": "Jamie, PTAL, this passed dryrun in crrev.com/c/3046764.\n\nI need this to land crrev.com/c/3046764.\nCurrent code applies sharding to the batch the host passes via --gtest_filter.\nSo, when we retry 13 tests with 20 shards, testSet end up empty, thus the failure in PS1 of crrev.com/c/3046764.\nhttps://ci.chromium.org/ui/p/angle/builders/try/android-arm64-rel/2195/overview\n(All the 13 tests still run, just the accounting in testSet is wrong).",
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9b950da8_b1cc9e3a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-09-17T21:18:10Z",
      "side": 1,
      "message": "What does this do exactly? It ignores the sharding arguments on Android?",
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7ee39eb8_808b96a4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-09-17T21:19:14Z",
      "side": 1,
      "message": "Can you in a later patch change the tests to not pass in sharding arguments on Android if you don\u0027t want them?",
      "parentUuid": "01efa410_1d4a9741",
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "52c21266_231e681b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-09-17T21:22:32Z",
      "side": 1,
      "message": "LGTM with a TODO to remove this workaround in the future. If a TODO isn\u0027t possible let me know and I\u0027d like to see if we can come up with another solution that doesn\u0027t use IsAndroid()",
      "parentUuid": "7ee39eb8_808b96a4",
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "95d701b7_8fd88dcb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001921
      },
      "writtenOn": "2021-09-17T22:02:55Z",
      "side": 1,
      "message": "Basically, this makes sure that testSet actually corresponds to what\u0027s being run.\nSo yeah, it ignores sharding arguments when running a batch of tests specified with --gtest_filter.\nThe old code used to ignore sharding arguments as well, because of the bug with argv I\u0027ve mentioned earlier, so it sill ran the whole batch of tests.\nBut it didn\u0027t ignore the sharding for testSet, so accounting of test results was possibly wrong.\nNow you can say it ignores sharding for both.\n\nOne thing that still uses sharding args is listing tests.\nWhich reminds me, I need to figure out how this will work when I\u0027ll remove the custom script.",
      "parentUuid": "9b950da8_b1cc9e3a",
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0c9d4952_1815fc82",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001921
      },
      "writtenOn": "2021-09-17T22:02:55Z",
      "side": 1,
      "message": "I don\u0027t consider this a workaround.\nWe do need to pass sharding info (I need to figure out how), so that we list only the relevant tests.\nAnd we need to ignore sharding info when we have --gtest_filter, since Android runner tells us what to run and we can\u0027t modify that.\n\nSo, the only way this can be removed is together with Android runner.\nAt which point it would make sense to remove all !mBotMode code, not just the part that I touch here.",
      "parentUuid": "52c21266_231e681b",
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "be5b9e6f_f4ec589c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001921
      },
      "writtenOn": "2021-09-18T01:17:52Z",
      "side": 1,
      "message": "OK, so this works now both with https://ci.chromium.org/ui/p/angle/builders/try/android-arm64-rel/3470/overview\nand without https://ci.chromium.org/ui/p/chromium/builders/try/android-angle-try/2152/overview\nwrapper script.\n\nTurns out there is no need to pass sharding info to TestSuite, since without wrapper script Android harness gets sharding info and does the split.\nThe drawback is that every shard will list all the tests, not just the ones in shard, but I think this is unavoidable.",
      "parentUuid": "0c9d4952_1815fc82",
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96d10f5d_c066f9f9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-09-20T17:49:18Z",
      "side": 1,
      "message": "Sounds fine to me to list the tests often. By shard, do you mean every Android test runner group of 256 tests? Anyway if that\u0027s what we need to do sounds totally fine.\n\nIs this CL still necessary? I wasn\u0027t totally sure.",
      "parentUuid": "be5b9e6f_f4ec589c",
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a8faeca4_22db4248",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001921
      },
      "writtenOn": "2021-09-20T20:21:31Z",
      "side": 1,
      "message": "Yes, this CL is still necessary, the builds above ran on top of it.\n\nBy \"shard\" I mean Swarming shard. I refer to GTest shards as batches.",
      "parentUuid": "96d10f5d_c066f9f9",
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "89f5f34a_f04e112f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-09-21T18:17:09Z",
      "side": 1,
      "message": "Spoke offline - hopefully we can remove the external batching tracking from TestSuite.cpp once we switch to remove the wrapper scripts.",
      "parentUuid": "a8faeca4_22db4248",
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e8873f64_cc859064",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-09-21T18:17:09Z",
      "side": 1,
      "message": "re-lgtm, feel free to resolve open comments and land.",
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "07d3214a_316189e8",
        "filename": "src/tests/test_utils/runner/TestSuite.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1063,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-09-17T21:22:32Z",
      "side": 1,
      "message": "can you replace this with IsAndroid()? Or add a function UsesExternalBatching() that does this instead of setting a locally scoped bool.",
      "range": {
        "startLine": 1056,
        "startChar": 0,
        "endLine": 1063,
        "endChar": 0
      },
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2bec9ceb_028b1088",
        "filename": "src/tests/test_utils/runner/TestSuite.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1216,
      "author": {
        "id": 1001921
      },
      "writtenOn": "2021-09-18T01:17:52Z",
      "side": 1,
      "message": "I think I can remove this if I remove the wrapper script.\nSince we won\u0027t have mShardIndex and mShardCount set at all.\nSo listing and running tests will follow the same path.\nThe drawback is that we\u0027ll have to list all the tests, not just the ones in this shard, and then have the host to do the split.\n\nI\u0027m going to add a couple more CLs to this stack, one that removes script usage in standalone and one that will disable sharding on Android completely.",
      "range": {
        "startLine": 1216,
        "startChar": 36,
        "endLine": 1216,
        "endChar": 69
      },
      "revId": "cc9ff9c42d39d9500315eade6737ccba8f72d8c2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}