{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "a1f97000_8a3c8690",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2023-01-31T15:06:56Z",
      "side": 1,
      "message": "Thanks a lot for the fixes! It looks like you\u0027ve fixed more than one bug, are more tests necessary? The d3d skip removals are for PBO tests, which can take a different path in the Vulkan backend, probably the equivalent non-PBO test would have failed on Vulkan too (your new test seems to duplicate one of those tests, but not the other)",
      "revId": "37be07f6f801ed125ba0932727499afd57cb39ac",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f665d846_df430d0a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1105284
      },
      "writtenOn": "2023-01-31T15:12:42Z",
      "side": 1,
      "message": "LGTM too",
      "revId": "37be07f6f801ed125ba0932727499afd57cb39ac",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e87a17fd_ee29808c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1394635
      },
      "writtenOn": "2023-01-31T20:15:45Z",
      "side": 1,
      "message": "\u003e your new test seems to duplicate one of those tests, but not the other\n\nThose two unskipped tests cover `DEPTH24_STENCIL8` and `STENCIL_INDEX8`, both of which are also covered by the new test with direct uploads. What is missing?\n\n---\n\nI reviewed the functional updates of this CL one more time.\n\nFixed and tested:\n- D24S8 to S8D24\n- S8 to S8D24\n- D32FS8 to D32FS8\n\nFixed and untested:\n- D32 uploads to D32F are more accurate now, not truncating last 8 bits of the input value.\n- D32FS8 to D24S8 had incorrect stencil values. It\u0027s a Vulkan fallback path that is unlikely to be encountered.\n\nSpecial:\n- D24S8 uploads to D32FS8 had incorrect both depth and stencil values. It\u0027s a fallback path on Vulkan when D24S8 is not supported. Further investigation showed that Metal backend also needs it and overrides this incorrect `angle::` conversion with a correct `mtl::` one. I\u0027ll update the Metal backend to use the fixed conversion instead.",
      "parentUuid": "a1f97000_8a3c8690",
      "revId": "37be07f6f801ed125ba0932727499afd57cb39ac",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "393e05a6_c27caae7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2023-02-01T16:07:17Z",
      "side": 1,
      "message": "\u003e What is missing?\n\nThey are PBO copies which take a different path from CPU data uploads. I would have imagined the CPU upload paths are tested _somewhere_, but given how many bugs you just fixed and there are no deqp suppressions lifted, it looks like not much is tested.\n\n\u003e Fixed and untested\n\u003e Further investigation showed that Metal backend also needs it\n\nThanks for being thorough.\n\n\u003e It\u0027s a Vulkan fallback path that is unlikely to be encountered.\n\nFWIW, if you want to add tests that intentionally fallback to another format (even if the original format is supported), you can instantiate tests with something like this:\n\n```\nES3_VULKAN().enable(Feature::ForceFallbackFormat)\n```\n\n(Only supported for Vulkan at the moment)",
      "parentUuid": "e87a17fd_ee29808c",
      "revId": "37be07f6f801ed125ba0932727499afd57cb39ac",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b7842f70_05b485d0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1394635
      },
      "writtenOn": "2023-02-01T21:57:43Z",
      "side": 1,
      "message": "Tried enforcing fallback formats and found another bug in Vulkan uploads. Will update the CL.",
      "parentUuid": "393e05a6_c27caae7",
      "revId": "37be07f6f801ed125ba0932727499afd57cb39ac",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0a6ff757_adb99a8d",
        "filename": "src/image_util/loadimage.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1351,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2023-01-31T15:06:56Z",
      "side": 1,
      "message": "I\u0027d call it `LoadD24S8ToS8D24`, otherwise the name looks like identity",
      "range": {
        "startLine": 1351,
        "startChar": 16,
        "endLine": 1351,
        "endChar": 21
      },
      "revId": "37be07f6f801ed125ba0932727499afd57cb39ac",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "de60ac54_57aa04ae",
        "filename": "src/image_util/loadimage.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1351,
      "author": {
        "id": 1394635
      },
      "writtenOn": "2023-01-31T15:29:19Z",
      "side": 1,
      "message": "The functions here are called `Load{A}To{B}`, where `{A}` is a GL-format and `{B}` is an ANGLE-format (historically derived from D3D?).\n\nSince the D24S8 _target_ format has the same layout in all cases, all instances of `*ToD24S8` would have to be renamed to `*ToS8D24` for consistency; that\u0027s why I didn\u0027t make it.",
      "parentUuid": "0a6ff757_adb99a8d",
      "range": {
        "startLine": 1351,
        "startChar": 16,
        "endLine": 1351,
        "endChar": 21
      },
      "revId": "37be07f6f801ed125ba0932727499afd57cb39ac",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9afee4ac_921ca4c6",
        "filename": "src/image_util/loadimage.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1351,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2023-01-31T15:38:17Z",
      "side": 1,
      "message": "I\u0027m not quite sure that\u0027s true. These are generic reformatting functions that change one pixel layout to another, there is no semantics attached to either From or To formats.\n\nThat\u0027s also why this was named G8R24-\u003eR24G8, because the channel being red or depth doesn\u0027t matter.",
      "parentUuid": "de60ac54_57aa04ae",
      "range": {
        "startLine": 1351,
        "startChar": 16,
        "endLine": 1351,
        "endChar": 21
      },
      "revId": "37be07f6f801ed125ba0932727499afd57cb39ac",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "658a5266_2f0d6b42",
        "filename": "src/image_util/loadimage.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1351,
      "author": {
        "id": 1394635
      },
      "writtenOn": "2023-01-31T18:18:56Z",
      "side": 1,
      "message": "I meant that if this function is called `LoadD24S8ToS8D24` and moves S8 to MSBs and D24 to LSBs, then for consistency:\n- `LoadD32FS8X24ToD24S8` should be called `LoadD32FS8X24ToS8D24`\n- `LoadD32ToD24X8` should be called `LoadD32ToX8D24`\n- `LoadS8ToX24S8` should be called `LoadS8ToS8X24`\n\nIf this looks fine, let\u0027s rename all four.",
      "parentUuid": "9afee4ac_921ca4c6",
      "range": {
        "startLine": 1351,
        "startChar": 16,
        "endLine": 1351,
        "endChar": 21
      },
      "revId": "37be07f6f801ed125ba0932727499afd57cb39ac",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "afe82776_f7b385c1",
        "filename": "src/image_util/loadimage.cpp",
        "patchSetId": 2
      },
      "lineNbr": 1351,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2023-02-01T16:07:17Z",
      "side": 1,
      "message": "Yes, that would be great actually (I haven\u0027t verified the names though, trusting you with that)",
      "parentUuid": "658a5266_2f0d6b42",
      "range": {
        "startLine": 1351,
        "startChar": 16,
        "endLine": 1351,
        "endChar": 21
      },
      "revId": "37be07f6f801ed125ba0932727499afd57cb39ac",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}