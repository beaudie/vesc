{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "db7f2ffb_6a446801",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-14T16:09:39Z",
      "side": 1,
      "message": "Async queue is not being tested, so green run here doesn\u0027t guarantee anything.\n\nI rebased [1] on top of this, hopefully that will turn green. Not a blocker for this change nevertheless.\n\n[1]: https://chromium-review.googlesource.com/c/angle/angle/+/3193420",
      "revId": "1357e31676bbdec33d33a3ab95f54f3e998562aa",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b1d95a7d_817668ee",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-14T16:41:57Z",
      "side": 1,
      "message": "[1] is green now, so double +2",
      "parentUuid": "db7f2ffb_6a446801",
      "revId": "1357e31676bbdec33d33a3ab95f54f3e998562aa",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aca9d866_8a5de682",
        "filename": "src/libANGLE/renderer/vulkan/CommandProcessor.cpp",
        "patchSetId": 1
      },
      "lineNbr": 602,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-14T16:45:58Z",
      "side": 1,
      "message": "Regarding Steven\u0027s concern, should this say the following?\n\n    return mCommandQueue.isBusy() || !mTasks.empty();\n\nI don\u0027t know if it would be worth looking for specific tasks in `mTasks`.\n\nAlternatively, maybe `CommandProcessor::queueSubmit` should update `mCommandQueue.mLastSubmittedQueueSerial` right away.",
      "revId": "1357e31676bbdec33d33a3ab95f54f3e998562aa",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4d7c7d9a_843c0348",
        "filename": "src/libANGLE/renderer/vulkan/CommandProcessor.cpp",
        "patchSetId": 1
      },
      "lineNbr": 602,
      "author": {
        "id": 1518892
      },
      "writtenOn": "2021-10-14T16:57:10Z",
      "side": 1,
      "message": "\u003e \n\u003e     return mCommandQueue.isBusy() || !mTasks.empty();\n\u003e \n\nI think that\u0027s better, but I\u0027d probably reverse the conditions, check for non-empty task queue first, and then check if the command queue is busy.\n\nImagining a thread race where T0 \u003d main thread, T1 \u003d CommandProcessor:\n\nT0 mCommandQueue.isBusy() \u003d\u003d false\nT1 CommandProcessor consumes the only task in mTasks\nT0 !mTasks.empty() \u003d\u003d false\nT0 returns false\n\nIt seems really unlikely but possible.",
      "parentUuid": "aca9d866_8a5de682",
      "revId": "1357e31676bbdec33d33a3ab95f54f3e998562aa",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bbc13cbd_67c4e34e",
        "filename": "src/libANGLE/renderer/vulkan/CommandProcessor.cpp",
        "patchSetId": 1
      },
      "lineNbr": 602,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-14T16:59:57Z",
      "side": 1,
      "message": "Right, the worker is holding a different lock (mWorkerMutex).\n\nIt might be easier to update `mCommandQueue.mLastSubmittedQueueSerial` right away in `CommandProcessor::queueSubmit`. I haven\u0027t thought it through though if that has unwanted repercussions.",
      "parentUuid": "4d7c7d9a_843c0348",
      "revId": "1357e31676bbdec33d33a3ab95f54f3e998562aa",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "23777037_1b2a380c",
        "filename": "src/libANGLE/renderer/vulkan/CommandProcessor.cpp",
        "patchSetId": 1
      },
      "lineNbr": 602,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-10-14T21:13:26Z",
      "side": 1,
      "message": "Done, better to check the tasks.. I don\u0027t want to change the invariant properties of the last submitted serial. I was going to merge all the locks in the future, so we can just take both locks for now.",
      "parentUuid": "bbc13cbd_67c4e34e",
      "revId": "1357e31676bbdec33d33a3ab95f54f3e998562aa",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1f214c8a_b49f936b",
        "filename": "src/libANGLE/renderer/vulkan/CommandProcessor.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1258,
      "author": {
        "id": 1518892
      },
      "writtenOn": "2021-10-14T16:36:38Z",
      "side": 1,
      "message": "Correct me if I\u0027m wrong, but it seems like using CommandProcessor::isBusy could still race, because CommandQueue::mLastSubmittedQueueSerial would only be up-to-date with the most recent CommandProcessorTask that the CommandProcessor has handled. So CommandProcessor::isBusy() could return false while tasks are queued.",
      "revId": "1357e31676bbdec33d33a3ab95f54f3e998562aa",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "549fefb8_510781b7",
        "filename": "src/libANGLE/renderer/vulkan/CommandProcessor.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1258,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-10-14T21:13:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1f214c8a_b49f936b",
      "revId": "1357e31676bbdec33d33a3ab95f54f3e998562aa",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}