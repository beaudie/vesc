{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "1dccad10_ceee6ec7",
        "filename": "src/libANGLE/Program.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1221,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-03-22T03:40:33Z",
      "side": 1,
      "message": "The `linkEvent-\u003ewait()` above should already wait for non-optional tasks. This change shouldn\u0027t be necessary.",
      "range": {
        "startLine": 1213,
        "startChar": 0,
        "endLine": 1221,
        "endChar": 0
      },
      "revId": "5cfa239565f44fb0c69f0745a5a6a195673613c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "236eb7d3_2e18a98c",
        "filename": "src/libANGLE/Program.cpp",
        "patchSetId": 1
      },
      "lineNbr": 2134,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-03-22T03:40:33Z",
      "side": 1,
      "message": "I prefer the previous comment to exist. The backends don\u0027t actually _need_ the result of the optional post-link tasks, they may just benefit from them if they happen to have finished.\n\nThat is, the real reason for the wait here is thread safety.",
      "revId": "5cfa239565f44fb0c69f0745a5a6a195673613c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ea6747a6_28a23b7a",
        "filename": "src/libANGLE/renderer/ProgramImpl.h",
        "patchSetId": 1
      },
      "lineNbr": 62,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-03-22T03:40:33Z",
      "side": 1,
      "message": "I was just looking again, and I think we should revert the SubTask-\u003ePostLinkTask change. I apologize for the bad suggestion. These tasks are actually part of link for every backend except for Vulkan. It\u0027s only for Vulkan that these are post-link tasks. So the name sub-task was actually appropriate (and post-link is wrong for all the other backends).\n\nI have some tweaks to the comment here, but let\u0027s undo the name change and I\u0027ll get to it.",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 62,
        "endChar": 62
      },
      "revId": "5cfa239565f44fb0c69f0745a5a6a195673613c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "97f46a6d_1c2e3efb",
        "filename": "src/libANGLE/renderer/ProgramImpl.h",
        "patchSetId": 1
      },
      "lineNbr": 62,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2024-03-22T11:36:06Z",
      "side": 1,
      "message": "\u003e I think we should revert the SubTask-\u003ePostLinkTask change...These tasks are actually part of link\n\nok, maybe im not seeing it. Could you elaborate on what makes them \"part of link\". In what way do they impact frontend state / link status?\n\n\u003e for every backend except for Vulkan\n\nI think we should have them both for well defined separation of expectations.\nBackends can create either `LinkSubTask` or `PostLinkTask` or both and frontend guarantees to wait on all `LinkSubTask` during `resolveLink` and will wait on `PostLinkTask` only for a relink and draw use",
      "parentUuid": "ea6747a6_28a23b7a",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 62,
        "endChar": 62
      },
      "revId": "5cfa239565f44fb0c69f0745a5a6a195673613c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7bac2b78_d4712c6e",
        "filename": "src/libANGLE/renderer/ProgramImpl.h",
        "patchSetId": 1
      },
      "lineNbr": 62,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-03-22T13:09:56Z",
      "side": 1,
      "message": "\u003e Could you elaborate on what makes them \"part of link\". In what way do they impact frontend state / link status?\n\nIn the metal and d3d backends, the main link task modifies the \"text\" of the shaders with link info, and the subtasks do internal compilation in parallel. Their result ends up ProgramExecutableMtl/D3D. `resolveLink` waits on them, and if they fail, link is considered failing. That\u0027s how they affect both the link result and status.\n\n\u003e Backends can create either LinkSubTask or PostLinkTask or both and frontend guarantees to wait on all LinkSubTask during resolveLink and will wait on PostLinkTask only for a relink and draw use\n\nWe could, but maybe a bit of over engineering? I agree the _front-end_ calling them post-link tasks is perfectly fine instead of \"optional link tasks\". So the type can remain `LinkSubTask`, but the bool return value can be `canSubTasksRunPostLink` or something, then the front-end puts them in `mOptionalPostLinkTasks` and `mOptionalPostLinkTaskWaitableEvents`.",
      "parentUuid": "97f46a6d_1c2e3efb",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 62,
        "endChar": 62
      },
      "revId": "5cfa239565f44fb0c69f0745a5a6a195673613c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4358855e_b2ae97d5",
        "filename": "src/libANGLE/renderer/ProgramImpl.h",
        "patchSetId": 1
      },
      "lineNbr": 62,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2024-03-22T15:26:35Z",
      "side": 1,
      "message": "instead of cramming backend logic into the frontend i am leaning towards bringing back `syncState` so Vulkan backend can handle the warmup task depending on vendor features. WDYT?",
      "parentUuid": "7bac2b78_d4712c6e",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 62,
        "endChar": 62
      },
      "revId": "5cfa239565f44fb0c69f0745a5a6a195673613c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8e81c16a_9731d75e",
        "filename": "src/libANGLE/renderer/ProgramImpl.h",
        "patchSetId": 1
      },
      "lineNbr": 62,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-03-22T15:41:24Z",
      "side": 1,
      "message": "Not sure if that works though, if the front-end is completely unaware that there are post-link tasks running, it risks overwriting link results while that\u0027s happening (for example by not knowing that there\u0027s something to wait on during a relink).\n\nIt may not be ideal, but the concept of a \"post link task\" doesn\u0027t really contain backend logic. Any backend can have such tasks (I suspect the new webgpu backend will eventually do the same warmup thing).",
      "parentUuid": "4358855e_b2ae97d5",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 62,
        "endChar": 62
      },
      "revId": "5cfa239565f44fb0c69f0745a5a6a195673613c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "24440ccb_ebf1ffc1",
        "filename": "src/libANGLE/renderer/ProgramImpl.h",
        "patchSetId": 1
      },
      "lineNbr": 62,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2024-03-22T15:47:00Z",
      "side": 1,
      "message": "\u003e if the front-end is completely unaware that there are post-link tasks running, it risks overwriting link results while that\u0027s happening\n\ni dont mean to remove existing logic of frontend waiting on linksubtasks, that continues to exist. The vulkan backend will have its own tasks that it knows the frontend will never need to wait on. So my proposal would be for Vulkan backend not to return any link subtask to frontend and `ProgramVk::syncState` will ensure that Vulkan backend will wait on warmup before usage by a drawcall\n\n\u003e concept of a \"post link task\" doesn\u0027t really contain backend logic\n\nthe separation i am proposing is so that the frontend should not have to care about any of these \"post link tasks\" since by definition they are required to not affect frontend state / link results",
      "parentUuid": "8e81c16a_9731d75e",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 62,
        "endChar": 62
      },
      "revId": "5cfa239565f44fb0c69f0745a5a6a195673613c5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}