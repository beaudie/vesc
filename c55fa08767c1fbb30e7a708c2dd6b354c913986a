{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "19bba115_3418112d",
        "filename": "src/libANGLE/MemoryShaderCache.cpp",
        "patchSetId": 14
      },
      "lineNbr": 108,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "Please move the compression / decompression to BlobCache, so both this and MemoryProgramCache could share this code (instead of duplicating it).",
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "071d6c35_1db4b75e",
        "filename": "src/libANGLE/MemoryShaderCache.cpp",
        "patchSetId": 14
      },
      "lineNbr": 108,
      "author": {
        "id": 1546684
      },
      "writtenOn": "2022-08-10T18:03:35Z",
      "side": 1,
      "message": "Done. I could not refactor `MemoryProgramCache::putProgram` because of the TODO in that function regarding http://anglebug.com/2516. Something might be wrong here, since that issue has been marked closed as `Fixed`.",
      "parentUuid": "19bba115_3418112d",
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d7895949_9f27dc97",
        "filename": "src/libANGLE/MemoryShaderCache.cpp",
        "patchSetId": 14
      },
      "lineNbr": 133,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "While you\u0027re at it, could you please change this to use `ANGLE_PERF_WARNING`? It would take care of outputting N times and stop repeating. You can adjust `MemoryProgramCache` to use the same. Then get rid of `mIssuedWarnings` and `kWarningLimit`.\n\nThis would also fix the race condition with access to `mIssuedWarnings`",
      "range": {
        "startLine": 124,
        "startChar": 0,
        "endLine": 133,
        "endChar": 9
      },
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5f5d82ad_f030ffb3",
        "filename": "src/libANGLE/MemoryShaderCache.h",
        "patchSetId": 14
      },
      "lineNbr": 53,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "`mutex` unncessary, `BlobCache` is self-protecting.",
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fbfde7d0_6db71fdf",
        "filename": "src/libANGLE/MemoryShaderCache.h",
        "patchSetId": 14
      },
      "lineNbr": 53,
      "author": {
        "id": 1546684
      },
      "writtenOn": "2022-08-11T16:01:17Z",
      "side": 1,
      "message": "The `MemoryProgramCache` actually does use a mutex, although it is stored in `Display` as `mProgramCacheMutex`. After looking at the BlobCache implementation, it appears that the `mBlobCacheMutex` variable is only used in the `BlobCache::putApplication` function, which is only used by the vkPipeline cache in `RendererVk.cpp`. \n\nDo we want to make ANGLE\u0027s BlobCache actually thread-safe by locking the mutex in the normal `BlobCache::get` and `BlobCache::put` functions as well? It seems a little misleading that the mutex is only used in the `putApplication` function.\n\nAlso, I assume that the `ANGLE_PERF_WARNING`/histogram macros aren\u0027t thread-safe, and these are used in the Program and Shader caches. \n\nFinally, it is good to note that the actual BlobCache provided by the android platform is NOT thread-safe: https://cs.android.com/android/platform/superproject/+/master:frameworks/native/opengl/libs/EGL/BlobCache.h",
      "parentUuid": "5f5d82ad_f030ffb3",
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6147c90b_e1c1e56d",
        "filename": "src/libANGLE/Shader.cpp",
        "patchSetId": 14
      },
      "lineNbr": 635,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "This shouldn\u0027t need to be cached in `Shader`. It seems to me the reason is that `resolveCompile` is not passed in the `Context` (from which this can be retrieved).\n\nI realize it\u0027s some manual work, but could you please instead (in a separate CL before this) pipe in `Context` to `resolveCompile` from wherever called, and their callers, and their callers, etc? Then you can retrieve this from `Context` directly.\n\nSee how `Program::resolveLinkImpl` looks like",
      "range": {
        "startLine": 635,
        "startChar": 19,
        "endLine": 635,
        "endChar": 37
      },
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "40df0cc3_85ac313c",
        "filename": "src/libANGLE/Shader.cpp",
        "patchSetId": 14
      },
      "lineNbr": 635,
      "author": {
        "id": 1546684
      },
      "writtenOn": "2022-08-09T17:17:50Z",
      "side": 1,
      "message": "`resolveCompile` is called 30 times throughout `Shader.cpp` for various getters and setters, whereas the analogous `Program::resolveLink(Context*)` is only called twice in `Program.cpp`. Having `Context*` be passed as a parameter to all of these member functions seems to me like a use case for a `Context*`/`Context\u0026` member variable instead. This could perhaps be stored in `mCompilingState` and initialized with the parameter passed to `Shader::compile(Context*)`. This way, we keep this handle local to the compiling process.\n\nI am ok with passing a `Context*` to all of these member functions if you are, just wanted to suggest this alternative before starting on that.",
      "parentUuid": "6147c90b_e1c1e56d",
      "range": {
        "startLine": 635,
        "startChar": 19,
        "endLine": 635,
        "endChar": 37
      },
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "615e4e66_8665e532",
        "filename": "src/libANGLE/Shader.cpp",
        "patchSetId": 14
      },
      "lineNbr": 635,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T18:21:58Z",
      "side": 1,
      "message": "Yes, sorry I realize the task is mundane, but this is how we avoid technical debt ðŸ˜Š",
      "parentUuid": "40df0cc3_85ac313c",
      "range": {
        "startLine": 635,
        "startChar": 19,
        "endLine": 635,
        "endChar": 37
      },
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f28b747f_722b0a68",
        "filename": "src/libANGLE/Shader.cpp",
        "patchSetId": 14
      },
      "lineNbr": 641,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "Again, please use `ANGLE_PERF_WARNING`. Modify `Program.cpp` where this is copied from to do the same.",
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9d0cb62d_eaf305ad",
        "filename": "src/libANGLE/Shader.cpp",
        "patchSetId": 14
      },
      "lineNbr": 935,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "Please at least add a test for each shader type. In each test, try to make sure every state being serialized has some non-zero value, ideally different from any other serialized value. It might help to duplicate the test multiple times and focus on a subset of state in each.\n\nLike the test would save/reload a compute shader with 1 uniform, 2 uniform blocks, 3 SSBOs, etc.",
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9964f2b2_781d75a7",
        "filename": "src/libANGLE/Shader.cpp",
        "patchSetId": 14
      },
      "lineNbr": 948,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "Compute shaders don\u0027t have attributes",
      "range": {
        "startLine": 939,
        "startChar": 0,
        "endLine": 948,
        "endChar": 13
      },
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3236238c_ebd55c30",
        "filename": "src/libANGLE/Shader.cpp",
        "patchSetId": 14
      },
      "lineNbr": 948,
      "author": {
        "id": 1546684
      },
      "writtenOn": "2022-08-10T18:03:35Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9964f2b2_781d75a7",
      "range": {
        "startLine": 939,
        "startChar": 0,
        "endLine": 948,
        "endChar": 13
      },
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f6a408ff_9efd32b9",
        "filename": "src/libANGLE/Shader.cpp",
        "patchSetId": 14
      },
      "lineNbr": 986,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "Fragment shaders don\u0027t have attributes",
      "range": {
        "startLine": 977,
        "startChar": 0,
        "endLine": 986,
        "endChar": 13
      },
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "56c9babc_d1d1c841",
        "filename": "src/libANGLE/Shader.cpp",
        "patchSetId": 14
      },
      "lineNbr": 986,
      "author": {
        "id": 1546684
      },
      "writtenOn": "2022-08-10T18:03:35Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f6a408ff_9efd32b9",
      "range": {
        "startLine": 977,
        "startChar": 0,
        "endLine": 986,
        "endChar": 13
      },
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ce63a1c5_35590780",
        "filename": "src/libANGLE/Shader.cpp",
        "patchSetId": 14
      },
      "lineNbr": 1097,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "Again `ANGLE_PERF_WARNING`. Most if not all of the cache-related warnings here and in Program.cpp should be turned to `ANGLE_PERF_WARNING`, could you please take care of that?\n\nWhen in doubt between WARN and ANGLE_PERF_WARNING, ask yourself these:\n\n- When issued, is it only to warn about performance?\n- Is it useful for users to see the warning every time it happens? Or do they get the idea after it\u0027s logged a couple times?\n\nIf both yes, then `ANGLE_PERF_WARNING`.",
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "db745001_2e7862ea",
        "filename": "src/libANGLE/Shader.h",
        "patchSetId": 14
      },
      "lineNbr": 32,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "This is used only in `Shader.cpp`, so please move it there. And instead of `#define`, put `constexpr uint32_t kShaderCacheIdentifier \u003d ...` in the anonymous namespace at the top of the file.\n\nAlso, nit: unnecessary parentheses are unnecessary",
      "range": {
        "startLine": 32,
        "startChar": 32,
        "endLine": 32,
        "endChar": 44
      },
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fbe3704b_e1226aec",
        "filename": "src/libANGLE/Shader.h",
        "patchSetId": 14
      },
      "lineNbr": 32,
      "author": {
        "id": 1546684
      },
      "writtenOn": "2022-08-10T18:03:35Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "db745001_2e7862ea",
      "range": {
        "startLine": 32,
        "startChar": 32,
        "endLine": 32,
        "endChar": 44
      },
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a12c387d_707e2a74",
        "filename": "src/libANGLE/Shader.h",
        "patchSetId": 14
      },
      "lineNbr": 59,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "Same with these; move to `Shader.cpp` and put in anonymous namespace",
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6519cbcd_7c0331e7",
        "filename": "src/libANGLE/Shader.h",
        "patchSetId": 14
      },
      "lineNbr": 59,
      "author": {
        "id": 1546684
      },
      "writtenOn": "2022-08-10T18:03:35Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a12c387d_707e2a74",
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2149f02c_46b2b069",
        "filename": "src/tests/gl_tests/GLSLTest.cpp",
        "patchSetId": 14
      },
      "lineNbr": 9895,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-08-09T15:27:51Z",
      "side": 1,
      "message": "Sounds like a bug that needs fixing. How does it fail with ASAN? What\u0027s the associated anglebug.com issue?\n\nActually can you just delete this and `treatPlatformWarningsAsErrors`? There are no callers otherwise, and it doesn\u0027t make sense that out of so many tests, only one enables this (and the implementation is also only doing it on Windows 8+). It looks like something that was supposed to be cleaned up but was missed.",
      "range": {
        "startLine": 9895,
        "startChar": 7,
        "endLine": 9895,
        "endChar": 51
      },
      "revId": "c55fa08767c1fbb30e7a708c2dd6b354c913986a",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}