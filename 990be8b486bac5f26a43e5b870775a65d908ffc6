{
  "comments": [
    {
      "key": {
        "uuid": "223b5e5e_e7b0c5c0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 18
      },
      "lineNbr": 0,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T00:04:16Z",
      "side": 1,
      "message": "Thanks!",
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3efe1e85_7d682855",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 18
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T04:25:22Z",
      "side": 1,
      "message": "I\u0027m glad this work became so simple to actually implement!",
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da2222f8_d7a9ef02",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 18
      },
      "lineNbr": 0,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T15:55:32Z",
      "side": 1,
      "message": "It\u0027s smaller, but it\u0027s probably more subtle now ...",
      "parentUuid": "3efe1e85_7d682855",
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2d6bbc9a_1584ad9d",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T04:25:22Z",
      "side": 1,
      "message": "What is the reason for this change? This is an error in my opinion if deferClears is true and previousDeferredClears is not empty.\n\nIt means that some clears were gathered to be flushed right after syncState but weren\u0027t. Here, the attachments have been changed/modified which means it\u0027s too late for those clears to be applied. The fact that there are new clears doesn\u0027t make it ok for the previous clears to not be applied.",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8a783d19_496fd1a0",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T15:55:32Z",
      "side": 1,
      "message": "Here\u0027s one of those subtleties.  Because eglSwapBuffers adds the dirty bit/object, we\u0027re now going down this path that we didn\u0027t used to go down (I forget for which tests).  In fact, when Jamie and I spoke about this approach, he was thinking that we always went down this path for each new frame; but I saw that for the tests I was initially using, this method was never called after the first frame.  Now, it is.\n\nIn watching the code in the debugger, I learned that updateColorAttachment() will process the clears when deferClears is set (which it is).  Thus, I changed the ASSERT.\n\nIs this explanation satisfactory?",
      "parentUuid": "2d6bbc9a_1584ad9d",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6226bc42_38e8afba",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T16:07:49Z",
      "side": 1,
      "message": "Well the ASSERT is meaningless now, so I\u0027d like us to avoid this change.\n\nCan we add a new dirty bit for this very purpose?",
      "parentUuid": "8a783d19_496fd1a0",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "96e841b5_14e6e790",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-09-17T16:19:56Z",
      "side": 1,
      "message": "Ian, what tests fail when you take out this assert change? All of them?",
      "parentUuid": "6226bc42_38e8afba",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b751e98c_cbd03c36",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T16:31:31Z",
      "side": 1,
      "message": "At least the following (as I recall, it\u0027s the 2nd test out of those run):\n\nangle_deqp_gles31_tests --gtest_filter\u003ddEQP.GLES31/functional_separate_shader_validation_es31_* --use-angle\u003dvulkan",
      "parentUuid": "96e841b5_14e6e790",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "48840fac_67318353",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-09-17T17:00:27Z",
      "side": 1,
      "message": "If it\u0027s just those maybe we can dig in to see what\u0027s happening here.",
      "parentUuid": "b751e98c_cbd03c36",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "78a8794f_12c41e71",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T17:06:04Z",
      "side": 1,
      "message": "I\u0027m digging (I saw this in Patchset 8, where you can see other test failures) ... It\u0027s always the 2nd test in a group.  There\u0027s no cleanup between tests.  Thus, anything left over in ANGLE state is there when they go to render the next test.  This apparently always included a deferred clear, and now includes a deferred ANI,\n\nSo, it sounds like my job is to find the bug about why this deferred clear is still there?",
      "parentUuid": "48840fac_67318353",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d9be9a8e_80233e01",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T17:23:36Z",
      "side": 1,
      "message": "If the original bug is fixable, it\u0027s preferred yes.",
      "parentUuid": "78a8794f_12c41e71",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "279f4801_ae9aadf4",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T18:28:27Z",
      "side": 1,
      "message": "The test does a glClear, which syncState turns into a deferred clear.  That clear bit never gets reset by the time we get to eglSwapBuffers(), even though a draw occured.\n\nWell, no the draw didn\u0027t occur.  The test is designed to cause a validation failure, and so syncState gets called, but the ANGLE doesn\u0027t get past the Context::prepareForDraw(), which returns an error.  Therefore, Context::drawElements() returns an error.  The test expects this error.  ANGLE still has a deferred clear.\n\nThe test infrastructure \"postIterate\" code does a eglSwapBuffers(), which now leaves ANGLE with a deferred ANI, which is expected to not have an error (it doesn\u0027t).\n\nThen the next test (which is also trying to cause an error) is started, using ANGLE as-is.  ANGLE has a deferred clear and a deferred ANI.  This is what causes the ASSERT.",
      "parentUuid": "d9be9a8e_80233e01",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d2b2a3c3_0b472230",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-09-17T18:32:07Z",
      "side": 1,
      "message": "What causes prepareForDraw to return an error? Is this the no-op thing that Tim added? We try to catch all validation errors in the validation layer.",
      "parentUuid": "279f4801_ae9aadf4",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "73408ca2_274af335",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T18:35:31Z",
      "side": 1,
      "message": "I\u0027ll look more (the tests aren\u0027t written to make this easy).  The one test is:\n\ndEQP.GLES31/functional_separate_shader_validation_es31_varying_missing_input\n\nThere\u0027s also another test:\n\ndEQP.GLES31/functional_separate_shader_validation_es31_varying_missing_output",
      "parentUuid": "d2b2a3c3_0b472230",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3709a59f_e21a4a41",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T18:42:49Z",
      "side": 1,
      "message": "I had to make a couple of changes previously to make sure nooping is done before prepareForDraw(), for this very same reason. Maybe I missed a spot? The idea generally is that if syncState() is called, the command for which syncState is called should also get called (to take care of flushing the deferred clears, if necessary).",
      "parentUuid": "73408ca2_274af335",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ebac63c8_24cd44b8",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-09-17T18:46:50Z",
      "side": 1,
      "message": "Shabi, exactly my thoughts. Tim added some no-oping that could affect these tests IIRC.",
      "parentUuid": "3709a59f_e21a4a41",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4b746d96_a59de84d",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T18:46:59Z",
      "side": 1,
      "message": "Not sure what you mean by \"nooping\".\n\nProgramPipeline::linkVaryings() is returning false, which causes ProgramPipeline::link() to return angle::Result::Stop.",
      "parentUuid": "3709a59f_e21a4a41",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b7c9e31a_81e90bd9",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T18:50:10Z",
      "side": 1,
      "message": "ProgramPipeline::syncState() sees the Stop, generates GL_INVALID_OPERATION with the error message \"Program pipeline link failed\"",
      "parentUuid": "4b746d96_a59de84d",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ab9531dc_52bdae15",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-09-17T18:55:36Z",
      "side": 1,
      "message": "I see. This is a design bug. ValidateDraw*() should catch the error before sync.",
      "parentUuid": "b7c9e31a_81e90bd9",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8554477d_e81b8d70",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T18:56:37Z",
      "side": 1,
      "message": "BTW, the only reason this is now being seen as a test failure is because deferring vkAcquireNextImageKHR using dirty bits is sending us down the path that has an ASSERT.  Otherwise, the clear from test n would happen during test n+1 (or the clear from draw m would happen during draw m+1).",
      "parentUuid": "b7c9e31a_81e90bd9",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e75c8dd1_5d76eb51",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-09-17T18:56:40Z",
      "side": 1,
      "message": "One idea is to temporarily break this small group of tests while we look at a fix. It would affect our partners though. So we wouldn\u0027t want to leave it broken too long.",
      "parentUuid": "ab9531dc_52bdae15",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "70f1f2a7_0ca4a146",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-09-17T19:03:55Z",
      "side": 1,
      "message": "I\u0027m not sure it\u0027s safe to assume that this is a validation error.   Program linking can fail for a variety of reasons that the validation code can\u0027t/shouldn\u0027t attempt to duplicate.\n\nThere\u0027s probably other cleanup that ANGLE_CONTEXT_TRY() needs to do.",
      "parentUuid": "e75c8dd1_5d76eb51",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e5fc79d8_e07978a7",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-09-17T19:06:07Z",
      "side": 1,
      "message": "Hey Tim, the spec says this is a validation error. Hence validation layer. No ambiguity there. I remember quoting it to you before, would have to look up the exact wording.\n\nThe TRY is for internal errors, often unrecoverable.",
      "parentUuid": "70f1f2a7_0ca4a146",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7fe47243_b02984cf",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T19:09:16Z",
      "side": 1,
      "message": "What should I do?  File a bug (or will Tim/Jamie do)?  Change the expectations file(s) to expect these tests to fail?",
      "parentUuid": "e75c8dd1_5d76eb51",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0cb09a15_8af99450",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T19:17:26Z",
      "side": 1,
      "message": "Could a \"flush deferred clears of current draw buffer\" on link errors at least let us proceed with this change, and allow the fix to be done in a follow up?",
      "parentUuid": "7fe47243_b02984cf",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7ea846fa_30125f54",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-09-17T19:19:59Z",
      "side": 1,
      "message": "Seems hard to implement. Suppressing the tests and fixing seems more straight-forward.",
      "parentUuid": "0cb09a15_8af99450",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "15ebf1a3_7a8aba5a",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-09-17T19:23:35Z",
      "side": 1,
      "message": "Actually, why don\u0027t we just comment out the ASSERT with a TODO to put it back in with the fix?",
      "parentUuid": "7ea846fa_30125f54",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5330ae17_70c94475",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T19:36:20Z",
      "side": 1,
      "message": "\u003e Actually, why don\u0027t we just comment out the ASSERT with a TODO to put it back in with the fix?\n\nSure.  Should I file the bug to put with the TODO?\n\n\u003e Could a \"flush deferred clears of current draw buffer\" ...?\n\nHere\u0027s an idea ... taking advantage of the fact that we\u0027re using subject-observer.  Instead of re-using an existing message (SubjectChanged, which Surface changes to ContentsChanged), what if we make a unique message that tells Framebuffer::onSubjectStateChange to call a new Impl method that says to flush deferred clears (or anything else we need to flush).",
      "parentUuid": "15ebf1a3_7a8aba5a",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "09c713e5_6f52f4b0",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-09-17T19:38:05Z",
      "side": 1,
      "message": "I\u0027m +1 for ASSERT commented out with TODO and new bug. -1 for using a more complicated workaround.",
      "parentUuid": "5330ae17_70c94475",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d5ff8b27_7b0e9bd8",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T19:41:44Z",
      "side": 1,
      "message": "SGTM ... comment-out/TODO/new-bug coming",
      "parentUuid": "09c713e5_6f52f4b0",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fc82d470_af71b01d",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-09-17T19:44:38Z",
      "side": 1,
      "message": "FYI, Shabi filed https://bugs.chromium.org/p/angleproject/issues/detail?id\u003d5063",
      "parentUuid": "d5ff8b27_7b0e9bd8",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0f7f8d76_731973ff",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1716,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T19:57:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fc82d470_af71b01d",
      "range": {
        "startLine": 1716,
        "startChar": 23,
        "endLine": 1716,
        "endChar": 38
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d036d4e8_cc853cae",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 678,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T04:25:22Z",
      "side": 1,
      "message": "Unrelated to this change, but I think there\u0027s a bug here. The other caller of acquireNextSwapchainImage retries on VK_SUBOPTIMAL_KHR and fails if still VK_SUBOPTIMAL_KHR. In that case, it\u0027s ok that mAcquireImageSemaphore and RenderTarget updates for example are conditional to only VK_SUCCESS being returned.\n\nIn this particular case, if VK_SUBOPTIMAL_KHR is returned, the code happily continues running, but mAcquireImageSemaphore is not set, neither is mColorRenderTarget updated.\n\nCould you please create a tracking bug to fix this? I think refactoring the ANI-retry code into a function and calling it here (then expecting VK_SUCCESS) should fix it, i.e. the code that says:\n\n        VkResult result \u003d acquireNextSwapchainImage(contextVk);\n        // If SUBOPTIMAL/OUT_OF_DATE is returned, it\u0027s ok, we just need to recreate the swapchain\n        // before continuing.\n        if (ANGLE_UNLIKELY((result \u003d\u003d VK_ERROR_OUT_OF_DATE_KHR) || (result \u003d\u003d VK_SUBOPTIMAL_KHR)))\n        {\n            ANGLE_TRY(checkForOutOfDateSwapchain(contextVk, true));\n            // Try one more time and bail if we fail\n            result \u003d acquireNextSwapchainImage(contextVk);\n        }\n        ANGLE_VK_TRY(contextVk, result);",
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dff6921a_1b366c62",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 678,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T15:55:32Z",
      "side": 1,
      "message": "I filed https://issuetracker.google.com/issues/168797043",
      "parentUuid": "d036d4e8_cc853cae",
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a406774_2046cecd",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 936,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T04:25:22Z",
      "side": 1,
      "message": "Looks a bit out of place. This function is not calling ANI, so why should it clear this flag? I expected the code that leads to this to have already handled this.\n\nWhat happens if this is removed? I may have missed something, but it looks like the paths that lead to this are:\n\n- Init: mAcquireDeferred is already false, besides it will call ANI right after.\n- checkForOutOfDateSwapchain: immediately calls ANI after, which sets this to false on success",
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "10e5be94_51c4fe2f",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 936,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T15:55:32Z",
      "side": 1,
      "message": "Done\n\nYou\u0027re correct, thanks.  I had added it here before I simplified things and no longer needed it here.",
      "parentUuid": "7a406774_2046cecd",
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "840ae67f_d4ef8ee4",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1338,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T04:25:22Z",
      "side": 1,
      "message": "I would reword this a bit so it\u0027s less about the tests and more about the condition in which it is called:\n\n\u003e The image may not have been already acquired if there was no rendering done at all to the default framebuffer in this frame, for example if all rendering was done to FBOs.",
      "range": {
        "startLine": 1336,
        "startChar": 58,
        "endLine": 1338,
        "endChar": 86
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b53bf7a_10160dc6",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1338,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T15:55:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "840ae67f_d4ef8ee4",
      "range": {
        "startLine": 1336,
        "startChar": 58,
        "endLine": 1338,
        "endChar": 86
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9877ac1a_c3bd4de9",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1364,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T04:25:22Z",
      "side": 1,
      "message": "DIRTY_BIT_COLOR_ATTACHMENT_0 is actually what gets processed first, not DIRTY_BIT_COLOR_BUFFER_CONTENTS_0. However, that\u0027s ok since the attachments of the default framebuffer cannot change (so that dirty bit doesn\u0027t apply to the default framebuffer). I\u0027d incorporate this information in the comment to be more precise.",
      "range": {
        "startLine": 1364,
        "startChar": 28,
        "endLine": 1364,
        "endChar": 61
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "49ac50d4_6640ff09",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1364,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T15:55:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9877ac1a_c3bd4de9",
      "range": {
        "startLine": 1364,
        "startChar": 28,
        "endLine": 1364,
        "endChar": 61
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7305177e_36dfc4f7",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1408,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T04:25:22Z",
      "side": 1,
      "message": "Might as well have just used mAcquireDeferred everywhere instead of this function. If you like the function name better, you could call the variable mNeedToAcquireNextSwapchainImage ;)",
      "range": {
        "startLine": 1405,
        "startChar": 0,
        "endLine": 1408,
        "endChar": 1
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7ea3d157_f859d4e2",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.cpp",
        "patchSetId": 18
      },
      "lineNbr": 1408,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T15:55:32Z",
      "side": 1,
      "message": "Done.\n\nI originally used the variable, but \u003cstory omitted\u003e:-).",
      "parentUuid": "7305177e_36dfc4f7",
      "range": {
        "startLine": 1405,
        "startChar": 0,
        "endLine": 1408,
        "endChar": 1
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4804e6ad_81cc38ba",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.h",
        "patchSetId": 18
      },
      "lineNbr": 273,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T04:25:22Z",
      "side": 1,
      "message": "suggest: scheduled to be",
      "range": {
        "startLine": 273,
        "startChar": 23,
        "endLine": 273,
        "endChar": 24
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7b3fa809_35ce0bc2",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.h",
        "patchSetId": 18
      },
      "lineNbr": 273,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T15:55:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4804e6ad_81cc38ba",
      "range": {
        "startLine": 273,
        "startChar": 23,
        "endLine": 273,
        "endChar": 24
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "58063ac5_5e6f8604",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.h",
        "patchSetId": 18
      },
      "lineNbr": 276,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T04:25:22Z",
      "side": 1,
      "message": "typo: acquireNextSwapchainImage",
      "range": {
        "startLine": 276,
        "startChar": 7,
        "endLine": 276,
        "endChar": 28
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d8b7c67e_8476729c",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.h",
        "patchSetId": 18
      },
      "lineNbr": 276,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T15:55:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "58063ac5_5e6f8604",
      "range": {
        "startLine": 276,
        "startChar": 7,
        "endLine": 276,
        "endChar": 28
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "61cc0895_ee549d80",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.h",
        "patchSetId": 18
      },
      "lineNbr": 278,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-17T04:25:22Z",
      "side": 1,
      "message": "suggest: Called when a swapchain image whose acquisition was deferred must be acquired.\n\n`later` is confusing out of context of this change. Later than what?",
      "range": {
        "startLine": 278,
        "startChar": 7,
        "endLine": 278,
        "endChar": 67
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "16fe9009_8087378c",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.h",
        "patchSetId": 18
      },
      "lineNbr": 278,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-17T15:55:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "61cc0895_ee549d80",
      "range": {
        "startLine": 278,
        "startChar": 7,
        "endLine": 278,
        "endChar": 67
      },
      "revId": "990be8b486bac5f26a43e5b870775a65d908ffc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}