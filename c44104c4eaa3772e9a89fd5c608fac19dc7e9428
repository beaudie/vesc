{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9bf7d079_fd9d1e0b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-01-12T15:52:03Z",
      "side": 1,
      "message": "Without any data on performance it doesn\u0027t seem like this is a convincing win. LGTM in any case.",
      "revId": "c44104c4eaa3772e9a89fd5c608fac19dc7e9428",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "022194c3_1fe3cbee",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2022-01-19T17:34:50Z",
      "side": 1,
      "message": "Here is data comparing this CL to main:\nhttps://docs.google.com/spreadsheets/d/1--lYkf1pkW3cdUzZ43le1AFXCUunPeLZ-63d3VZjDas/edit?usp\u003dsharing\n\nIt\u0027s within noise, so I\u0027d prefer to go with this change and iterate on it, since this is what\u0027s recommended (versus resetting command buffers individually).",
      "parentUuid": "9bf7d079_fd9d1e0b",
      "revId": "c44104c4eaa3772e9a89fd5c608fac19dc7e9428",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "805a5eaa_33794a1a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-01-20T21:48:35Z",
      "side": 1,
      "message": "\u003e It\u0027s within noise\n\nI would have expected to see red and green mixed together in that case, but it seems like the CL is introducing 2~5% regression in most apps. Is that with VK_COMMAND_POOL_CREATE_RESET_COMMAND_BUFFER_BIT removed? Maybe we need a few more runs to be sure it\u0027s noise? Are those runs with minimized GPU work?\n\nOtherwise it may be that the cost ARM docs are talking about are actually not that much, and ANGLE\u0027s tracking of CB usage is actually slower than that.",
      "parentUuid": "022194c3_1fe3cbee",
      "revId": "c44104c4eaa3772e9a89fd5c608fac19dc7e9428",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5ba26f03_f0dcd614",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2022-01-21T00:37:23Z",
      "side": 1,
      "message": "\u003e I would have expected to see red and green mixed together in that case, but it seems like the CL is introducing 2~5% regression in most apps.\n\nThere are 2 runs in the sheet, with the first column compared to the second column and reported in the \"Relative Performance\" column.   At the very end of the data is an \"Overall Difference\" value, which averages all of the \"Relative Performance\" values.   \n\nI swap the run order in both runs to show run-to-run variance, but mostly just look at the \"Overall Difference\" value to see how a CL behaves.   In this case we have:\n\nCompare CL to main:\n  Overall Difference \u003d 0.974422\nCompare main to CL:\n  Overall Difference \u003d 1.035983\n  \nMore runs are likely to land within this range, and ultimately tell us nothing new.\n\n\u003e Is that with VK_COMMAND_POOL_CREATE_RESET_COMMAND_BUFFER_BIT removed? \nYes.\n\n\u003e Are those runs with minimized GPU work?\nYes, with the power denoising, locked GPU clocks, etc.\n\n\u003e Otherwise it may be that the cost ARM docs are talking about are actually not that much, and ANGLE\u0027s tracking of CB usage is actually slower than that.\n\nARM doesn\u0027t claim much of an improvement.   Their tutorial goes from 21.7ms to 21.4ms per frame when resetting command pools:\nhttps://github.com/ARM-software/vulkan_best_practice_for_mobile_developers/blob/master/samples/performance/command_buffer_usage/command_buffer_usage_tutorial.md#Recycling-strategies\n\nI still think we should do what they recommend and iterate on it, but we can abandon this if you guys think it\u0027s not worth it.",
      "parentUuid": "805a5eaa_33794a1a",
      "revId": "c44104c4eaa3772e9a89fd5c608fac19dc7e9428",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "857590f9_9e60c652",
        "filename": "src/libANGLE/renderer/vulkan/PersistentCommandPool.h",
        "patchSetId": 4
      },
      "lineNbr": 48,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-01-12T15:52:03Z",
      "side": 1,
      "message": "this makes it sound like there\u0027s something broken with the buffers. Suggest a different name. Maybe mFinishedBuffers?",
      "range": {
        "startLine": 48,
        "startChar": 42,
        "endLine": 48,
        "endChar": 57
      },
      "revId": "c44104c4eaa3772e9a89fd5c608fac19dc7e9428",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "df29a514_83f41aa2",
        "filename": "src/libANGLE/renderer/vulkan/PersistentCommandPool.h",
        "patchSetId": 4
      },
      "lineNbr": 48,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2022-01-19T17:34:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "857590f9_9e60c652",
      "range": {
        "startLine": 48,
        "startChar": 42,
        "endLine": 48,
        "endChar": 57
      },
      "revId": "c44104c4eaa3772e9a89fd5c608fac19dc7e9428",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}