{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3c1d7a50_85809a83",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1520902
      },
      "writtenOn": "2023-04-13T04:31:14Z",
      "side": 1,
      "message": "Hi Shabi, thank you a lot for your help offline. As mentioned last time, the change will result some render results difference: https://angle-gold.skia.org/search?issue\u003d4400404\u0026crs\u003dgerrit\u0026patchsets\u003d8\u0026corpus\u003dangle.\n\nHow to determine if such difference is acceptable?",
      "revId": "dde74be3b5f8ea68291b9f45a2f08a59c3981fc4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "258324ff_6a30347d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1520902
      },
      "writtenOn": "2023-04-13T04:31:39Z",
      "side": 1,
      "message": "leave the comment as unresolved.",
      "parentUuid": "3c1d7a50_85809a83",
      "revId": "dde74be3b5f8ea68291b9f45a2f08a59c3981fc4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "146cc411_00279cde",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2023-04-14T01:32:37Z",
      "side": 1,
      "message": "Most of the diffs look perfectly fine. Except the water reflection in asphalt_8 which has visibly lower quality. I\u0027d check with native to see how the reflection looks like there. I\u0027ll leave it to @Cody to tell if that\u0027s acceptable (it _is_ in my opinion, because we are respective the user\u0027s choice of mediump more strongly now)\n\nThat said, I\u0027d take the traces with the biggest diffs (car_chase, black_desert_mobile, manhattan_31, portal_knights and aztec_ruins_high) and do a before/after comparison of performance. Is this change improving or degrading the performance in any measurable way?",
      "parentUuid": "258324ff_6a30347d",
      "revId": "dde74be3b5f8ea68291b9f45a2f08a59c3981fc4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4c7e6c24_2427b0e3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1256237
      },
      "writtenOn": "2023-04-14T02:01:54Z",
      "side": 1,
      "message": "Yeah, trace diffs look plausible except for `asphalt_8`, which looks worse.  Comparing to native is a good idea.\n`car_chase` also gives pause, but still looks okay.\nI don\u0027t think I\u0027d block any of the diffs though.",
      "parentUuid": "146cc411_00279cde",
      "revId": "dde74be3b5f8ea68291b9f45a2f08a59c3981fc4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "db2f3b15_d23adcb5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1520902
      },
      "writtenOn": "2023-04-17T22:23:12Z",
      "side": 1,
      "message": "Thank you Shabi and Cody for checking the rendering diffs.\n\nThe trace results before and after this change is here https://docs.google.com/spreadsheets/d/1PNnb83pAgFgbsyo4VskDZqhHNhduq7cugVEfi13IWUU/edit?usp\u003dsharing. On Pixel 7, after the change, most of the traces `wall time compare` improved. On Pixel 6, more than half of the traces `wall time compare` degraded. The change of `wall time compare` and `CPU time compare` is consistent: if `CPU time` improved after change, the `wall time` improved, too. Since the GPU measurement on ARM is broken right now, I can\u0027t get the GPU perf data with the current trace test. Any recommendations on how to get GPU perf impact? Charlie has recommended \nme `writing a specific test that runs shader on a large FBO and benchmark the rendering operation`. Would you please let me know if this is necessary?\n\nI have compared the native and angle results of the 16 traces that failed the test: https://docs.google.com/document/d/1ot9UAPBPGMfKAXkQZx24WujStAZdDOYeZKWW57QuwFg/edit?usp\u003dsharing. Most of the diffs match with the diffs that is flagged by the golden trace tests. The `asphalt_8` water rendering on native is closer to the reference image in Gold test, unfortunately. If this is a concern, how should we proceed here? Shall I debug it in RenderDoc and understand why the change is making the rendering more pixelated?",
      "parentUuid": "4c7e6c24_2427b0e3",
      "revId": "dde74be3b5f8ea68291b9f45a2f08a59c3981fc4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fefb08cd_8f37392f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1256237
      },
      "writtenOn": "2023-04-17T22:36:31Z",
      "side": 1,
      "message": "\u003e On Pixel 7, after the change, most of the traces wall time compare improved. On Pixel 6, more than half of the traces wall time compare degraded.\n\nI commented on the doc, but the variance is too high to draw any conclusions.  Need to run more iterations, possibly for longer duration.\n\n\u003e The asphalt_8 water rendering on native is closer to the reference image in Gold test, unfortunately.\n\nThis is really odd.  The native driver is matching previous ANGLE results.  It could be the native driver is keeping the higher precision, but Vulkan is forcing it lower.",
      "parentUuid": "db2f3b15_d23adcb5",
      "revId": "dde74be3b5f8ea68291b9f45a2f08a59c3981fc4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1c72f370_8a2c2f39",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2023-04-18T02:15:46Z",
      "side": 1,
      "message": "\u003e The change of wall time compare and CPU time compare is consistent: if CPU time improved after change, the wall time improved\n\nThen really that means the measurements were not stable; this change should not really affect CPU perf in any way. Just eyeballing the data, it looks like there\u0027s no significant effect on the GPU perf IMO.\n\n\u003e Charlie has recommended me ...\n\nAny effect on the perf would really only be visible on complex shaders where this forces the compiler to use more fp16 than it otherwise would. Chances are it\u0027s already using fp16 to a large degree. IMO it\u0027s pretty obvious already that the effect of this on perf is negligible, so I\u0027m ok with moving on.\n\n\u003e This is really odd. The native driver is matching previous ANGLE results. It could be the native driver is keeping the higher precision, but Vulkan is forcing it lower.\n\nThe native driver matches previous ANGLE results because ARM made the same decisions for mediump as RelaxedPrecision (so they aren\u0027t forcing it lower). It\u0027s this change in particular that\u0027s forcing the precision lower, which is exactly its intended behavior.\n\n\u003e If this is a concern, how should we proceed here? Shall I debug it in RenderDoc and understand why the change is making the rendering more pixelated?\n\nThis is not a concern IMO, the application asked for mediump and we delivered fp16, that\u0027s well within our rights. And the difference in rendering is not going to be noticeable, especially with everything passing by so quickly in a racing game like that!\n\nAnd no, there\u0027s no reason for debugging; obviously with lower precision rendering gets less smooth.\n\n---\n\nTL;DR, I\u0027m satisfied with the change",
      "parentUuid": "fefb08cd_8f37392f",
      "revId": "dde74be3b5f8ea68291b9f45a2f08a59c3981fc4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}