{
  "comments": [
    {
      "key": {
        "uuid": "f69d5121_7cc97742",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-18T16:53:23Z",
      "side": 1,
      "message": "how about you change this to #if !defined(ANGLE_ENABLE_OPENGL) \u0026\u0026 defined(ANGLE_ENABLE_VULKAN) and resolve the TODO right away.",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "857e5a6b_f4088835",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2020-06-18T16:56:11Z",
      "side": 1,
      "message": "but as per shabi there are no bots that can test this. If ANGLE for Android is always built for both backends this condition will never be true and we wont use the ASM code. Is that not the case?",
      "parentUuid": "f69d5121_7cc97742",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "474684d0_d5ca3e4e",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-18T17:08:19Z",
      "side": 1,
      "message": "To clarify:\n\n #if defined(ANGLE_PLATFORM_ANDROID)\n #if defined(ANGLE_ENABLE_OPENGL) || !defined(ANGLE_ENABLE_VULKAN)\n if (gUseAndroidOpenGLTlsSlot)\n #endif\n {\n    return \"the TLS\"\n }\n #endif",
      "parentUuid": "857e5a6b_f4088835",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e0edc6ae_8e21ddde",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-18T17:09:17Z",
      "side": 1,
      "message": "Note that you might have to rejigger the code to avoid unreachable. I\u0027m fine if you just test it locally. We won\u0027t have CI coverage for this for quite some time.",
      "parentUuid": "474684d0_d5ca3e4e",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c9575588_b6f347f4",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2020-06-18T20:39:30Z",
      "side": 1,
      "message": "will this condition ever be true with current android build scripts -\u003e \"#if defined(ANGLE_ENABLE_OPENGL) || !defined(ANGLE_ENABLE_VULKAN)\"\n\nIMO, it would be much better to circle back and address this when we have actual bots to test this usecase and i can get rid of \"gUseAndroidOpenGLTlsSlot\" entirely. would be the cleaner and clearer path",
      "parentUuid": "e0edc6ae_8e21ddde",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4ecf439b_4b85ae98",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-18T20:57:37Z",
      "side": 1,
      "message": "We will not be able to get rid of the TLS slot entirely because of how we test and ship ANGLE for Chrome on Android. So there\u0027s a good argument for resolving the TODO now with this simple trick.",
      "parentUuid": "c9575588_b6f347f4",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f1d29ca7_55d8114f",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2020-06-19T00:44:12Z",
      "side": 1,
      "message": "after trying out multiple combinations it looks like, with a clean ANGLE, there wont be a way to avoid the run-time if-check. We will need to have a local patch to \"roll_aosp.sh\".",
      "parentUuid": "4ecf439b_4b85ae98",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9c0ca9c1_f5c394fe",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1263724
      },
      "writtenOn": "2020-06-19T02:10:31Z",
      "side": 1,
      "message": "We can change the Android build of ANGLE to build like that. Right now we are defining both ANGLE_ENABLE_OPENGL and ANGLE_ENABLE_VULKAN but we shouldn\u0027t have to. That would get us testing that way on Android at least.",
      "parentUuid": "f1d29ca7_55d8114f",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1502ea36_c521d74a",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-19T12:46:54Z",
      "side": 1,
      "message": "We cannot do that in Chrome CI which is why I said we can\u0027t have bots like that. We could change something Android-side post-commit.",
      "parentUuid": "9c0ca9c1_f5c394fe",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bd01d8b5_e37373e9",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2020-06-19T14:57:33Z",
      "side": 1,
      "message": "is it possible to request the chrome people to define a \"__CHROME__\" macro in their build system so ANGLE can make use of it?",
      "parentUuid": "1502ea36_c521d74a",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3f0fd41_b3e11a10",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-19T15:22:04Z",
      "side": 1,
      "message": "I don\u0027t see why you need it. Anyway we should either land this or figure out what got you stuck on implementing my suggestion. I don\u0027t see what would stop you.",
      "parentUuid": "bd01d8b5_e37373e9",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a5f61476_2276bab4",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2020-06-19T15:43:01Z",
      "side": 1,
      "message": "\u003e I don\u0027t see why you need it\n\ni was under the impression that a chrome specific usecase was the blocker and thought that separating ANGLE build for chrome and ANGLE build for Android was one way out. may be it isnt that straight forward\n\n\u003e what got you stuck on implementing my suggestion. I don\u0027t see what would stop you.\n\nI did implement the suggestion but since both ANGLE_ENABLE_OPENGL and ANGLE_ENABLE_VULKAN were always defined for my android build the if-check was always performed. There was no value add by that code\n\n\u003e Anyway we should either land this or figure out ...\n\nI\u0027m fine landing this as-is, i have a todo in place for further optimization. Courtney/Geoff please leave a comment on the todo bug when the infra is in place and i will upload a change",
      "parentUuid": "d3f0fd41_b3e11a10",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2441aeec_21e6fe17",
        "filename": "src/libGLESv2/global_state.h",
        "patchSetId": 4
      },
      "lineNbr": 46,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-06-19T15:54:55Z",
      "side": 1,
      "message": "Definitely wouldn\u0027t want a special CHROME build flag. The point here is that if the OpenGL backend is built, the test must be here, if not it can be optimized out. Vulkan being built is irrelevant IMO. It should be as simple as:\n\n    #if defined(ANGLE_PLATFORM_ANDROID)\n    #if defined(ANGLE_ENABLE_OPENGL)\n        if (gUseAndroidOpenGLTlsSlot)\n    #endif\n        {\n            return ...;\n        }\n    #endif\n\n@Mohan, set `angle_enable_gl\u003dfalse` in your `args.gn` so you wouldn\u0027t build the GL backend. Then ANGLE_ENABLE_OPENGL is no longer defined (see BUILD.gn):\n\n    if (angle_enable_gl) {\n      defines +\u003d [ \"ANGLE_ENABLE_OPENGL\" ]\n      if (angle_enable_gl_null) {\n        defines +\u003d [ \"ANGLE_ENABLE_OPENGL_NULL\" ]\n      }\n    }",
      "parentUuid": "a5f61476_2276bab4",
      "range": {
        "startLine": 46,
        "startChar": 59,
        "endLine": 46,
        "endChar": 83
      },
      "revId": "01a093d3dd48cdb24f7bbf25e53b020630dc58a1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}