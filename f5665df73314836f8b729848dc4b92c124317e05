{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "441851d8_683a3e69",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1105344
      },
      "writtenOn": "2022-02-25T03:40:55Z",
      "side": 1,
      "message": "Testing on the M1 with:\n\nMTL_DEBUG_LAYER\u003d1 MTL_DEBUG_LAYER_VALIDATE_LOAD_ACTIONS\u003d1 MTL_DEBUG_LAYER_VALIDATE_STORE_ACTIONS\u003d1 MTL_DEBUG_LAYER_VALIDATE_UNRETAINED_RESOURCES\u003d4 out/Debug/angle_deqp_gles3_tests --use-angle\u003dmetal --gtest_filter\u003ddEQP.GLES3/functional_fbo_invalidate\\*\n\nwill follow up with confirmed results.\n",
      "revId": "f5665df73314836f8b729848dc4b92c124317e05",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "953c93cd_dd5a1c48",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1105344
      },
      "writtenOn": "2022-02-25T03:59:41Z",
      "side": 1,
      "message": "I can\u0027t confirm that this CL fixes the tests in question on the M1.\n\nWith no Metal validation layers or load/store action validation enabled, these tests pass on the M1 at top-of-tree without this CL.\n\nEven with this CL, this run:\n\nMTL_DEBUG_LAYER\u003d1 MTL_DEBUG_LAYER_VALIDATE_LOAD_ACTIONS\u003d1 MTL_DEBUG_LAYER_VALIDATE_STORE_ACTIONS\u003d1 MTL_DEBUG_LAYER_VALIDATE_UNRETAINED_RESOURCES\u003d4 out/Debug/angle_deqp_gles3_tests --use-angle\u003dmetal --gtest_filter\u003ddEQP.GLES3/functional_fbo_invalidate\\*\n\nhas the following failures:\n\n[  FAILED  ] 15 tests, listed below:\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_default_render_color, where GetParam() \u003d 32748\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_default_bind_color, where GetParam() \u003d 32753\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_default_draw_framebuffer_color, where GetParam() \u003d 32768\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_default_read_framebuffer_color, where GetParam() \u003d 32770\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_whole_render_color, where GetParam() \u003d 32773\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_whole_unbind_read_color, where GetParam() \u003d 32778\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_whole_unbind_read_color_stencil, where GetParam() \u003d 32782\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_whole_unbind_blit_color, where GetParam() \u003d 32783\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_whole_unbind_blit_msaa_color, where GetParam() \u003d 32787\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_target_framebuffer_framebuffer_color, where GetParam() \u003d 32851\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_target_framebuffer_draw_framebuffer_color, where GetParam() \u003d 32857\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_target_read_framebuffer_framebuffer_color, where GetParam() \u003d 32860\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_target_read_framebuffer_read_framebuffer_color, where GetParam() \u003d 32863\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_target_draw_framebuffer_framebuffer_color, where GetParam() \u003d 32869\n[  FAILED  ] dEQP.GLES3/functional_fbo_invalidate_target_draw_framebuffer_draw_framebuffer_color, where GetParam() \u003d 32875\n\nAdditionally, the WebGL conformance tests:\nhttps://www.khronos.org/registry/webgl/sdk/tests/deqp/functional/gles3/fboinvalidate/sub.html\nhttps://www.khronos.org/registry/webgl/sdk/tests/deqp/functional/gles3/fboinvalidate/whole.html\n\nwhich are suppressed in the Chromium-side webgl2_conformance_expectations.txt seem to be passing on top-of-tree Chromium with ANGLE\u0027s Metal backend on the M1 with or without this CL.\n",
      "revId": "f5665df73314836f8b729848dc4b92c124317e05",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "44558a10_90e3e59f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1105344
      },
      "writtenOn": "2022-02-25T04:01:20Z",
      "side": 1,
      "message": "Note also: this doesn\u0027t fix https://bugs.webkit.org/show_bug.cgi?id\u003d237113 .\n",
      "revId": "f5665df73314836f8b729848dc4b92c124317e05",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "98ce4d95_67acb239",
        "filename": "src/libANGLE/renderer/metal/FrameBufferMtl.mm",
        "patchSetId": 1
      },
      "lineNbr": 1179,
      "author": {
        "id": 1500872
      },
      "writtenOn": "2022-02-15T22:00:21Z",
      "side": 1,
      "message": "I need to remove this line. This was from an earlier attempt.",
      "revId": "f5665df73314836f8b729848dc4b92c124317e05",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7f6f2676_9f02143e",
        "filename": "src/libANGLE/renderer/metal/FrameBufferMtl.mm",
        "patchSetId": 1
      },
      "lineNbr": 1304,
      "author": {
        "id": 1105284
      },
      "writtenOn": "2022-02-17T18:28:39Z",
      "side": 1,
      "message": "what about `ensureStoreOpsSetForClears`?",
      "range": {
        "startLine": 1304,
        "startChar": 30,
        "endLine": 1304,
        "endChar": 56
      },
      "revId": "f5665df73314836f8b729848dc4b92c124317e05",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "139aae2a_0a488999",
        "filename": "src/libANGLE/renderer/metal/FrameBufferMtl.mm",
        "patchSetId": 1
      },
      "lineNbr": 1304,
      "author": {
        "id": 1500872
      },
      "writtenOn": "2022-03-24T15:58:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7f6f2676_9f02143e",
      "range": {
        "startLine": 1304,
        "startChar": 30,
        "endLine": 1304,
        "endChar": 56
      },
      "revId": "f5665df73314836f8b729848dc4b92c124317e05",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e48325dc_aeb2a2f6",
        "filename": "src/libANGLE/renderer/metal/FrameBufferMtl.mm",
        "patchSetId": 1
      },
      "lineNbr": 1320,
      "author": {
        "id": 1105284
      },
      "writtenOn": "2022-02-17T18:28:39Z",
      "side": 1,
      "message": "Can this be refactored into a function like:\n\n```gl::DrawBufferMask getDrawBuffersWithClearAndNoStore(...)```\n\nThis can then be tested here with `.any()` and iterated quickly later when updating.\n\nYou could possibly refactor the depth and stencil checks too to reduce code duplication but it\u0027s a bit less impactful.",
      "range": {
        "startLine": 1309,
        "startChar": 0,
        "endLine": 1320,
        "endChar": 5
      },
      "revId": "f5665df73314836f8b729848dc4b92c124317e05",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}