{
  "comments": [
    {
      "key": {
        "uuid": "2d5fadc8_0a6771b5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-09-08T20:09:58Z",
      "side": 1,
      "message": "I end up flushing the deferred glFlsuh at the boundary of Draw FBO switch. Otherwise I am seeing perf regression on TRex and Manhattan. Without a more sophsicated GPU progress checking and proactively do implicit submission as soon as we see GOU runs low on work, I think this is the right balance to fix the manhattan\u0027s in-FBO glFlush without triggering offline perf regression. This essentially limit the glFlush noop for the glFlush calls that are called within the same draw FBO. ",
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8d5ec692_5182e76f",
        "filename": "include/platform/FeaturesVk.h",
        "patchSetId": 6
      },
      "lineNbr": 371,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-09-08T23:26:31Z",
      "side": 1,
      "message": "https://issuetracker.google.com\n\nb/ isn\u0027t accessible off-corp, so each of the b/ links in this CL should be updated also.",
      "range": {
        "startLine": 371,
        "startChar": 14,
        "endLine": 371,
        "endChar": 15
      },
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e97bd976_096450ec",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 6
      },
      "lineNbr": 675,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-09-08T23:26:31Z",
      "side": 1,
      "message": "Just for consistency:\n\n  mDeferredFlushCount(0),",
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fbdc0ff2_b907856c",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 6
      },
      "lineNbr": 987,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-09-08T23:22:29Z",
      "side": 1,
      "message": "Drive by: Can something like the new SecondaryCommandBuffer::getCommandBufferSize() method help you create that finer-grain check?",
      "range": {
        "startLine": 987,
        "startChar": 33,
        "endLine": 987,
        "endChar": 98
      },
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05277928_8045e516",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 6
      },
      "lineNbr": 987,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-09-09T00:35:51Z",
      "side": 1,
      "message": "No, that only know how many commands we accumulate. What I need to do is how many commands is pending GPU execution. Basically we need to know where in the command buffer GPU has been finished, and how much left for execution.",
      "parentUuid": "fbdc0ff2_b907856c",
      "range": {
        "startLine": 987,
        "startChar": 33,
        "endLine": 987,
        "endChar": 98
      },
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55a7aef5_f5243efd",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 6
      },
      "lineNbr": 994,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-09-08T22:07:00Z",
      "side": 1,
      "message": "This will also removed before push to repository.",
      "range": {
        "startLine": 994,
        "startChar": 8,
        "endLine": 994,
        "endChar": 41
      },
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a16ceb88_b1362ea0",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 6
      },
      "lineNbr": 1830,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-09-08T23:26:31Z",
      "side": 1,
      "message": "Can you do:\n\n  mDeferredFlushCount \u003d kDeferredFlushMaxCount;\n\nso that the only the next glFlush is forced to occur, but we then return to deferring after that?",
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dae85379_eaba2232",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 6
      },
      "lineNbr": 1830,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-09-09T00:35:51Z",
      "side": 1,
      "message": "We can. The only concern is that it may create some confusion when people debug it.\nMaybe I can set it to UINT32_MAX in this case.",
      "parentUuid": "a16ceb88_b1362ea0",
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "63c63213_92fc71b7",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 6
      },
      "lineNbr": 3046,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-09-08T23:26:31Z",
      "side": 1,
      "message": "Is this something you\u0027re seeing in apps now, or can we wait to include this block of code until we actually see a problem?   I\u0027d prefer to just rely on the normal command submission as much as possible if we can.",
      "range": {
        "startLine": 3044,
        "startChar": 0,
        "endLine": 3046,
        "endChar": 50
      },
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55a39cd1_ffcda3b0",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 6
      },
      "lineNbr": 3046,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-09-09T00:35:51Z",
      "side": 1,
      "message": "Without this line, you see (quite big) performance regression on TRex and Manhattan offscreen scores, since offscreen benchmark uses glFlush for frame boundary. This essentially make sure that offscreen behavior remains the same.",
      "parentUuid": "63c63213_92fc71b7",
      "range": {
        "startLine": 3044,
        "startChar": 0,
        "endLine": 3046,
        "endChar": 50
      },
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "88a1e8e9_fc91cbb3",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 6
      },
      "lineNbr": 4982,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-09-08T23:26:31Z",
      "side": 1,
      "message": "This line can be removed using the mDeferredFlushCount \u003d kDeferredFlushMaxCount trick I mentioned.",
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "35be811b_53c6b6a2",
        "filename": "src/libANGLE/renderer/vulkan/RendererVk.cpp",
        "patchSetId": 6
      },
      "lineNbr": 1867,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-09-08T21:42:36Z",
      "side": 1,
      "message": "Note: This will change to IsAndroid() before push to repository. I forced to true just try to get full bots coverage.",
      "range": {
        "startLine": 1867,
        "startChar": 61,
        "endLine": 1867,
        "endChar": 81
      },
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "20607e3f_0ff7610c",
        "filename": "src/libANGLE/renderer/vulkan/SyncVk.cpp",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-09-08T23:26:31Z",
      "side": 1,
      "message": "nit: Something like \u0027forceNextFlush()\u0027 would be a bit more descriptive since resetDeferredFlush() will always attempt to re-enable it (and there is no corresponding enabledDeferredFlush()).",
      "range": {
        "startLine": 60,
        "startChar": 15,
        "endLine": 60,
        "endChar": 35
      },
      "revId": "0643c79d8828e07ab070938ddb9178d34ba596ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}