{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "a85e10a5_bc74cf2c",
        "filename": "src/libANGLE/renderer/vulkan/SyncVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 324,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-01-14T12:19:13Z",
      "side": 0,
      "message": "I think the point of the flush was to make this next semaphore work correctly. With the flush removed, the GPU wait is effectively moved back to before whatever has been previously recorded and not yet flushed.\n\nThat\u0027s in the very least more likely to introduce a GPU bubble, but worse, it may introduce a race condition. What if the recorded-but-not-submitted commands have something in them that the serverWait was supposed to barrier against?",
      "revId": "985db64093cf2ee3bfa6dd5614c6904650887e65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2d4452c4_f3c95ee7",
        "filename": "src/libANGLE/renderer/vulkan/SyncVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 324,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-01-14T18:49:04Z",
      "side": 0,
      "message": "\u003e the GPU wait is effectively moved back to before whatever has been previously recorded and not yet flushed\n\u003e That\u0027s in the very least more likely to introduce a GPU bubble, but worse, it may introduce a race condition. What if the recorded-but-not-submitted commands have something in them that the serverWait was supposed to barrier against?\n\nNack\n\nThe idea behind server wait is this -\n1. ContextA generates some workload in threadA\n2. syncA is created with ContextA current\n3. ContextB is current on threadB\n4. app calls serverWait(syncA) on threadB\n\na flush of ContextB serves no purpose",
      "parentUuid": "a85e10a5_bc74cf2c",
      "revId": "985db64093cf2ee3bfa6dd5614c6904650887e65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "50bb8b5d_aaa485ea",
        "filename": "src/libANGLE/renderer/vulkan/SyncVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 324,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-01-14T19:05:41Z",
      "side": 0,
      "message": "The flush of ContextB also flushes whatever ContextA has queued up (at least the way currently ANGLE is set up).\n\nThat said, I agree the flush is not necessary on a second look. When syncA is created, we already add a flush on ContextA (and that was a recent addition, which is what makes this flush no longer necessary).",
      "parentUuid": "2d4452c4_f3c95ee7",
      "revId": "985db64093cf2ee3bfa6dd5614c6904650887e65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5c211530_b6220258",
        "filename": "src/libANGLE/renderer/vulkan/SyncVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 324,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-01-14T19:12:07Z",
      "side": 0,
      "message": "\u003e When syncA is created, we already add a flush on ContextA\n\n+1\n\n\u003e and that was a recent addition\n\ni think it was already there in jeff\u0027s original change -\u003e https://chromium-review.googlesource.com/c/angle/angle/+/2026177/22/src/libANGLE/renderer/vulkan/SyncVk.cpp#185\n\n\u003e which is what makes this flush no longer necessary\n\n+1",
      "parentUuid": "50bb8b5d_aaa485ea",
      "revId": "985db64093cf2ee3bfa6dd5614c6904650887e65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bbac6318_24fb0dfd",
        "filename": "src/libANGLE/renderer/vulkan/SyncVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 324,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-01-14T19:36:16Z",
      "side": 0,
      "message": "\u003e \u003e and that was a recent addition\n\u003e i think it was already there in jeff\u0027s original change\n\nThis is the recent addition I was referring to (which is the flush of ContextA, not ContextB (which was added by Jeff, correctly before flush of ContextA was introduced)): https://chromium-review.googlesource.com/c/angle/angle/+/3200274/7/src/libANGLE/renderer/vulkan/SyncVk.cpp#112",
      "parentUuid": "5c211530_b6220258",
      "revId": "985db64093cf2ee3bfa6dd5614c6904650887e65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4bb9ce89_c05afed0",
        "filename": "src/libANGLE/renderer/vulkan/SyncVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 324,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-01-14T19:41:12Z",
      "side": 0,
      "message": "that code was for \"SyncHelper\" class, not \"SyncHelperNativeFence\" class which is what Android native fence uses, right?",
      "parentUuid": "bbac6318_24fb0dfd",
      "revId": "985db64093cf2ee3bfa6dd5614c6904650887e65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9ccd0470_164e24a2",
        "filename": "src/libANGLE/renderer/vulkan/SyncVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 324,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-01-17T17:55:39Z",
      "side": 0,
      "message": "Ah right. Nevertheless, I see `SyncHelperNativeFence::initializeWithFd` also has a flush, so all\u0027s good.",
      "parentUuid": "4bb9ce89_c05afed0",
      "revId": "985db64093cf2ee3bfa6dd5614c6904650887e65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "55ffd691_d5443a40",
        "filename": "src/libANGLE/renderer/vulkan/SyncVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 324,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-01-18T22:35:52Z",
      "side": 0,
      "message": "üëç",
      "parentUuid": "9ccd0470_164e24a2",
      "revId": "985db64093cf2ee3bfa6dd5614c6904650887e65",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}