{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9cbf8fe3_1fdc470a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-12-23T19:55:04Z",
      "side": 1,
      "message": "PTAL",
      "revId": "3ff5d437fb8f2f9693bb8447e24346592dcb0f21",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b41a8c65_79fc6b43",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-12-23T21:14:52Z",
      "side": 1,
      "message": "Almost there - one question left.",
      "revId": "3ff5d437fb8f2f9693bb8447e24346592dcb0f21",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a2a3c8fe_62f2262e",
        "filename": "src/libANGLE/Context.cpp",
        "patchSetId": 12
      },
      "lineNbr": 5421,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-12-23T21:14:52Z",
      "side": 1,
      "message": "this doesn\u0027t seem quite right - what caches are dirty when you leave this out? the vertex array cache should be updated directly instead of needing a callback.",
      "range": {
        "startLine": 5417,
        "startChar": 0,
        "endLine": 5421,
        "endChar": 5
      },
      "revId": "3ff5d437fb8f2f9693bb8447e24346592dcb0f21",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bedb50c7_053e81b5",
        "filename": "src/libANGLE/Context.cpp",
        "patchSetId": 12
      },
      "lineNbr": 5421,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-12-23T22:12:07Z",
      "side": 1,
      "message": "Here are snippets of the GL calls that FIFA makes, along with some extra TIMTIM logging showing the value of VertexArrayState::mCachedInvalidMappedArrayBuffer.   We need the value to be \u00270\u0027, so that the draw call will succeed.   Otherwise, if any bit is set in VertexArrayState::mCachedInvalidMappedArrayBuffer, then ValidateDrawStates() generates the error \"An active buffer is mapped\", which can be seen at the end of the \"BAD - Without buffer-\u003eonStateChange in Context::vertexAttribPointer\" snippet.\n\nGOOD\nhttps://paste.googleplex.com/5750416563240960\nBAD\nhttps://paste.googleplex.com/5570053236850688\n\nIn particular, note that the difference between good vs bad is that with this call, VertexArray::updateCachedMappedArrayBuffers() is called for every vertex binding (index) rather than just the first binding.   This is effectively doing what the for loop was accomplishing.",
      "parentUuid": "a2a3c8fe_62f2262e",
      "range": {
        "startLine": 5417,
        "startChar": 0,
        "endLine": 5421,
        "endChar": 5
      },
      "revId": "3ff5d437fb8f2f9693bb8447e24346592dcb0f21",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9a521eaf_708b551e",
        "filename": "src/libANGLE/Context.cpp",
        "patchSetId": 12
      },
      "lineNbr": 5421,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-12-23T22:30:30Z",
      "side": 1,
      "message": "Can you debug it? I was looking through it a bit, and didn\u0027t quite spot it. I think it\u0027s a small bug in your implementation that you\u0027re working around using a broader dirty bit swab. GL is a bit tricky... if not we can resume next week and I can help pinpoint it.\n\nIf it\u0027s an existing bug in the prior mapped approach it would be good to pinpoint as well.",
      "parentUuid": "bedb50c7_053e81b5",
      "range": {
        "startLine": 5417,
        "startChar": 0,
        "endLine": 5421,
        "endChar": 5
      },
      "revId": "3ff5d437fb8f2f9693bb8447e24346592dcb0f21",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cd29b8c1_769239e7",
        "filename": "src/libANGLE/Context.cpp",
        "patchSetId": 12
      },
      "lineNbr": 5421,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-12-24T02:31:31Z",
      "side": 1,
      "message": "Ok, digging in a bit deeper, it was a bug in VertexArray::bindVertexBufferImpl():\n\nBAD:\n        bool isPersistent \u003d (boundBuffer-\u003egetAccessFlags() \u0026 GL_MAP_PERSISTENT_BIT_EXT) \u003d\u003d 0;\n\nGOOD:\n        bool isPersistent \u003d (boundBuffer-\u003egetAccessFlags() \u0026 GL_MAP_PERSISTENT_BIT_EXT) !\u003d 0;\n\nThis was doing a roundabout way of calling the correct version in VertexArray::updateCachedMappedArrayBuffersBinding().\n\nShould be good now.",
      "parentUuid": "a2a3c8fe_62f2262e",
      "range": {
        "startLine": 5417,
        "startChar": 0,
        "endLine": 5421,
        "endChar": 5
      },
      "revId": "3ff5d437fb8f2f9693bb8447e24346592dcb0f21",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "03d93f8a_f1726338",
        "filename": "src/libANGLE/VertexArray.cpp",
        "patchSetId": 12
      },
      "lineNbr": 253,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-12-23T22:30:30Z",
      "side": 1,
      "message": "this name is no longer correct.",
      "range": {
        "startLine": 253,
        "startChar": 31,
        "endLine": 253,
        "endChar": 61
      },
      "revId": "3ff5d437fb8f2f9693bb8447e24346592dcb0f21",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "61309b93_4fffa7eb",
        "filename": "src/libANGLE/VertexArray.cpp",
        "patchSetId": 12
      },
      "lineNbr": 253,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-12-24T02:31:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "03d93f8a_f1726338",
      "range": {
        "startLine": 253,
        "startChar": 31,
        "endLine": 253,
        "endChar": 61
      },
      "revId": "3ff5d437fb8f2f9693bb8447e24346592dcb0f21",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}