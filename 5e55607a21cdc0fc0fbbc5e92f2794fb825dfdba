{
  "comments": [
    {
      "key": {
        "uuid": "853fcc7d_12e124e1",
        "filename": "src/common/vulkan/vulkan_icd.cpp",
        "patchSetId": 5
      },
      "lineNbr": 25,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-17T19:34:22Z",
      "side": 1,
      "message": "style nit: avoid auto for simple types for readability - see style doc if curious.",
      "range": {
        "startLine": 25,
        "startChar": 4,
        "endLine": 25,
        "endChar": 9
      },
      "revId": "5e55607a21cdc0fc0fbbc5e92f2794fb825dfdba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e6947e1c_73dc2316",
        "filename": "src/common/vulkan/vulkan_icd.cpp",
        "patchSetId": 5
      },
      "lineNbr": 25,
      "author": {
        "id": 1369468
      },
      "writtenOn": "2020-06-17T19:54:21Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "853fcc7d_12e124e1",
      "range": {
        "startLine": 25,
        "startChar": 4,
        "endLine": 25,
        "endChar": 9
      },
      "revId": "5e55607a21cdc0fc0fbbc5e92f2794fb825dfdba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fbd252be_d9e6cd85",
        "filename": "src/common/vulkan/vulkan_icd.cpp",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-17T19:34:22Z",
      "side": 1,
      "message": "why use Optional if you can just check .empty()?",
      "range": {
        "startLine": 26,
        "startChar": 25,
        "endLine": 26,
        "endChar": 33
      },
      "revId": "5e55607a21cdc0fc0fbbc5e92f2794fb825dfdba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "77b48a9b_f645aa2b",
        "filename": "src/common/vulkan/vulkan_icd.cpp",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1369468
      },
      "writtenOn": "2020-06-17T19:54:21Z",
      "side": 1,
      "message": "Not sure I understand the question. Are you asking why I use Optional\u003cstd::string\u003e as a return type to this function? Or why I\u0027m creating a default-constructed Optional\u003cstd::string\u003e here as my return type?\n\nIf it\u0027s the former, this helper function is useful because it\u0027s return type encodes two pieces of info: if the environment variable exists, and what it\u0027s value is. Without this, I would need to store a bool and a string so that when resetting the variable, I either unset or revert. This helper returns an Optional which can ber used with ResetEnvironmentVar (below) to simplify this case.\n\nI was going to ask if we could move these functions next to GetEnvironmentVariable, UnsetEnvironmentVariable, etc.\n\nIf you take issue with the latter, I could rewrite as:\n\n    if (env.empty())\n        return {};\n    return env;\n\nI cannot use an initializer_list on the right hand side of a ternary operator expression because the compiler requires that the true and false expressions evaluate to the exact same type, hence explicitly constructing the Optional\u003cstd::string\u003e{}.",
      "parentUuid": "fbd252be_d9e6cd85",
      "range": {
        "startLine": 26,
        "startChar": 25,
        "endLine": 26,
        "endChar": 33
      },
      "revId": "5e55607a21cdc0fc0fbbc5e92f2794fb825dfdba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8e0461f1_fb2e0b18",
        "filename": "src/common/vulkan/vulkan_icd.cpp",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-17T19:58:18Z",
      "side": 1,
      "message": "An empty string and the environment variable not existing are the same. True as well for the inverse (non-empty iff exists).",
      "parentUuid": "77b48a9b_f645aa2b",
      "range": {
        "startLine": 26,
        "startChar": 25,
        "endLine": 26,
        "endChar": 33
      },
      "revId": "5e55607a21cdc0fc0fbbc5e92f2794fb825dfdba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2d1fc2cd_6544bd8c",
        "filename": "src/common/vulkan/vulkan_icd.cpp",
        "patchSetId": 5
      },
      "lineNbr": 26,
      "author": {
        "id": 1369468
      },
      "writtenOn": "2020-06-17T20:03:45Z",
      "side": 1,
      "message": "Yes, that\u0027s true, and I see that this is how mPreviousICDEnv is handling it, but technically it\u0027s implementation-defined. It\u0027s entirely possible for a platform to allow defining empty variables, and to check for it\u0027s mere existance. However, I don\u0027t know of any platform that does. Also, note that angle::GetCWD() does return Optional\u003cstd::string\u003e, so there\u0027s precedence for this case.\n\nAnyway, if you prefer I go the route of checking empty strings, I\u0027ll do that. I can at least keep ResetEnvironmentVariable, and also use it where we currently reset kLoaderICDFilenamesEnv:\n\n        if (mPreviousICDEnv.value().empty())\n        {\n            angle::UnsetEnvironmentVar(kLoaderICDFilenamesEnv);\n        }\n        else\n        {\n            angle::SetEnvironmentVar(kLoaderICDFilenamesEnv, mPreviousICDEnv.value().c_str());\n        }\n\nShall I add this ResetEnvironmentVar to system_utils?",
      "parentUuid": "8e0461f1_fb2e0b18",
      "range": {
        "startLine": 26,
        "startChar": 25,
        "endLine": 26,
        "endChar": 33
      },
      "revId": "5e55607a21cdc0fc0fbbc5e92f2794fb825dfdba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6e31dddb_aed00219",
        "filename": "src/common/vulkan/vulkan_icd.cpp",
        "patchSetId": 5
      },
      "lineNbr": 234,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-17T19:34:22Z",
      "side": 1,
      "message": "nit: this init style is not idiomatic for ANGLE - try just defining the struct and then the variable after. I think it\u0027s fine if it\u0027s not a static, this function should be called once per process in most cases so performance is not a concern.",
      "range": {
        "startLine": 221,
        "startChar": 3,
        "endLine": 234,
        "endChar": 0
      },
      "revId": "5e55607a21cdc0fc0fbbc5e92f2794fb825dfdba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c43f9593_d7a79355",
        "filename": "src/common/vulkan/vulkan_icd.cpp",
        "patchSetId": 5
      },
      "lineNbr": 234,
      "author": {
        "id": 1369468
      },
      "writtenOn": "2020-06-17T19:54:21Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6e31dddb_aed00219",
      "range": {
        "startLine": 221,
        "startChar": 3,
        "endLine": 234,
        "endChar": 0
      },
      "revId": "5e55607a21cdc0fc0fbbc5e92f2794fb825dfdba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c91190a3_e729e461",
        "filename": "src/common/vulkan/vulkan_icd.cpp",
        "patchSetId": 5
      },
      "lineNbr": 243,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-17T19:34:22Z",
      "side": 1,
      "message": "ditto here",
      "range": {
        "startLine": 243,
        "startChar": 9,
        "endLine": 243,
        "endChar": 14
      },
      "revId": "5e55607a21cdc0fc0fbbc5e92f2794fb825dfdba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c7c027b6_daf4b7e2",
        "filename": "src/common/vulkan/vulkan_icd.cpp",
        "patchSetId": 5
      },
      "lineNbr": 243,
      "author": {
        "id": 1369468
      },
      "writtenOn": "2020-06-17T19:54:21Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c91190a3_e729e461",
      "range": {
        "startLine": 243,
        "startChar": 9,
        "endLine": 243,
        "endChar": 14
      },
      "revId": "5e55607a21cdc0fc0fbbc5e92f2794fb825dfdba",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}