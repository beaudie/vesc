{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "f8dd1aa6_7409b99f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-06-11T18:27:02Z",
      "side": 1,
      "message": "PTAL",
      "revId": "34a94144a86f5a27a6638dfad6bf7df2939c231f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1610fb54_72f48558",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-06-12T02:01:10Z",
      "side": 1,
      "message": "üëç\n\nThere seems to be some accounting errors, otherwise LGTM",
      "revId": "34a94144a86f5a27a6638dfad6bf7df2939c231f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e1c12633_dd126d00",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-06-13T16:12:53Z",
      "side": 1,
      "message": "i am unable to repro this assert failure on my win desktop. Shabi do you have any pointers?\n\n [270/4079] KHR-GLES3.packed_pixels.pbo_rectangle.rgba4 (CRASH)\n\n ..\\..\\src\\tests\\deqp_support\\angle_deqp_gtest.cpp(52): error: Failed\n\n vk_helpers.cpp:8007 (flushStagedUpdates): \t! Assert failed in \n flushStagedUpdates (..\\..\\src\\libANGLE\\renderer\\vulkan\\vk_helpers.cpp:8007): \n mTotalStagedBufferUpdateSize \u003d\u003d 0\n\n FATAL: vk_helpers.cpp:8007 (flushStagedUpdates): \t! Assert failed in \n flushStagedUpdates (..\\..\\src\\libANGLE\\renderer\\vulkan\\vk_helpers.cpp:8007): \n mTotalStagedBufferUpdateSize \u003d\u003d 0\n\n Backtrace:\n\n    gl::LogMessage::~LogMessage (o:\\src\\common\\debug.cpp:206)\n\n    rx::vk::ImageHelper::flushStagedUpdates (o:\\src\\libANGLE\\renderer\\vulkan\\vk_helpers.cpp:8008)\n\n    rx::TextureVk::flushImageStagedUpdates (o:\\src\\libANGLE\\renderer\\vulkan\\TextureVk.cpp:2419)\n\n    rx::TextureVk::ensureImageInitialized (o:\\src\\libANGLE\\renderer\\vulkan\\TextureVk.cpp:2409)\n\n    rx::TextureVk::ensureRenderable (o:\\src\\libANGLE\\renderer\\vulkan\\TextureVk.cpp:3547)\n\n    rx::TextureVk::respecifyImageStorageIfNecessary (o:\\src\\libANGLE\\renderer\\vulkan\\TextureVk.cpp:2607)\n\n    rx::TextureVk::getAttachmentRenderTarget (o:\\src\\libANGLE\\renderer\\vulkan\\TextureVk.cpp:2314)\n\n    gl::FramebufferAttachment::getRenderTargetImpl (o:\\src\\libANGLE\\FramebufferAttachment.h:281)\n\n    rx::RenderTargetCache\u003crx::RenderTargetVk\u003e::updateCachedRenderTarget (o:\\src\\libANGLE\\renderer\\RenderTargetCache.h:163)\n\n    rx::RenderTargetCache\u003crx::RenderTargetVk\u003e::updateColorRenderTarget (o:\\src\\libANGLE\\renderer\\RenderTargetCache.h:137)\n\n    rx::FramebufferVk::updateColorAttachment (o:\\src\\libANGLE\\renderer\\vulkan\\FramebufferVk.cpp:1696)\n\n    rx::FramebufferVk::syncState (o:\\src\\libANGLE\\renderer\\vulkan\\FramebufferVk.cpp:1917)\n\n    gl::Framebuffer::syncState (o:\\src\\libANGLE\\Framebuffer.cpp:2066)\n\n    gl::State::syncReadFramebuffer (o:\\src\\libANGLE\\State.cpp:3388)\n\n    gl::Context::syncState (o:\\src\\libANGLE\\Context.cpp:4374)\n\n    gl::Context::readPixels (o:\\src\\libANGLE\\Context.cpp:4644)\n\n    GL_ReadPixels (o:\\src\\libGLESv2\\entry_points_gles_2_0_autogen.cpp:2556)\n\n    glcts::RectangleTest::readOutputData (o:\\third_party\\VK-GL-CTS\\src\\external\\openglcts\\modules\\common\\glcPackedPixelsTests.cpp:2236)\n\n    glcts::RectangleTest::readPixelsInner (o:\\third_party\\VK-GL-CTS\\src\\external\\openglcts\\modules\\common\\glcPackedPixelsTests.cpp:2104)\n\n    glcts::RectangleTest::readPixels (o:\\third_party\\VK-GL-CTS\\src\\external\\openglcts\\modules\\common\\glcPackedPixelsTests.cpp:2093)\n\n    glcts::RectangleTest::doRead (o:\\third_party\\VK-GL-CTS\\src\\external\\openglcts\\modules\\common\\glcPackedPixelsTests.cpp:2025)\n\n    glcts::RectangleTest::testAllFormatsAndTypes (o:\\third_party\\VK-GL-CTS\\src\\external\\openglcts\\modules\\common\\glcPackedPixelsTests.cpp:3578)\n\n    glcts::RectangleTest::iterate (o:\\third_party\\VK-GL-CTS\\src\\external\\openglcts\\modules\\common\\glcPackedPixelsTests.cpp:3608)\n\n    es3cts::TestCaseWrapper::iterate (o:\\third_party\\VK-GL-CTS\\src\\external\\openglcts\\modules\\gles3\\es3cTestPackage.cpp:113)\n\n    tcu::RandomOrderExecutor::executeInner (o:\\src\\tests\\deqp_support\\tcuRandomOrderExecutor.cpp:268)\n\n    tcu::RandomOrderExecutor::execute (o:\\src\\tests\\deqp_support\\tcuRandomOrderExecutor.cpp:191)\n\n    deqp_libtester_run (o:\\src\\tests\\deqp_support\\angle_deqp_libtester_main.cpp:157)\n\n    angle::`anonymous namespace\u0027::dEQP::TestBody (o:\\src\\tests\\deqp_support\\angle_deqp_gtest.cpp:409)\n\n    testing::Test::Run (o:\\third_party\\googletest\\src\\googletest\\src\\gtest.cc:2713)\n\n    testing::TestInfo::Run (o:\\third_party\\googletest\\src\\googletest\\src\\gtest.cc:2888)\n\n    testing::TestSuite::Run (o:\\third_party\\googletest\\src\\googletest\\src\\gtest.cc:3040)\n\n    testing::internal::UnitTestImpl::RunAllTests (o:\\third_party\\googletest\\src\\googletest\\src\\gtest.cc:5898)\n\n    testing::UnitTest::Run (o:\\third_party\\googletest\\src\\googletest\\src\\gtest.cc:5464)\n\n    angle::TestSuite::run (o:\\src\\tests\\test_utils\\runner\\TestSuite.cpp:1712)\n\n    angle::RunGLCTSTests (o:\\src\\tests\\deqp_support\\angle_deqp_gtest.cpp:836)\n\n    main (o:\\src\\tests\\angle_deqp_tests_main.cpp:28)\n\n    __scrt_common_main_seh (d:\\a01\\_work\\12\\s\\src\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl:288)\n\n    BaseThreadInitThunk - 00007FF887607BD4 (KERNEL32): (filename not available)\n\n    RtlUserThreadStart - 00007FF888B0CED1 (ntdll): (filename not available)",
      "revId": "34a94144a86f5a27a6638dfad6bf7df2939c231f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6b6dd513_379c62aa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-06-14T16:03:37Z",
      "side": 1,
      "message": "I can reproduce it. Let me debug.",
      "parentUuid": "e1c12633_dd126d00",
      "revId": "34a94144a86f5a27a6638dfad6bf7df2939c231f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c1a21901_dfd6bbcb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-06-14T16:05:29Z",
      "side": 1,
      "message": "The value is negative, so something\u0027s over-accounted for.\n\n```\n(gdb) p/x mTotalStagedBufferUpdateSize\n$2 \u003d 0xffffffffffffffc0\n```\n\nAgain, I\u0027m debugging it. Will give you a diff with the fix.",
      "parentUuid": "6b6dd513_379c62aa",
      "revId": "34a94144a86f5a27a6638dfad6bf7df2939c231f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e00192b1_cfb46a2b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-06-14T19:24:53Z",
      "side": 1,
      "message": "Here\u0027s the fix:\n\n```\n@@ -6918,6 +6931,9 @@ angle::Result ImageHelper::reformatStagedBufferUpdates(ContextVk *contextVk,\n                 update.data.buffer.formatID                \u003d dstFormatID;\n                 update.data.buffer.copyRegion.bufferOffset \u003d dstBufferOffset;\n \n+                mTotalStagedBufferUpdateSize -\u003d srcBuffer-\u003egetSize();\n+                mTotalStagedBufferUpdateSize +\u003d dstBuffer-\u003egetSize();\n+\n                 // Let update structure owns the staging buffer\n                 if (update.refCounted.buffer)\n                 {\n```",
      "parentUuid": "c1a21901_dfd6bbcb",
      "revId": "34a94144a86f5a27a6638dfad6bf7df2939c231f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4625c003_942dac82",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 12
      },
      "lineNbr": 8277,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-06-12T02:01:10Z",
      "side": 1,
      "message": "nit: shouldn\u0027t happen! And if it does, might as well let the next `if` drop the update.\n\nYou should be able to delete this.",
      "range": {
        "startLine": 8272,
        "startChar": 0,
        "endLine": 8277,
        "endChar": 9
      },
      "revId": "34a94144a86f5a27a6638dfad6bf7df2939c231f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}