{
  "comments": [
    {
      "key": {
        "uuid": "06d9739f_d916dffa",
        "filename": "BUILD.gn",
        "patchSetId": 1
      },
      "lineNbr": 653,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-06-03T00:54:07Z",
      "side": 1,
      "message": "This is causing the presubmit and build failures.\n\nHow do I correctly include this library?",
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "82b03044_92e7ece4",
        "filename": "BUILD.gn",
        "patchSetId": 1
      },
      "lineNbr": 653,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-03T16:24:47Z",
      "side": 1,
      "message": "Well, here you\u0027re in angle_enable_gl (the GL back-end). You should at least be putting it outside this if statement as it applies to the front-end. Maybe that\u0027s all you\u0027re missing?",
      "parentUuid": "06d9739f_d916dffa",
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c5843fc8_edf5ce79",
        "filename": "BUILD.gn",
        "patchSetId": 1
      },
      "lineNbr": 653,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-06-03T21:27:56Z",
      "side": 1,
      "message": "That doesn\u0027t seem to be it.   Moving it to the correct(?) place at the start of libANGLE_base still gives an error.\n\n[[[ BUILD.gn ]]]\nangle_source_set(\"libANGLE_base\") {\n...\n  deps \u003d [\n    \":angle_compression\",\n    \":angle_image_util\",\n    \":includes\",\n  ]\n\ntimvp@timvp-glaptop:~/code/chromium/src/third_party/angle$ git cl presubmit --upload\n...\n  shared_library //third_party/zlib:zlib\nWarning in //third_party/zlib:zlib: third_party/zlib/deflate.c: Invalid include: b\u0027contrib/optimizations/slide_hash_neon.h\u0027\nTraceback (most recent call last):\n  File \"/home/timvp/code/chromium/src/third_party/angle/scripts/export_targets.py\", line 289, in \u003cmodule\u003e\n    libraries \u003d gather_libraries(ROOTS, descs)\n  File \"/home/timvp/code/chromium/src/third_party/angle/scripts/export_targets.py\", line 284, in gather_libraries\n    dag_traverse(roots, fn)\n  File \"/home/timvp/code/chromium/src/third_party/angle/scripts/export_targets.py\", line 114, in dag_traverse\n    recurse(x)\n  File \"/home/timvp/code/chromium/src/third_party/angle/scripts/export_targets.py\", line 107, in recurse\n    recurse(x)\n  File \"/home/timvp/code/chromium/src/third_party/angle/scripts/export_targets.py\", line 107, in recurse\n    recurse(x)\n  File \"/home/timvp/code/chromium/src/third_party/angle/scripts/export_targets.py\", line 107, in recurse\n    recurse(x)\n  [Previous line repeated 4 more times]\n  File \"/home/timvp/code/chromium/src/third_party/angle/scripts/export_targets.py\", line 99, in recurse\n    t \u003d pre_recurse_func(key)\n  File \"/home/timvp/code/chromium/src/third_party/angle/scripts/export_targets.py\", line 278, in fn\n    assert has_all_includes(target_name, descs), target_name\nAssertionError: //third_party/zlib:zlib\n\n\nThat header file is behind an #ifdef:\n\n[[[ third_party/zlib/deflate.c ]]]\n#if (defined(__ARM_NEON__) || defined(__ARM_NEON))\n#include \"contrib/optimizations/slide_hash_neon.h\"\n#endif\n\nThe BUILD.gn also has the include inside a conditional:\n\n[[[ third_party/zlib/BUILD.gn ]]]\ncomponent(\"zlib\") {\n...\n    if (use_x86_x64_optimizations) {\n      deps +\u003d [ \":zlib_crc32_simd\" ]\n    } else if (use_arm_neon_optimizations) {\n      sources +\u003d [ \"contrib/optimizations/slide_hash_neon.h\" ]\n      deps +\u003d [ \":zlib_arm_crc32\" ]\n    }\n\nIt looks like GN isn\u0027t able to connect those dots.   What I don\u0027t understand yet is how \u0027libANGLE_with_capture\u0027 is getting around this:\n\n[[[ BUILD.gn ]]]\nangle_source_set(\"libANGLE_with_capture\") {\n  public_deps \u003d [ \":libANGLE_base\" ]\n  deps \u003d [ \":angle_compression\" ]\n  public_configs \u003d [ \":angle_frame_capture_enabled\" ]\n  sources \u003d libangle_capture_sources\n}",
      "parentUuid": "82b03044_92e7ece4",
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "255c5139_ceda8fc4",
        "filename": "BUILD.gn",
        "patchSetId": 1
      },
      "lineNbr": 653,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-03T21:34:23Z",
      "side": 1,
      "message": "It\u0027s probably in IGNORED_INCLUDES in export_targets.py. Can try that.",
      "parentUuid": "c5843fc8_edf5ce79",
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2a3ea42c_b567eb71",
        "filename": "BUILD.gn",
        "patchSetId": 1
      },
      "lineNbr": 653,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-06-03T21:54:32Z",
      "side": 1,
      "message": "It\u0027s not in there either.\n\nHacking it a bit and just always including \"slide_hash_neon.h\" fixes that error, but generates not ones.\n\n[[[ third_party/zlib/BUILD.gn ]]]\ncomponent(\"zlib\") {\n...\n    sources +\u003d [ \"contrib/optimizations/slide_hash_neon.h\" ]  \u003c\u003c--- hack\n    if (use_x86_x64_optimizations) {\n      deps +\u003d [ \":zlib_crc32_simd\" ]\n    } else if (use_arm_neon_optimizations) {\n      sources +\u003d [ \"contrib/optimizations/slide_hash_neon.h\" ]\n      deps +\u003d [ \":zlib_arm_crc32\" ]\n    }\n\nThat hack gives new presubmit errors:\n\nWarning in //third_party/zlib:zlib_adler32_simd: third_party/zlib/adler32_simd.h: Invalid include: b\u0027zconf.h\u0027\nWarning in //third_party/zlib:zlib_adler32_simd: third_party/zlib/adler32_simd.h: Invalid include: b\u0027zutil.h\u0027\n\nBoth of those header files are always included as part of \"zlib\", so that doesn\u0027t really make any sense to me:\n\n[[[ third_party/zlib/BUILD.gn ]]]\ncomponent(\"zlib\") {\n  if (!is_win) {\n    # Don\u0027t stomp on \"libzlib\" on other platforms.\n    output_name \u003d \"chrome_zlib\"\n  }\n\n  sources \u003d [\n..\n    \"zconf.h\",\n    \"zlib.h\",\n    \"zutil.c\",\n    \"zutil.h\",\n  ]\n\nI\u0027m not sure what\u0027s going on with GN and zlib, but it doesn\u0027t seem to like it.\n\nAdding \u0027//third_party/zlib\u0027 to IGNORED_DIRECTORIES ignores the errors (obviously), but it would be nice to know what\u0027s going wrong here.",
      "parentUuid": "255c5139_ceda8fc4",
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d40e011c_5714d012",
        "filename": "BUILD.gn",
        "patchSetId": 1
      },
      "lineNbr": 653,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-06-03T21:56:40Z",
      "side": 1,
      "message": "Add to IGNORED_INCLUDES or INGORED_DIRECTORIES. The simple check can\u0027t handle conditional includes.",
      "parentUuid": "2a3ea42c_b567eb71",
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dfbd4b4a_605e18b2",
        "filename": "src/libANGLE/MemoryProgramCache.cpp",
        "patchSetId": 1
      },
      "lineNbr": 151,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-06-03T03:06:53Z",
      "side": 1,
      "message": "Does it have to be 0-initialized if it\u0027s about to be overwritten?",
      "range": {
        "startLine": 151,
        "startChar": 62,
        "endLine": 151,
        "endChar": 65
      },
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ce8a9c0f_51c78b59",
        "filename": "src/libANGLE/MemoryProgramCache.cpp",
        "patchSetId": 1
      },
      "lineNbr": 151,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-06-03T21:27:56Z",
      "side": 1,
      "message": "Shouldn\u0027t need to be.",
      "parentUuid": "dfbd4b4a_605e18b2",
      "range": {
        "startLine": 151,
        "startChar": 62,
        "endLine": 151,
        "endChar": 65
      },
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "21a1dd51_8df1279e",
        "filename": "src/libANGLE/MemoryProgramCache.cpp",
        "patchSetId": 1
      },
      "lineNbr": 226,
      "author": {
        "id": 1105284
      },
      "writtenOn": "2020-06-03T17:03:59Z",
      "side": 1,
      "message": "Small worry that we end up allocating more peak memory but I doubt we can compress the data in the same buffer we read from.",
      "range": {
        "startLine": 225,
        "startChar": 4,
        "endLine": 226,
        "endChar": 55
      },
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "443c68a3_9213b81d",
        "filename": "src/libANGLE/MemoryProgramCache.cpp",
        "patchSetId": 1
      },
      "lineNbr": 226,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-06-03T21:27:56Z",
      "side": 1,
      "message": "I just tried reusing the buffer but it crashes, which is not entirely surprising.",
      "parentUuid": "21a1dd51_8df1279e",
      "range": {
        "startLine": 225,
        "startChar": 4,
        "endLine": 226,
        "endChar": 55
      },
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bf1e61e8_c95ab134",
        "filename": "src/libANGLE/MemoryProgramCache.cpp",
        "patchSetId": 1
      },
      "lineNbr": 252,
      "author": {
        "id": 1105284
      },
      "writtenOn": "2020-06-03T17:03:59Z",
      "side": 1,
      "message": "I\u0027m excited to see how the metric changes.",
      "range": {
        "startLine": 251,
        "startChar": 0,
        "endLine": 252,
        "endChar": 68
      },
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "79fdbb0c_c2cb4317",
        "filename": "src/libANGLE/MemoryProgramCache.cpp",
        "patchSetId": 1
      },
      "lineNbr": 252,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-06-03T21:27:56Z",
      "side": 1,
      "message": "How do we see these numbers?",
      "parentUuid": "bf1e61e8_c95ab134",
      "range": {
        "startLine": 251,
        "startChar": 0,
        "endLine": 252,
        "endChar": 68
      },
      "revId": "3891ff7102ba2c75ad3feef701dc79657ea283b8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}