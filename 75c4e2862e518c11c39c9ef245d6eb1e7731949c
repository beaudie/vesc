{
  "comments": [
    {
      "key": {
        "uuid": "5be51c14_a11dd292",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.h",
        "patchSetId": 6
      },
      "lineNbr": 636,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-04-22T23:19:30Z",
      "side": 1,
      "message": "I also not sure why this is needed. My understanding is that this is tracking if we have put any commands into primary command buffer or not. If my understanding is correct, then why we need to set it to true here instead of set it to true in flushToPrimary()?",
      "range": {
        "startLine": 636,
        "startChar": 8,
        "endLine": 636,
        "endChar": 27
      },
      "revId": "75c4e2862e518c11c39c9ef245d6eb1e7731949c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "be40f268_e6cd400e",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.h",
        "patchSetId": 6
      },
      "lineNbr": 638,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-04-22T20:18:47Z",
      "side": 1,
      "message": "So this was a real bug where endRPAndGetCB didn\u0027t flush outside RP CB? I wonder why there was no test failure or glitches in apps. Jamie can shed some light on this.",
      "revId": "75c4e2862e518c11c39c9ef245d6eb1e7731949c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8ee7ecc8_46b21996",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.h",
        "patchSetId": 6
      },
      "lineNbr": 638,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-04-22T23:19:30Z",
      "side": 1,
      "message": "I also have the same question as Shabi asked here. My understanding is that when we startRP, we ensure outsideRP flushed to primary first so that they will always go before RP. It is unclear to me that the commands recorded into outsideRP while RP is open should go before RP or after or doesn\u0027t matter. Can you or Jamie clarify this and maybe put comment somewhere in the code?\n\nAlso if it is truly required that outsideRP commands flushed before RP, then maybe we should do it inside endRenderPass().",
      "parentUuid": "be40f268_e6cd400e",
      "revId": "75c4e2862e518c11c39c9ef245d6eb1e7731949c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c075e947_b9020dc9",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.h",
        "patchSetId": 6
      },
      "lineNbr": 638,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-04-23T02:35:52Z",
      "side": 1,
      "message": "@Charlie, I think the idea was that even if the RP has started, you could go back and record to the outside RP CB (which is run before the RP) as a way of reordering commands without having to break the RP. That\u0027s why you could still record to outside RP CB after the RP has started.",
      "parentUuid": "8ee7ecc8_46b21996",
      "revId": "75c4e2862e518c11c39c9ef245d6eb1e7731949c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d8cd86c2_8eff4de2",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.h",
        "patchSetId": 6
      },
      "lineNbr": 638,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-04-23T02:54:16Z",
      "side": 1,
      "message": "Right. I think my question here really is the part you said above that \"...outside RP CB (which is run before the RP)...\". My understanding is that the outside RP commands are considered as no dependency between current open RP. They could go either before or after RP during flush. If they must flush before RP commands, then why not move it to endRenderPass() function so that you ensure outsideRPCommands always flushed to primary before RP commands.",
      "parentUuid": "c075e947_b9020dc9",
      "revId": "75c4e2862e518c11c39c9ef245d6eb1e7731949c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3ddc2e74_5c758ce8",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.h",
        "patchSetId": 6
      },
      "lineNbr": 638,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-04-23T08:59:42Z",
      "side": 1,
      "message": "~~~On the contrary, I think they _do_ need to go before the RP. For example, if the RP is open and a texture is to be used but it has staged updates, then flushing those updates can be moved before the RP (in the outside RP CB).~~~\n\nBut now that I look again at the code, it seems like the contrary is true, as in the outside RP CB must be executed *after* the RP. For example onBufferRead/Write first close the render pass, then flush outside RP CB (which implies that the opposite of what I said above is true). Same with ImageHelper::flushAllStagedUpdates calling endRenderPassAndGetCommandBuffer which closes the RP then returns the outside RP CB for further recording.\n\nOn the other hand, if outside RP CB needs to be run after RP, why did `flushAndGetPrimaryCommandBuffer()` flush them in the opposite order? And why doesn\u0027t `startRenderPass()` flush outside RP CB?\n\n\u003e My understanding is that the outside RP commands are considered as no dependency between current open RP.\n\nIf that were true, why would TextureVk::ensureImageInitializedImpl for example have to end the RP? There are more examples like that.",
      "parentUuid": "d8cd86c2_8eff4de2",
      "revId": "75c4e2862e518c11c39c9ef245d6eb1e7731949c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}