{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "27301d5c_c6421b96",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1001921
      },
      "writtenOn": "2022-09-12T16:12:48Z",
      "side": 1,
      "message": "Shabi or Cody, PTAL, should fix UBSAN problem.",
      "revId": "03a25554cd9df9eddc71434ea3038fed7e162480",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "caa807f4_11d296d5",
        "filename": "src/libANGLE/renderer/vulkan/SecondaryCommandBuffer.h",
        "patchSetId": 2
      },
      "lineNbr": 1000,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-09-12T16:16:59Z",
      "side": 1,
      "message": "This `if` is in a hot path, and most of the times completely unnecessary. Could you instead place it in `SecondaryCommandBuffer::bindDescriptorSets` around this?\n\n```\n    storePointerParameter(writePtr, dynamicOffsets, offsetSize);\n```\n\nIf UBSAN catches is failing on another instance too, we could add an if there too.",
      "revId": "03a25554cd9df9eddc71434ea3038fed7e162480",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "66c972e0_3e147e0e",
        "filename": "src/libANGLE/renderer/vulkan/SecondaryCommandBuffer.h",
        "patchSetId": 2
      },
      "lineNbr": 1000,
      "author": {
        "id": 1001921
      },
      "writtenOn": "2022-09-12T16:24:51Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "caa807f4_11d296d5",
      "revId": "03a25554cd9df9eddc71434ea3038fed7e162480",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "db8897e8_bf8ffb6f",
        "filename": "src/libANGLE/renderer/vulkan/SecondaryCommandBuffer.h",
        "patchSetId": 2
      },
      "lineNbr": 1000,
      "author": {
        "id": 1001921
      },
      "writtenOn": "2022-09-12T16:27:03Z",
      "side": 1,
      "message": "But note that CPU\u0027s execution prediction is \u003e 99% correct for such cases, so this probably doesn\u0027t affect performance and is more correct.",
      "parentUuid": "66c972e0_3e147e0e",
      "revId": "03a25554cd9df9eddc71434ea3038fed7e162480",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d772edf0_3a690a59",
        "filename": "src/libANGLE/renderer/vulkan/SecondaryCommandBuffer.h",
        "patchSetId": 2
      },
      "lineNbr": 1000,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-09-12T16:43:32Z",
      "side": 1,
      "message": "FYI there is a cost just to executing instructions even if you disregard the branch entirely. My work on optimizing draw call paths showed that any if statement can have an impact even if the code execution only visits one path 100% of the time.",
      "parentUuid": "db8897e8_bf8ffb6f",
      "revId": "03a25554cd9df9eddc71434ea3038fed7e162480",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ca086ab5_601dbc87",
        "filename": "src/libANGLE/renderer/vulkan/SecondaryCommandBuffer.h",
        "patchSetId": 2
      },
      "lineNbr": 1000,
      "author": {
        "id": 1001921
      },
      "writtenOn": "2022-09-12T17:13:23Z",
      "side": 1,
      "message": "Well, it\u0027s obvious that more instructions equals more time.\nHowever, did you observe this for branch instructions as well?\nI\u0027d assume that the CPU would just execute the 2 branches in parallel, and parallel to that, also check the condition and decide which branch is the right one.\nI.e. \"if\" and \"memcpy\" should run in parallel to each other, so I\u0027d expect the slowdown to be minimal.\n\nAnyway, there was one more place where I needed to add a check and UBSAN passes again now, PTAL.",
      "parentUuid": "d772edf0_3a690a59",
      "revId": "03a25554cd9df9eddc71434ea3038fed7e162480",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7a0c724f_72eaa881",
        "filename": "src/libANGLE/renderer/vulkan/SecondaryCommandBuffer.h",
        "patchSetId": 2
      },
      "lineNbr": 1000,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-09-12T17:23:39Z",
      "side": 1,
      "message": "Alls I can say for sure is that removing if instructions can improve performance even if the conditional expression is basically invariant. There\u0027s no guarantee it will improve performance measurably, but it certainly can, especially when combined with other optimizations.",
      "parentUuid": "ca086ab5_601dbc87",
      "revId": "03a25554cd9df9eddc71434ea3038fed7e162480",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}