{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "4008b725_25dcfdf3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-01-26T16:59:46Z",
      "side": 1,
      "message": "LGTM. Are Shabi\u0027s open comments resolved? If so please respond \"done\".",
      "revId": "5bb636d17d461b42fc598dc11402a62db28cc2bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "65fead80_3180b622",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-01-26T17:05:41Z",
      "side": 1,
      "message": "I actually have a concern. Temporary -2 so it doesn\u0027t go through while I write this.",
      "revId": "5bb636d17d461b42fc598dc11402a62db28cc2bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e216a1c6_f57e9fa3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-01-26T17:16:56Z",
      "side": 1,
      "message": "Thinking about this more, I was wrong to suggest doing this unconditionally. There are a number of things that could go wrong, though some of these cases are currently impossible (so could use ASSERTs):\n\n- If loadOp\u003dClear, we shouldn\u0027t change the render area. We don\u0027t currently use loadOp\u003dclear with scissored clears, so this should be an ASSERT.\n- If loadOp\u003dDontCare, we shouldn\u0027t change the render area if it covers area that have well-defined values. This is currently impossible, as we only affect loadOp when invalidating the whole of an image level/layer. I don\u0027t think we can assert this, so at least needs a comment\n- If storeOp\u003dDontCare, we shouldn\u0027t change the render area. We actually keep the invalidate area in the render pass, so actually this should be more like \"if the expanded area is not covered by invalidate area, don\u0027t expand the render area\".\n- If loadOp\u003dDontCare and storeOp\u003dStore, we shouldn\u0027t change the render area.\n\nNote that with multisampled render to texture, it\u0027s the resolve attachment\u0027s loadOp/storeOp that should be looked at (the other one is permanently DontCare). Exception is stencilLoadOp/stencilStoreOp when EXT_shader_stencil_export is not present.\n\n---\n\nThis actually turns out to be very tricky. I\u0027m not sure with all the restrictions in place this would solve the \"readback\" issue you allude to in every case (even if it makes the particular test pass).\n\nCould you please provide more info (on the bug) as to which test exactly fails and where? The line number is already outdated. Also, what\u0027s the \"readback\" mechanism?",
      "revId": "5bb636d17d461b42fc598dc11402a62db28cc2bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2d378d3f_21006e90",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-01-26T17:19:23Z",
      "side": 1,
      "message": "Maybe the best option is to go back to doing this only under multisampled-render-to-texture + some more restrictions regarding the load/store op of the attachments (1), but I\u0027d really like to understand the problem first before you spend more time on this.\n\n(1) which by the way you can deduce from the render pass description and wouldn\u0027t need to pass a bool around.",
      "parentUuid": "e216a1c6_f57e9fa3",
      "revId": "5bb636d17d461b42fc598dc11402a62db28cc2bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7cae17a9_05894e68",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1340324
      },
      "writtenOn": "2021-01-27T05:37:10Z",
      "side": 1,
      "message": "Actually it is a corner case that is a function defect in mali\u0027s driver, related to AFBC(arm\u0027s frame buffer compression) support. \nFor the end2end test MultisampledRenderToTextureTest.DrawMultisampledDifferentSamples, in the second draw, the MS rendering with a render area not aligned to vkGetRenderAreaGranularity. ANGLE reduces the render area compared to the GLES application, the resolve only happens inside the render area, so the pixels outside the render area are preserved.(https://gitlab.khronos.org/vulkan/vulkan/-/issues/1850)\nDue to the AFBC resolve attachment, we need to preserve the \"skirt region\" of the resolve attachment(There exists a defect I think). The \"readback\" is not a real \"read\" or \"write\" operation.\n\nCurrently, the work-around using vkGetRenderAreaGranularity suggests for it.\nYour concern makes sense, and I also prefer to do it under the condition.",
      "parentUuid": "2d378d3f_21006e90",
      "revId": "5bb636d17d461b42fc598dc11402a62db28cc2bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "594cc121_02ff8ee9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-01-27T07:21:27Z",
      "side": 1,
      "message": "Thanks for the explanation. Is this something that would eventually be fixed in the Mali driver? The tests try to scrutinize the implementation but don\u0027t necessarily reflect normal usage. In the absence of any real-world applications that are affected by this, how about we just suppress the test on ARM and move on?\n\nI would have suggested adding a FeaturesVk flag as well that would be enabled only on Mali, but I think that would just hide bugs since we don\u0027t have any bots that would use it.",
      "parentUuid": "7cae17a9_05894e68",
      "revId": "5bb636d17d461b42fc598dc11402a62db28cc2bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "33ef20cb_4862e2f7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1340324
      },
      "writtenOn": "2021-01-27T10:03:01Z",
      "side": 1,
      "message": "Yes, we are working on fixing it. Disabling the test is simple, but we need to ensure the related extension does work well on any Mali builds. It\u0027s not only for the bug, using render areas which are not aligned with vkGetRenderAreaGranularity can result in performance losses, this is even described in the Vulkan Spec. \nI would add the work-around for the multisampled rendering to texture only on Mali if you concern about it will affect other GPUs.",
      "parentUuid": "594cc121_02ff8ee9",
      "revId": "5bb636d17d461b42fc598dc11402a62db28cc2bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "df3503f2_5aba1013",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-01-27T17:28:31Z",
      "side": 1,
      "message": "No it may be best to just do it everywhere, both for the perf win and to make sure we don\u0027t regress it.",
      "parentUuid": "33ef20cb_4862e2f7",
      "revId": "5bb636d17d461b42fc598dc11402a62db28cc2bf",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}