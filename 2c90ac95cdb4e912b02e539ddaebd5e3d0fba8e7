{
  "comments": [
    {
      "key": {
        "uuid": "ffa27b57_62bbefe8",
        "filename": "src/libANGLE/validationES3.cpp",
        "patchSetId": 3
      },
      "lineNbr": 478,
      "author": {
        "id": 1323708
      },
      "writtenOn": "2019-09-05T02:36:22Z",
      "side": 1,
      "message": "internalformat is 0 for this case.\n\nValidateCompressedTexSubImage3D()\n{\n    if (!ValidateES3TexImage3DParameters(context, target, level, GL_NONE, true, true, xoffset,\n                                         yoffset, zoffset, width, height, depth, 0, format, GL_NONE,\n                                         -1, data))\n    {\n        return false;\n    }\n}",
      "revId": "2c90ac95cdb4e912b02e539ddaebd5e3d0fba8e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bec82532_76d5f16c",
        "filename": "src/libANGLE/validationES3.cpp",
        "patchSetId": 3
      },
      "lineNbr": 478,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2019-09-05T15:48:21Z",
      "side": 1,
      "message": "I thought the same thing, so I was going to check the \u0027format\u0027 value also like this:\n\nif ((texType \u003d\u003d TextureType::_3D) \u0026\u0026 \n    (IsETC2EACFormat(format) || (IsETC2EACFormat(internalformat)))\n\n\nHowever, I can\u0027t find any tests that fail with the current code that\u0027s only checking the \u0027internalFormat\u0027 (the CQ run is green).   It\u0027s probably better to do that check anyway though.",
      "parentUuid": "ffa27b57_62bbefe8",
      "revId": "2c90ac95cdb4e912b02e539ddaebd5e3d0fba8e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "be971512_f4ccd403",
        "filename": "src/libANGLE/validationES3.cpp",
        "patchSetId": 3
      },
      "lineNbr": 478,
      "author": {
        "id": 1323708
      },
      "writtenOn": "2019-09-06T01:53:25Z",
      "side": 1,
      "message": "yes, that\u0027s quite strange the test can pass in CQ run. I can always get the failure with the whole run or\n./angle_deqp_gles3_tests --deqp-egl-display-type\u003dangle-vulkan --gtest_filter\u003ddEQP.GLES3/functional_negative_api_texture_compressedtex*image3d\n\nHowever, with the check of \"format\", it can pass on my local environment.",
      "parentUuid": "bec82532_76d5f16c",
      "revId": "2c90ac95cdb4e912b02e539ddaebd5e3d0fba8e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "82c4a3cc_f5144ebf",
        "filename": "src/libANGLE/validationES3.cpp",
        "patchSetId": 3
      },
      "lineNbr": 478,
      "author": {
        "id": 1105284
      },
      "writtenOn": "2019-09-06T14:19:12Z",
      "side": 1,
      "message": "Just below this check, there is an \u0027actualInternalFormat\u0027 variable that you can use for this validation.",
      "parentUuid": "be971512_f4ccd403",
      "revId": "2c90ac95cdb4e912b02e539ddaebd5e3d0fba8e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ab1a17e0_4d467f16",
        "filename": "src/libANGLE/validationES3.cpp",
        "patchSetId": 3
      },
      "lineNbr": 478,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2019-09-06T17:06:10Z",
      "side": 1,
      "message": "I did some experiments and it seems that \u0027format\u0027 is required since internalFormat could be GL_NONE and actualInternalFormat can be wrong (the underlying texture\u0027s format, not the new sub-image\u0027s).\n\n[[[... dEQP.GLES3/functional_negative_api_texture_compressedtexsubimage3d ...]]]\n    if ((texType \u003d\u003d TextureType::_3D) \u0026\u0026 IsETC2EACFormat(actualInternalFormat))\n    {\n        // ES 3.1, Section 8.7, page 169.\n        context-\u003evalidationError(GL_INVALID_OPERATION, kInternalFormatRequiresTexture2DArray);\n        return false;\n    }\n\n    if (isSubImage \u0026\u0026 actualInternalFormat \u003d\u003d GL_NONE)\n    {\n        context-\u003evalidationError(GL_INVALID_OPERATION, kInvalidMipLevel);\n        return false;\n    }\n\n[[[... #define GL_COMPRESSED_RGBA8_ETC2_EAC      0x9278 (37496) ...]]]\n09-06 16:51:18.199 23659 23688 W ANGLE   : WARN: ValidateES3TexImageParametersBase(484): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::484 \u003e\u003e format \u003d 37496\n09-06 16:51:18.199 23659 23688 W ANGLE   : WARN: ValidateES3TexImageParametersBase(485): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::485 \u003e\u003e internalformat \u003d 0\n09-06 16:51:18.199 23659 23688 W ANGLE   : WARN: ValidateES3TexImageParametersBase(486): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::486 \u003e\u003e actualInternalFormat \u003d 0\n[[[... MSG kInvalidMipLevel \u003d \"Level of detail outside of range.\"; ...]]]\n09-06 16:51:18.199 23659 23688 I ANGLE   : INFO: insertMessage(183): GL error: HIGH: Level of detail outside of range.\n\n\nThis passes since we return GL_INVALID_OPERATION, but not for the right reason (kInvalidMipLevel vs kInternalFormatRequiresTexture2DArray).\n\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\n\n[[[... dEQP.GLES3/functional_negative_api_texture_compressedtex*image3d ...]]]\n\n    if ((texType \u003d\u003d TextureType::_3D) \u0026\u0026 IsETC2EACFormat(actualInternalFormat))\n    {\n        // ES 3.1, Section 8.7, page 169.\n        context-\u003evalidationError(GL_INVALID_OPERATION, kInternalFormatRequiresTexture2DArray);\n        return false;\n    }\n\n    if (isCompressed)\n    {\n        if (!actualFormatInfo.compressed)\n        {\n            context-\u003evalidationError(GL_INVALID_ENUM, kCompressedMismatch);\n            return false;\n        }\n\n[[[... #define GL_COMPRESSED_RGBA8_ETC2_EAC      0x9278 (37496) ...]]]\n09-06 16:52:35.260 24288 24316 W ANGLE   : WARN: ValidateES3TexImageParametersBase(484): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::484 \u003e\u003e format \u003d 37496\n09-06 16:52:35.260 24288 24316 W ANGLE   : WARN: ValidateES3TexImageParametersBase(485): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::485 \u003e\u003e internalformat \u003d 0\n[[[... #define GL_RGBA                           0x1908 (6408) ...]]]\n09-06 16:52:35.260 24288 24316 W ANGLE   : WARN: ValidateES3TexImageParametersBase(486): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::486 \u003e\u003e actualInternalFormat \u003d 6408\n[[[... MSG kCompressedMismatch \u003d \"Compressed data is valid if-and-only-if the texture is compressed.\"; ...]]]\n09-06 16:52:35.260 24288 24316 I ANGLE   : INFO: insertMessage(183): GL error: HIGH: Compressed data is valid if-and-only-if the texture is compressed.\n\n\nThis fails since we return GL_INVALID_ENUM.\n\n\n\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\n[[[... dEQP.GLES3/functional_negative_api_texture_compressedtex*image3d ...]]]\n    if ((texType \u003d\u003d TextureType::_3D) \u0026\u0026\n        (IsETC2EACFormat(format) || IsETC2EACFormat(internalformat)))\n    {\n        // ES 3.1, Section 8.7, page 169.\n        context-\u003evalidationError(GL_INVALID_OPERATION, kInternalFormatRequiresTexture2DArray);\n        return false;\n    }\n\n[[[... #define GL_COMPRESSED_RGBA8_ETC2_EAC      0x9278 (37496) ...]]]\n09-06 16:58:58.335 25251 25279 W ANGLE   : WARN: ValidateES3TexImageParametersBase(484): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::484 \u003e\u003e format \u003d 37496\n09-06 16:58:58.335 25251 25279 W ANGLE   : WARN: ValidateES3TexImageParametersBase(485): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::485 \u003e\u003e internalformat \u003d 0\n[[[... #define GL_RGBA                           0x1908 (6408) ...]]]\n09-06 16:58:58.335 25251 25279 W ANGLE   : WARN: ValidateES3TexImageParametersBase(486): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::486 \u003e\u003e actualInternalFormat \u003d 6408\n[[[... MSG kInternalFormatRequiresTexture2DArray \u003d \"internalformat is an ETC2/EAC format and target is not GL_TEXTURE_2D_ARRAY.\"; ...]]]\n09-06 16:58:58.335 25251 25279 I ANGLE   : INFO: insertMessage(183): GL error: HIGH: internalformat is an ETC2/EAC format and target is not GL_TEXTURE_2D_ARRAY.\n\n\n[[[... dEQP.GLES3/functional_negative_api_texture_compressedtex*image3d ...]]]\n[[[... #define GL_COMPRESSED_RGBA8_ETC2_EAC      0x9278 (37496) ...]]]\n09-06 17:00:29.820 25882 25909 W ANGLE   : WARN: ValidateES3TexImageParametersBase(484): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::484 \u003e\u003e format \u003d 37496\n09-06 17:00:29.820 25882 25909 W ANGLE   : WARN: ValidateES3TexImageParametersBase(485): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::485 \u003e\u003e internalformat \u003d 0\n09-06 17:00:29.821 25882 25909 W ANGLE   : WARN: ValidateES3TexImageParametersBase(486): TIMTIM \u003e\u003e ../../third_party/angle/src/libANGLE/validationES3.cpp::486 \u003e\u003e actualInternalFormat \u003d 0\n09-06 17:00:29.821 25882 25909 I ANGLE   : INFO: insertMessage(183): GL error: HIGH: internalformat is an ETC2/EAC format and target is not GL_TEXTURE_2D_ARRAY.\n\nThis passes and outputs the correct error for both cases.",
      "parentUuid": "82c4a3cc_f5144ebf",
      "revId": "2c90ac95cdb4e912b02e539ddaebd5e3d0fba8e7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}