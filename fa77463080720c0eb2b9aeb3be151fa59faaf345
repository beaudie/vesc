{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "11a72bfc_8d876df6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2021-04-02T00:06:38Z",
      "side": 1,
      "message": "Fran wants AGI to get debug-utils markers for cases when the vertex attribute format isn\u0027t supported by the Vulkan driver (e.g. R16G16_SSCALED).  Seems like it also warrants a performance warning.\n\nSeems like at least some of the other performance warnings should be raised to AGI as well.  I\u0027m thinking of combining these.  I\u0027d like your thoughts.",
      "revId": "fa77463080720c0eb2b9aeb3be151fa59faaf345",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "10096f97_1969c8dc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2021-04-02T14:51:35Z",
      "side": 1,
      "message": "\u003e Fran wants AGI to get debug-utils markers for cases when the vertex attribute format isn\u0027t supported by the Vulkan driver (e.g. R16G16_SSCALED).  Seems like it also warrants a performance warning.\n\nIs it a performance impact for the native driver also?   Or are we misleading developers using AGI to profile their applications which won\u0027t be using ANGLE in production?   Since it\u0027s the same underlying HW, presumably the format is handled the same for both GLES and VK, but I don\u0027t know what kinds of tricks are available to the native driver that we can\u0027t use.",
      "parentUuid": "11a72bfc_8d876df6",
      "revId": "fa77463080720c0eb2b9aeb3be151fa59faaf345",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a05ea5d8_f06cef86",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2021-04-02T15:28:41Z",
      "side": 1,
      "message": "Great questions Tim.  The performance implications are less clear than we thought.  Omar did one round of testing yesterday and found no performance difference.  We\u0027ll learn more about this as he continues to investigate.\n\nChris reported that [redacting] has HW support for SSCALED, but didn\u0027t put it in their Vulkan driver because the spec didn\u0027t require it.\n\nOne thing clear is that AGI on Pixel 4 did not show what the application requested because ANGLE is falling back to FP32 in cases where SSCALED is requested and wasn\u0027t supported by the Pixel 4 Vulkan driver.  This came up because Fran asked the ISV to compress their vertex attributes and they replied that they already had, but that AGI was showing something different.  We don\u0027t want ISVs to be misled by this.",
      "parentUuid": "10096f97_1969c8dc",
      "revId": "fa77463080720c0eb2b9aeb3be151fa59faaf345",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "74927907_66d15197",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2021-04-02T16:28:28Z",
      "side": 1,
      "message": "Yeah, it\u0027ll certainly be tricky getting the developer messaging right since they\u0027re debugging on one driver but shipping on another (I probably sound like a broken record at this point).\n\nIf we really want to clarify the user messaging, we should be taking a page out of (for example) ARM\u0027s playbook and publishing some \"best practices\" articles.   Those could include things like what developers should do to write the most \"portable\" version of their game by doing things like using formats both the native GLES driver and ANGLE support.   Unfortunately, since that\u0027s HW-specific, it may also need to be accompanied with tools that query the underlying hardware and output which formats ANGLE can support natively vs having to emulate.\n\n\u003e This came up because Fran asked the ISV to compress their vertex attributes and they replied that they already had, but that AGI was showing something different.  We don\u0027t want ISVs to be misled by this.\n\nThis should be treated as a really big issue with the AGI+ANGLE product.   Once a developer can\u0027t trust a tool, they\u0027ll move on and it\u0027ll be a long time to earn that trust back.   Luckily this was a quick \"oops\", versus them wasting any amount of time due to AGI lying to them.",
      "parentUuid": "a05ea5d8_f06cef86",
      "revId": "fa77463080720c0eb2b9aeb3be151fa59faaf345",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "42eab51b_127bc8da",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2021-04-02T17:09:04Z",
      "side": 1,
      "message": "Since the discussion was turning broader, I\u0027m cc\u0027ing Fran and Omar + other ANGLE team members.",
      "revId": "fa77463080720c0eb2b9aeb3be151fa59faaf345",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "016264ba_034c98db",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2021-04-02T17:09:04Z",
      "side": 1,
      "message": "\u003e ... publishing some \"best practices\" articles.\n\nYes.  Fran, Omar, et.al are trying to create an Android \"best practice\" guide for applications.  They are using AGI/ANGLE for GLES apps.\n\nGood point that we should broaden it to take into account what we are learning about ANGLE and not just native GLES drivers.\n\n\n\u003e Yeah, it\u0027ll certainly be tricky getting the developer messaging right since they\u0027re debugging on one driver but shipping on another (I probably sound like a broken record at this point)\n\nPlease keep being a \"broken record\" on this point:-).  It reinforces part of why we must keep improving ANGLE\u0027s performance, app-compat, etc.\n\nBTW, I get pinged at times with cases where ANGLE appears to behave differently than the native GLES drivers.  I\u0027ll try to share that info more broadly.  In one case, ANGLE was more optimal (ANGLE didn\u0027t break a render pass and/or store depth/stencil at the end of a render pass because the app invalidated depth/stencil and didn\u0027t draw to it afterwards).  We\u0027ll live with that difference:-).\n\n\u003e ... tools that query the underlying hardware and output which formats ANGLE can support natively vs having to emulate.\n\nGood point.  We might want to create a little tool/APK that we can install on a variety of phones (different GPUs and drivers) to see what formats are [well-]supported via native GLES and Vulkan drivers; and maybe do some performance comparisons of ANGLE vs. native GLES.  Perhaps this is something that Omar and his team should do?\n\nGiven what Chris found (at least one Vulkan driver didn\u0027t advertise SSCALE formats that the HW supported because the Vulkan spec didn\u0027t require it), we should probably create a Vulkan extension that we ask mobile IHVs to support.  Technically, an extension might not be needed, but it\u0027s easily queried, so that we can quickly discover which drivers support the desired foramts.\n\n\u003e This should be treated as a really big issue with the AGI+ANGLE product.\n\nYes, it\u0027s being treated as a big issue!\n\nWhen Fran requested Vulkan debug-util markers that AGI can show, I immediately thought about the performance warnings that ANGLE sends to logcat.  We should look at surfacing some/all of those (appropriately) through AGI.",
      "parentUuid": "74927907_66d15197",
      "revId": "fa77463080720c0eb2b9aeb3be151fa59faaf345",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6aff6014_fd8ce01f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2021-04-02T17:11:15Z",
      "side": 1,
      "message": "I see that Omar created two bugs, one of which wants this CL.  However, the discussion in this CL has gotten broader than what both of those bugs cover.  Some folks are OOO for the Easter weekend (4 days in Canada).  Let\u0027s keep discussing some of the topics here for now.",
      "revId": "fa77463080720c0eb2b9aeb3be151fa59faaf345",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1bfa5286_b6d0f7ef",
        "filename": "src/libANGLE/renderer/vulkan/VertexArrayVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 583,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2021-04-02T16:28:28Z",
      "side": 1,
      "message": "Based on your other comment \"Hardware\" is not entirely accurate and should probably be updated to \"Vulkan driver\".\n\nAlso, it would be good to output which format is unsupported and, if possible, what it\u0027s being converted to.",
      "revId": "fa77463080720c0eb2b9aeb3be151fa59faaf345",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ddacf391_4891cab7",
        "filename": "src/libANGLE/renderer/vulkan/VertexArrayVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 583,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2021-04-02T17:09:04Z",
      "side": 1,
      "message": "Agreed.  I did want to act on Fran\u0027s request (by starting the CL), but at this point, I want to wait on the wording until we get more data.",
      "parentUuid": "1bfa5286_b6d0f7ef",
      "revId": "fa77463080720c0eb2b9aeb3be151fa59faaf345",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "88f28bd8_26044bb1",
        "filename": "src/libANGLE/renderer/vulkan/VertexArrayVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 583,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-04-05T06:34:52Z",
      "side": 1,
      "message": "Would be good to issue the warning when !bindingIsAligned too (or a different warning).\n\nAlso, I suggest different warnings for the CPU- and GPU-based conversion paths. The former should be a HIGH severity warning that includes the words \"GPU stall\".",
      "parentUuid": "ddacf391_4891cab7",
      "revId": "fa77463080720c0eb2b9aeb3be151fa59faaf345",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}