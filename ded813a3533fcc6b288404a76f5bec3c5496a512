{
  "comments": [
    {
      "key": {
        "uuid": "e85b85ec_978c9034",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-08-20T22:32:54Z",
      "side": 1,
      "message": "Here\u0027s a CL that deals with mContentDefined at endRP time.",
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "86f49aed_0a6ffd49",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-08-21T17:49:47Z",
      "side": 1,
      "message": "Looks like most of this change is reverting the previous change. Probably good to squash them.",
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "26cbaffe_a248031e",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.h",
        "patchSetId": 1
      },
      "lineNbr": 955,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-08-20T22:37:27Z",
      "side": 1,
      "message": "instead of storing the RT pointer, you can store the ImageHelper * when we start the RP.\n\nthis will also involve moving mContentDefined into the ImageHelper.",
      "range": {
        "startLine": 955,
        "startChar": 8,
        "endLine": 955,
        "endChar": 33
      },
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ebef2c70_c6057166",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.h",
        "patchSetId": 1
      },
      "lineNbr": 955,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-08-20T22:38:22Z",
      "side": 1,
      "message": "FYI you\u0027d need a content defined in the ImageHelper per-subresource, so I was thinking you explicitly store mStencilContentDefined and mDepthContentDefined.",
      "parentUuid": "26cbaffe_a248031e",
      "range": {
        "startLine": 955,
        "startChar": 8,
        "endLine": 955,
        "endChar": 33
      },
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6ca3527a_2bd0145b",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.h",
        "patchSetId": 1
      },
      "lineNbr": 955,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-08-20T23:05:10Z",
      "side": 1,
      "message": "\"Thinking out loud\" ...\n\nDoes such a change really help anything?  The users of mContentDefined for depth and stencil treat them together.  For example, RenderTargetVk::onDepthStencilDraw(), FramebufferVk::startNewRenderPass(), and FramebufferVk::invalidateImpl() all treat them as a unit, through the RenderTargetVk.\n\nIn favor of the idea, if we rework the code that treats them together, we can treat depth and stencil differently as far as loadOp and storeOp go.  That\u0027s an optimization.  Do we need to optimize it though?  IIRC PUBG doesn\u0027t create a stencil buffer, but does invalidate it.  Thus, it doesn\u0027t help PUBG, and PUBG is the only app we know of that invalidates depth/stencil and needs the render pass to not be broken.  The current CL meets PUBG\u0027s needs fine.\n\nSeems to me that it would be better to work on delaying vkAcquireNextImage, but I\u0027m open.\n\nYour thoughts?",
      "parentUuid": "ebef2c70_c6057166",
      "range": {
        "startLine": 955,
        "startChar": 8,
        "endLine": 955,
        "endChar": 33
      },
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1e498c4c_8d57d73c",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.h",
        "patchSetId": 1
      },
      "lineNbr": 955,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-08-21T02:10:51Z",
      "side": 1,
      "message": "Just to make sure, my previous comment was a sincere attempt to think through this.  I hope it came across that way.",
      "parentUuid": "6ca3527a_2bd0145b",
      "range": {
        "startLine": 955,
        "startChar": 8,
        "endLine": 955,
        "endChar": 33
      },
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2ded901c_8bfa43c6",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.h",
        "patchSetId": 1
      },
      "lineNbr": 955,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-08-21T17:49:47Z",
      "side": 1,
      "message": "I\u0027m all for moving mContentDefined to ImageHelper, but perhaps it should be a split change.\n\n\u003e The users of mContentDefined for depth and stencil treat them together.\n\nBut they don\u0027t necessarily have to. Right now, if the application invalidates stencil but not depth, we still use loadOp\u003dLOAD for stencil because we don\u0027t track contents-defined separately.\n\nThat said, I don\u0027t know if any application would really invalidate one and not the other, or whether loading one and not the other has any practical benefits, so I\u0027m skeptical as to whether tracking them separately is useful TBH.",
      "parentUuid": "1e498c4c_8d57d73c",
      "range": {
        "startLine": 955,
        "startChar": 8,
        "endLine": 955,
        "endChar": 33
      },
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2308ce04_14741fde",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.h",
        "patchSetId": 1
      },
      "lineNbr": 955,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-08-21T18:11:45Z",
      "side": 1,
      "message": "If Shabi\u0027s also in favor of moving mContentDefine to ImageHelper I\u0027m confident to recommend this refactor. Agree a split change is good. As for separate tracking, I would expect it\u0027s just easier to track separately, but YMMV.",
      "parentUuid": "2ded901c_8bfa43c6",
      "range": {
        "startLine": 955,
        "startChar": 8,
        "endLine": 955,
        "endChar": 33
      },
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6c80ee66_47a26a1e",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.h",
        "patchSetId": 1
      },
      "lineNbr": 955,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-08-21T20:41:41Z",
      "side": 1,
      "message": "To clarify ...\n\n1) \"Split change\" meaning I land this CL and then do another CL for the bigger refactor?\n\n2) Move mContentDefined from RenderTargetVk -\u003e ImageHelper (for color as well as D/S).\n\n3) Modify all the code that uses mContentDefined, not just my previous CL.\n\n4) I should look at effort of splitting mContentDefined for depth and stencil, and do it if it fits in fixit week?",
      "parentUuid": "2308ce04_14741fde",
      "range": {
        "startLine": 955,
        "startChar": 8,
        "endLine": 955,
        "endChar": 33
      },
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2d6e8a8b_6b78cb47",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.h",
        "patchSetId": 1
      },
      "lineNbr": 955,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-08-23T05:19:19Z",
      "side": 1,
      "message": "IMO:\n\n1) Yes\n2) Yes\n3) Yes\n4) I personally wouldn\u0027t bother until proven necessary, but a trivial change either way, so whatever feels cleaner.\n\nRe: 2, we need to think about how to track mContentDefined per subresource as efficient as possible. I originally thought maybe we could use a bitset and do this per mip level. However, render targets on cube map faces are common, I think? I also thought about bitset on levels*layers and assume any subresource \u003e\u003d 64 is always defined (and hope doesn\u0027t cause trouble in practice), but a reasonable 1kx1k cubemap with mips has 66 subresources!\n\nProbably reasonable to expect no one creates a render target for the last mips, so I think the latter should work fine (that is, use a bitset\u003c64\u003e indexed by (levelVk * mLayerCount + layer) to track this, and assume true for indices \u003e\u003d 64).",
      "parentUuid": "6c80ee66_47a26a1e",
      "range": {
        "startLine": 955,
        "startChar": 8,
        "endLine": 955,
        "endChar": 33
      },
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eb3b59ab_bd2cd4b5",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.h",
        "patchSetId": 1
      },
      "lineNbr": 955,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-08-23T14:35:56Z",
      "side": 1,
      "message": "2) -\u003e there\u0027s good reasons to skip color for now. Basically due to the complexity that you\u0027re getting into with Shabi\u0027s comment weighed against the fact we haven\u0027t seen invalidate called on anything other than depth/stencil in the wild.\n\nAt the very least you could land a split CL that does depth/stencil then (potentially) handle color after.",
      "parentUuid": "2d6e8a8b_6b78cb47",
      "range": {
        "startLine": 955,
        "startChar": 8,
        "endLine": 955,
        "endChar": 33
      },
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cf663d6e_7c1c3828",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.h",
        "patchSetId": 1
      },
      "lineNbr": 955,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-08-24T15:17:59Z",
      "side": 1,
      "message": "Thanks for the feedback.  I\u0027ll land this CL and work on 2 \u0026 3 for depth/stencil.",
      "parentUuid": "eb3b59ab_bd2cd4b5",
      "range": {
        "startLine": 955,
        "startChar": 8,
        "endLine": 955,
        "endChar": 33
      },
      "revId": "ded813a3533fcc6b288404a76f5bec3c5496a512",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}