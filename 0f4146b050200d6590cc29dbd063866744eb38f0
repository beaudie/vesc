{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ac888c5a_9e7b1bdd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2022-01-28T01:00:16Z",
      "side": 1,
      "message": "Here is the testing data on Pixel6: \n1) Apply https://chromium-review.googlesource.com/c/angle/angle/+/3421377\n2) Run: \nout/ReleaseWithSymbols/angle_perftests --gtest_filter\u003dTracePerfTest.Run/vulkan_offscreen_gardenscapes --enable-all-trace-tests --single-process-tests --verbose --verbose-logging --local-output  --minimize-gpu-work --max-steps-performed 10000  --num-retries 0\n\nAfter:\n* e285344e9 (HEAD -\u003e minimizeGPUWork_drawElementsKeepCount6) (2022-01-27) cclao@google.com Vulkan: Cache commonly used 6 ushorts stream index array data\nI   61.648s run_tests_on_device(0C211FDF600050)  Mean result time: 2.4867 ms.\nI   61.992s run_tests_on_device(0C211FDF600050)  Mean result time: 2.3863 ms.\nI   63.240s run_tests_on_device(0C211FDF600050)  Mean result time: 2.4216 ms.\nI   60.919s run_tests_on_device(0C211FDF600050)  Mean result time: 2.2854 ms.\nI   60.953s run_tests_on_device(0C211FDF600050)  Mean result time: 2.2840 ms.\n(average 2.37 ms)\n\nBefore:\n* adf894866 (2022-01-27) cclao@google.com Debug: Modify minimize-gpu-work to keep drawElements(count\u003d\u003d6)\nI   62.809s run_tests_on_device(0C211FDF600050)  Mean result time: 2.4880 ms.\nI   65.307s run_tests_on_device(0C211FDF600050)  Mean result time: 2.6395 ms.\nI   62.525s run_tests_on_device(0C211FDF600050)  Mean result time: 2.5751 ms.\nI   65.020s run_tests_on_device(0C211FDF600050)  Mean result time: 2.5217 ms.\nI   62.518s run_tests_on_device(0C211FDF600050)  Mean result time: 2.4806 ms.\n(average 2.54 ms)\t",
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6b614e3a_d8ca53cf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-01-28T13:40:46Z",
      "side": 1,
      "message": "Hey Charlie, what are the pros/cons of using a generic signature for any index buffer \u003c\u003d 6 elements?",
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ce3daf38_0d33b25d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2022-01-28T17:42:59Z",
      "side": 1,
      "message": "In the traces we have, I am not seeing any usage less than 6, so I am not seeing much value to optimize count\u003c6 usage case. if we find any usage case for that, we can easily expand this mechanism, I think. I guess the answer really is that I am trying to target caching known commonly used patterns here to keep cache size minimum, (right now its maximum 4 entries). Also I have changed the implementation from original patchset that it no longer relying on specific data, just cache the first 4 sets of data with count of 6 instead of pre-create with known data set.",
      "parentUuid": "6b614e3a_d8ca53cf",
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "485a2c63_502cb679",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-01-28T19:59:46Z",
      "side": 1,
      "message": "Ah, I hadn\u0027t looked at your new code. The difference between my suggestion and your implementation is that I would have implemented an unlimited cache, and would have used size \u003c\u003d 6 because that would also cover potential other less frequent usage patterns.",
      "parentUuid": "ce3daf38_0d33b25d",
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8c4c0402_24216963",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 57,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-01-28T19:32:20Z",
      "side": 1,
      "message": "nit: no need for static",
      "range": {
        "startLine": 57,
        "startChar": 0,
        "endLine": 57,
        "endChar": 6
      },
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "98c6c7cc_6c3e6c1f",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 57,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2022-01-28T21:32:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8c4c0402_24216963",
      "range": {
        "startLine": 57,
        "startChar": 0,
        "endLine": 57,
        "endChar": 6
      },
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9d4cc5d2_1cc512c2",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1237,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-01-28T19:59:46Z",
      "side": 1,
      "message": "nit: not necessary to reinterpret_cast",
      "range": {
        "startLine": 1237,
        "startChar": 35,
        "endLine": 1237,
        "endChar": 51
      },
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cf5c51f6_21941444",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1237,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2022-01-28T21:32:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9d4cc5d2_1cc512c2",
      "range": {
        "startLine": 1237,
        "startChar": 35,
        "endLine": 1237,
        "endChar": 51
      },
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "876cfd3d_d40255d3",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1243,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-01-28T19:32:20Z",
      "side": 1,
      "message": "nit: Please put in a helper",
      "range": {
        "startLine": 1217,
        "startChar": 0,
        "endLine": 1243,
        "endChar": 13
      },
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3d7c94e0_0e252c57",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1243,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2022-01-28T21:32:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "876cfd3d_d40255d3",
      "range": {
        "startLine": 1217,
        "startChar": 0,
        "endLine": 1243,
        "endChar": 13
      },
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5bcd4b32_068e7765",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1250,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-01-28T19:59:46Z",
      "side": 1,
      "message": "this is a bit suspect. How about we refactor our logic to store the cache inside the vertex array instead, so the VAO can manage the ownership of the element array buffer handle. there should be no duplication possible b/c client pointers are not valid with user VAOs.",
      "range": {
        "startLine": 1250,
        "startChar": 20,
        "endLine": 1250,
        "endChar": 77
      },
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e174e5fe_ecc32b51",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1250,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-01-28T20:17:15Z",
      "side": 1,
      "message": "And the optimization could also live the front-end",
      "parentUuid": "5bcd4b32_068e7765",
      "range": {
        "startLine": 1250,
        "startChar": 20,
        "endLine": 1250,
        "endChar": 77
      },
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2397c10a_4f210932",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1250,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2022-01-28T21:32:05Z",
      "side": 1,
      "message": "Moved to VertexArrayVk. \n\nSince the call comes from backend, there is a bit challenge to make this a front end optimization. I am keeping it in vulkan backend for now, but I do agree that this could be a front end optimization as well. Anyone feel free to further improve/move it.",
      "parentUuid": "e174e5fe_ecc32b51",
      "range": {
        "startLine": 1250,
        "startChar": 20,
        "endLine": 1250,
        "endChar": 77
      },
      "revId": "0f4146b050200d6590cc29dbd063866744eb38f0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}