{
  "comments": [
    {
      "key": {
        "uuid": "c65388f0_7e45a2b1",
        "filename": "src/tests/gl_tests/StateChangeTest.cpp",
        "patchSetId": 16
      },
      "lineNbr": 3580,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2019-05-23T03:08:46Z",
      "side": 1,
      "message": "Like we saw, this actually ends up setting the dirty bit for front face. I believe the test fails because `updateFlipViewportDrawFramebuffer()` is not yet called when the front face dirty bit is handled, so the front face is actually always set to the opposite of what it should be here (both in the case of user to default change and back). That is:\n\n    Set User FBO -\u003e flip \u003d false\n    \u003cclear\u003e\n    Handle Dirty Face -\u003e use false flip\n    Handle Dirty FBO (Default) -\u003e flip \u003d true\n    \u003cdraw\u003e\n    Handle Dirty Face -\u003e use flip \u003d true\n    Handle Dirty FBO (User) -\u003e flip \u003d false\n\nThis breaks because \"Handle Dirty Face\" is using the previous framebuffer\u0027s cached flip flag.\n\nAnd the reason why the test passes if you move this call to before the first draw call (without the fix in ContextVk.cpp) is that then what you get is:\n\n    Set User FBO -\u003e flip \u003d false\n    \u003cclear\u003e\n    Handle Dirty Face -\u003e use false flip\n    Handle Dirty FBO (Default) -\u003e flip \u003d true\n    \u003cdraw\u003e\n    Handle Dirty FBO (User) -\u003e flip \u003d false\n\nNote that the last time front face was set, it was using false flip and it\u0027s not updated since.\n\nI believe you could have caught this error if you didn\u0027t disable culling for the first draw call, but just made sure the winding of the vertices used for the draw are opposite the winding that\u0027s being culled.\n\nAlternatively, you could set `glCullFace` to `GL_FRONT` or `GL_BACK` based on whether the front face is `GL_CCW` or `GL_CW`, knowing the winding of the vertices drawQuad uses, so that the first draw call is never culled. Does that make sense?",
      "range": {
        "startLine": 3580,
        "startChar": 4,
        "endLine": 3580,
        "endChar": 27
      },
      "revId": "877c2adc7e91d0bf6206f9f7c30baf8300679101",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5067d884_e5140e91",
        "filename": "src/tests/gl_tests/StateChangeTest.cpp",
        "patchSetId": 16
      },
      "lineNbr": 3580,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2019-05-23T17:04:01Z",
      "side": 1,
      "message": "Cool, sounds like we have two approaches to these tests.   I\u0027m going to keep this one since it seems to work.\n\nAre there other variations that anyone thinks we should add?",
      "parentUuid": "c65388f0_7e45a2b1",
      "range": {
        "startLine": 3580,
        "startChar": 4,
        "endLine": 3580,
        "endChar": 27
      },
      "revId": "877c2adc7e91d0bf6206f9f7c30baf8300679101",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bf0d99ba_4ee4bba7",
        "filename": "src/tests/gl_tests/StateChangeTest.cpp",
        "patchSetId": 16
      },
      "lineNbr": 3580,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2019-05-23T17:45:19Z",
      "side": 1,
      "message": "Could you add a flag to this function to either:\n\n1. Disable culling on first draw + glFrontFace on second draw\n2. glFrontFace on first draw, appropriate winding on first draw so its never culled. Fixed winding on the second draw.\n\nThen add four TEST_P instances below instead of 2 for all combinations.\n\nThe test you already have is a good test and catches one bug, but it doesn\u0027t catch a second bug (where not having glFrontFace dirty in the second draw should also fail).",
      "parentUuid": "5067d884_e5140e91",
      "range": {
        "startLine": 3580,
        "startChar": 4,
        "endLine": 3580,
        "endChar": 27
      },
      "revId": "877c2adc7e91d0bf6206f9f7c30baf8300679101",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ece6e1c_a38a052c",
        "filename": "src/tests/gl_tests/StateChangeTest.cpp",
        "patchSetId": 16
      },
      "lineNbr": 3580,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2019-05-23T20:04:13Z",
      "side": 1,
      "message": "I think the tests are already doing what\u0027s described in (1), so I don\u0027t understand what changes to make here.\n\n\nFor (2), I think you\u0027re describing replacing:\n    glDisable(GL_CULL_FACE);\nwith:\n    glEnable(GL_CULL_FACE);\n    glCullFace(GL_BACK);\n    glFrontFace(GL_CCW);\nso the quad is not culled.   And then for the second draw, always use GL_CCW to make sure it draws again.   Is that correct?",
      "parentUuid": "bf0d99ba_4ee4bba7",
      "range": {
        "startLine": 3580,
        "startChar": 4,
        "endLine": 3580,
        "endChar": 27
      },
      "revId": "877c2adc7e91d0bf6206f9f7c30baf8300679101",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1611a131_93127cf1",
        "filename": "util/shader_utils.h",
        "patchSetId": 16
      },
      "lineNbr": 92,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2019-05-23T03:08:46Z",
      "side": 1,
      "message": "The shader no longer swizzles.",
      "range": {
        "startLine": 92,
        "startChar": 3,
        "endLine": 92,
        "endChar": 65
      },
      "revId": "877c2adc7e91d0bf6206f9f7c30baf8300679101",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "271307bb_0a1f869e",
        "filename": "util/shader_utils.h",
        "patchSetId": 16
      },
      "lineNbr": 92,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2019-05-23T17:04:01Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1611a131_93127cf1",
      "range": {
        "startLine": 92,
        "startChar": 3,
        "endLine": 92,
        "endChar": 65
      },
      "revId": "877c2adc7e91d0bf6206f9f7c30baf8300679101",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}