{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "a2023e25_3db3e68f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1002767
      },
      "writtenOn": "2021-09-28T12:26:06Z",
      "side": 1,
      "message": "This CL fixes 14 tests while breaking 11 tests, so it\u0027s a net positive of 3 more tests passing. Also, instead of crashes, the new failures are all pixel differences. A few of them are clearly missing RGB \u003c-\u003e BGR conversion somewhere (see conformance/canvas/webgl-to-2d-canvas.html, for example), but I\u0027m still unsure where this issue is.\nThis also makes the code spec compliant regarding Vulkan, where the IOSurface object is no longer treated as a generic blob of memory (which it isn\u0027t, it has properties like planes, row pitch, etc).\nAll in all, despite a delta of only 3 more tests passing, I think the change is a net positive.\n",
      "revId": "c5f5eb3080b814896c71e8719b0e4bba28d3753d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3360f7da_ec32d32e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1002767
      },
      "writtenOn": "2021-09-28T12:32:21Z",
      "side": 1,
      "message": "Yuly, if this lands, I\u0027ll need to change the expectations file quickly to avoid issues, since this CL breaks some tests while fixing other tests.",
      "revId": "c5f5eb3080b814896c71e8719b0e4bba28d3753d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "00c14700_a552be0e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-09-28T14:32:55Z",
      "side": 1,
      "message": "Question for you Charlie",
      "revId": "c5f5eb3080b814896c71e8719b0e4bba28d3753d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "22f8bc70_338b460f",
        "filename": "src/libANGLE/renderer/vulkan/mac/IOSurfaceSurfaceVkMac.mm",
        "patchSetId": 10
      },
      "lineNbr": 46,
      "author": {
        "id": 1002745
      },
      "writtenOn": "2021-09-28T13:16:04Z",
      "side": 1,
      "message": "Oh, I actually see where the RGB \u003c-\u003e BGR issue is. The requested format here is GL_RGB. If we don\u0027t specify an RGB format here as the internal format (GL_RGBX8_ANGLEX), then staging updates start failing, because external copy texture operations will happen in RGBA, so we need in internal RGB format (as opposed to BGR) to avoid issues.\n\nBUT the IOSurface actually contains data in BGRA format. In releaseTexImage, we can easily solve that by doing a readback to BGRA. But in bindTexImage, we actually need to perform a format conversion in this case in order to read the input data properly. Is there a way to \"stage\" a format conversion?",
      "range": {
        "startLine": 46,
        "startChar": 4,
        "endLine": 46,
        "endChar": 72
      },
      "revId": "c5f5eb3080b814896c71e8719b0e4bba28d3753d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b79974a7_8427e0de",
        "filename": "src/libANGLE/renderer/vulkan/mac/IOSurfaceSurfaceVkMac.mm",
        "patchSetId": 10
      },
      "lineNbr": 46,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-09-28T14:32:16Z",
      "side": 1,
      "message": "\u003e Is there a way to \"stage\" a format conversion?\n\n@Charlie just did that!\n\n\u003e The requested format here is GL_RGB ... BUT the IOSurface actually contains data in BGRA format\n\nNot really familiar with the logic here, but if the real format is BGRA, could all your problems be solved by simply specifying GL_BGRX8_ANGLEX (if it exists, or something like that) instead of GL_RGBX8_ANGLEX?\n\nI\u0027m not really sure what it means to \"request\" a format with the actual format being something else.",
      "parentUuid": "22f8bc70_338b460f",
      "range": {
        "startLine": 46,
        "startChar": 4,
        "endLine": 46,
        "endChar": 72
      },
      "revId": "c5f5eb3080b814896c71e8719b0e4bba28d3753d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c1917d8c_308806d9",
        "filename": "src/libANGLE/renderer/vulkan/mac/IOSurfaceSurfaceVkMac.mm",
        "patchSetId": 10
      },
      "lineNbr": 46,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-09-28T14:32:55Z",
      "side": 1,
      "message": "CC @Charlie for real this time",
      "parentUuid": "b79974a7_8427e0de",
      "range": {
        "startLine": 46,
        "startChar": 4,
        "endLine": 46,
        "endChar": 72
      },
      "revId": "c5f5eb3080b814896c71e8719b0e4bba28d3753d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5f62c96d_539fb416",
        "filename": "src/libANGLE/renderer/vulkan/mac/IOSurfaceSurfaceVkMac.mm",
        "patchSetId": 10
      },
      "lineNbr": 46,
      "author": {
        "id": 1002745
      },
      "writtenOn": "2021-09-28T14:48:05Z",
      "side": 1,
      "message": "About using GL_BGRX8_ANGLEX, that doesn\u0027t work, because the expected internal format here, when specifying { GL_RGB, GL_UNSIGNED_BYTE } is going to be GL_RGBA8. If I use GL_BGRX8_ANGLEX, then the internal format becomes GL_BGRA8, and any staged update from copy operations, for example, fail to get applied because the actual formats don\u0027t match:\nhttps://source.chromium.org/chromium/chromium/src/+/main:third_party/angle/src/libANGLE/renderer/vulkan/vk_helpers.cpp;l\u003d6578",
      "parentUuid": "c1917d8c_308806d9",
      "range": {
        "startLine": 46,
        "startChar": 4,
        "endLine": 46,
        "endChar": 72
      },
      "revId": "c5f5eb3080b814896c71e8719b0e4bba28d3753d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}