{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "bfddce88_8ef407b4",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.h",
        "patchSetId": 3
      },
      "lineNbr": 335,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2021-10-15T16:59:10Z",
      "side": 1,
      "message": "I like the intention of the comment and the design.  I\u0027m not sure I\u0027m following all of it, and I want it to be easy for everybody to understand in the future.  Let me test my understanding:\n\nANI \u003d vkAcquireNextImageKHR()\nQS \u003d vkQueueSubmit()\nQP \u003d vkQueuePresentKHR()\n\nI\u0027m not sure what \"Wait()\" and \"serial S\u003cletter\u003e\" are.  I think \"Sa\" is one of the elements of mAcquireImageSemaphores (as are \"Sc\" and \"Se\").  True?\n\nI don\u0027t see a serial associated with them.  What does \"serial Sa\" mean?\n\nWhat are \"Sb\", \"Sd\", and \"Sf\"?  Is part of the idea that there may be multiple QS\u0027s per frame, and you need semaphores for each?\n\nI suspect that \"Wait(Sb)\" is ANGLE waiting on a fence (called Sb, but perhaps should be Fa).  True?  I think the idea is that ANGLE is blocking itself so that it isn\u0027t running too far ahead of the GPU/PE.\n\nAlso, is \"Wait(Sb)\" trying to say that it\u0027s waiting for the last QS of a previous frame to finish?",
      "revId": "f95d9b98ffb8ef7eae87f49d742ce6690d8e97dc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "da4b5cc2_ba133dd2",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.h",
        "patchSetId": 3
      },
      "lineNbr": 335,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-15T19:33:26Z",
      "side": 1,
      "message": "Ok, let me clarify here first, and I\u0027ll update the comment once we reach a conclusion.\n\n\u003e I suspect that \"Wait(Sb)\" is ANGLE waiting on a fence (called Sb, but perhaps should be Fa).  True?\n\nYes. For every QS there is a fence and ANGLE identifies the fence (and other stuff) corresponding to the QS with a serial. So yes Sa and Fa are really the same thing. Wait is vkWaitForFences.\n\n\u003e Is part of the idea that there may be multiple QS\u0027s per frame, and you need semaphores for each?\n\nYes there could be multiple QS\u0027s per frame, and you have a *fence* for each. The ANI semaphore is used by the first QS after ANI, but not the ones that come after it.\n\nThe reason I didn\u0027t call them S1, S2, S3 etc is to avoid implying that there are no QS\u0027s in between (for example such that the reader doesn\u0027t think that for some reason there are always two QS\u0027s per frame!)\n\n\u003e Also, is \"Wait(Sb)\" trying to say that it\u0027s waiting for the last QS of a previous frame to finish?\n\nYes, that\u0027s the CPU throttling code here: https://source.chromium.org/chromium/chromium/src/+/main:third_party/angle/src/libANGLE/renderer/vulkan/SurfaceVk.cpp;l\u003d1368",
      "parentUuid": "bfddce88_8ef407b4",
      "revId": "f95d9b98ffb8ef7eae87f49d742ce6690d8e97dc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "27a0faf9_d34b5273",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.h",
        "patchSetId": 3
      },
      "lineNbr": 353,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2021-10-15T16:59:10Z",
      "side": 1,
      "message": "BTW, there seems to be an implicit assumption that there will be 3 images in the swapchain.  I\u0027ve seen cases where Android\u0027s PE is providing 4 images for FIFO, even though ANGLE asked for 3.  I don\u0027t know why, but I\u0027ve clearly seen it.\n\nFYI ... I also know of cases where Windows will provide 1 image in the swapchain because the PE is copying the image (behind the scenes) after QP.\n\nI think the design will work for all of these cases, but I want to make sure the \"non-initiated to WSI\" don\u0027t assume things:-).",
      "revId": "f95d9b98ffb8ef7eae87f49d742ce6690d8e97dc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2f6f508f_9f46e8b1",
        "filename": "src/libANGLE/renderer/vulkan/SurfaceVk.h",
        "patchSetId": 3
      },
      "lineNbr": 353,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-15T19:33:26Z",
      "side": 1,
      "message": "Ack. I recall all these from our conversations a few years back :)\n\nI don\u0027t believe any of the docs or comments are particularly tied to the swapchain having any number of images. In truth, the swapchain could have 1000 images but it only ping pongs between 0 and 1, or even just return 0 all the time, so the algorithms should be ready to deal with 2 image or 1 image swapchains already.\n\n\u003e there seems to be an implicit assumption that there will be 3 images in the swapchain.\n\nMaybe used as an example in the doc, but if you have any specific place where this assumption is made, do let me know and I\u0027ll update the comment.",
      "parentUuid": "27a0faf9_d34b5273",
      "revId": "f95d9b98ffb8ef7eae87f49d742ce6690d8e97dc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}