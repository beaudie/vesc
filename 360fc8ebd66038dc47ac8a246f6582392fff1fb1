{
  "comments": [
    {
      "key": {
        "uuid": "698771e7_d7727664",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 5
      },
      "lineNbr": 484,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-08-17T16:39:00Z",
      "side": 1,
      "message": "My understanding is that clearWithLoadOp is not always to end RP. For example, if yoiu bind a FBO and disable depth test and draw something into color buffer, that starts a RP. Then you enable depth buffer and clear depth attachment, that should not starts a new RP.",
      "range": {
        "startLine": 484,
        "startChar": 33,
        "endLine": 484,
        "endChar": 62
      },
      "revId": "360fc8ebd66038dc47ac8a246f6582392fff1fb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a5efd440_19e29389",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 5
      },
      "lineNbr": 484,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-08-17T16:56:10Z",
      "side": 1,
      "message": "This was relying on having already ended the render pass when a new draw FBO attachment was bound.   That is removed with this CL (the onRenderPassFinished() in ContextVk::syncState()), so we need to end it here if we have a started render pass for a different (previous) FBO.\n\nThe sequence of events you described should fall into the \u0027if\u0027 above, since the render pass was started by the draw command (hasStartedRenderPassWithCommands() \u003d\u003d true) and then the same FBO has the depth attachment cleared (hasStartedRenderPassWithFramebuffer() \u003d\u003d true).   However, if a new FBO is bound as the draw attachment, we will need to end the render pass by falling into the \u0027else\u0027 conditional here.",
      "parentUuid": "698771e7_d7727664",
      "range": {
        "startLine": 484,
        "startChar": 33,
        "endLine": 484,
        "endChar": 62
      },
      "revId": "360fc8ebd66038dc47ac8a246f6582392fff1fb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9890b9df_fe42d7fa",
        "filename": "src/libANGLE/renderer/vulkan/FramebufferVk.cpp",
        "patchSetId": 5
      },
      "lineNbr": 484,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-08-17T17:30:27Z",
      "side": 1,
      "message": "True. So this is the case either RP not started, or started but empty, or started but with a stale FB. \nstarted but empty: Shouldn\u0027t we still not end RP?\nstarted but with a different RP: I can see why you do this now. But onRenderPassFinished is intended to force a new RP next time setupDraw is called, if that is removed, not just clear needs to handle it, setupDraw (and all other possible places that would normally start a new RP) also needs to change. If we truley pick tyhe route to defer end and start RP as much as possible, that is fine to me as well. Some explanation/comment in the source will be helpful.",
      "parentUuid": "a5efd440_19e29389",
      "range": {
        "startLine": 484,
        "startChar": 33,
        "endLine": 484,
        "endChar": 62
      },
      "revId": "360fc8ebd66038dc47ac8a246f6582392fff1fb1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}