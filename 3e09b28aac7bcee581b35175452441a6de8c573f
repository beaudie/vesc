{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "46aec99b_7f48251e",
        "filename": "src/compiler/translator/wgsl/RewritePipelineVariables.cpp",
        "patchSetId": 3
      },
      "lineNbr": 311,
      "author": {
        "id": 1105284
      },
      "writtenOn": "2024-09-06T12:51:27Z",
      "side": 1,
      "message": "This pattern looks like a good fit for a variadic template. I wrote a helper to do it:\n\n```\nnamespace impl\n{\n    size_t GetArgLength(const ImmutableString\u0026 str)\n    {\n        return str.length();\n    }\n\n    size_t GetArgLength(const char* str)\n    {\n        return std::strlen(str);\n    }\n\n    size_t GetArgsTotalSize()\n    {\n        return 0;\n    }\n\n    template \u003ctypename T, typename... Rest\u003e\n    size_t GetArgsTotalSize(const T\u0026 firstArg, Rest... rest)\n    {\n        return GetArgLength(firstArg) + GetArgsTotalSize(rest...);\n    }\n\n    void AppendStrings(ImmutableStringBuilder\u0026 builder)\n    {\n    }\n\n    template \u003ctypename T, typename... Rest\u003e\n    void AppendStrings(ImmutableStringBuilder\u0026 builder, const T\u0026 firstArg, Rest... rest)\n    {\n        builder \u003c\u003c firstArg;\n        AppendStrings(builder, rest...);\n    }\n}\n\ntemplate \u003ctypename... Args\u003e\nImmutableString BuildConcatenatedImmutableString(Args... args)\n{\n    ImmutableStringBuilder builder(impl::GetArgsTotalSize(args...));\n    impl::AppendStrings(builder, args...);\n    return builder;\n}\n```\n\nwhich lets this become: `ImmutableString globalStructVar \u003d BuildConcatenatedImmutableString(builtinReplacement, \" : \", globalType, \",\");`\n\nOnly drawback is for branches like in calculating `conversion` below you\u0027ll have to branch early and create two different strings.",
      "range": {
        "startLine": 310,
        "startChar": 12,
        "endLine": 311,
        "endChar": 76
      },
      "revId": "3e09b28aac7bcee581b35175452441a6de8c573f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e9dbeb67_4a1d72e2",
        "filename": "src/compiler/translator/wgsl/RewritePipelineVariables.cpp",
        "patchSetId": 3
      },
      "lineNbr": 351,
      "author": {
        "id": 1105284
      },
      "writtenOn": "2024-09-06T12:51:27Z",
      "side": 1,
      "message": "Should there be an else with UNREACHABLE or UNIMPLEMENTED here?",
      "range": {
        "startLine": 351,
        "startChar": 12,
        "endLine": 351,
        "endChar": 13
      },
      "revId": "3e09b28aac7bcee581b35175452441a6de8c573f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b05dc7ac_fa940873",
        "filename": "src/libANGLE/renderer/wgpu/wgpu_wgsl_util.cpp",
        "patchSetId": 3
      },
      "lineNbr": 33,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-09-06T14:39:16Z",
      "side": 1,
      "message": "If you have two names `something` and `something_else`, you will accidentally match the latter when looking for the former.\n\n(See other comment below)",
      "revId": "3e09b28aac7bcee581b35175452441a6de8c573f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aea272b2_98f70b72",
        "filename": "src/libANGLE/renderer/wgpu/wgpu_wgsl_util.cpp",
        "patchSetId": 3
      },
      "lineNbr": 46,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-09-06T14:39:16Z",
      "side": 1,
      "message": "You might have elided the copy, but instead we\u0027re iterating over the string many many times.\n\nMay I suggest reworking the algorithm here so you can change the entire string in one pass?\n\nThe marker could be `@location(NAME)`, you can use a hashmap of `name-\u003elocation` that accumulates info for all inputs and outputs, then do this:\n\n```\nLoop\n  Find next instance of @location(\n  Extract NAME\n  Look up in the location map\n  Replace with location\n```\n\nIf the NAME can be correctly extracted from `@location(@@@@@@) NAME`, that\u0027s fine too. (Right now, there\u0027s the prefix bug).\n\nIf you do that, then making a single copy of the string in this single pass is not a big deal and you don\u0027t have to be smart about the `@@@@@@` and padding etc.",
      "revId": "3e09b28aac7bcee581b35175452441a6de8c573f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7210f591_45ddea10",
        "filename": "src/libANGLE/renderer/wgpu/wgpu_wgsl_util.h",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-09-06T14:39:16Z",
      "side": 1,
      "message": "nit: Chromium style changed this rule, but so far we\u0027ve been following the former style of `*` for mutable, `const \u0026` for immutable. When called e.g. like `WglAssignLocations(shader, ...)` it\u0027s not obvious that `shader` is being modified.",
      "range": {
        "startLine": 20,
        "startChar": 37,
        "endLine": 20,
        "endChar": 38
      },
      "revId": "3e09b28aac7bcee581b35175452441a6de8c573f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}