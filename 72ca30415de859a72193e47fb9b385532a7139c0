{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "63d085b1_4af049aa",
        "filename": "src/libANGLE/ProgramExecutable.h",
        "patchSetId": 8
      },
      "lineNbr": 186,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-05-26T14:12:37Z",
      "side": 1,
      "message": "nit: You can use FlatUnorderedSet here with a reasonable limit (e.g. 4, defined in a named constant).",
      "range": {
        "startLine": 186,
        "startChar": 33,
        "endLine": 186,
        "endChar": 36
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "05e94052_f5e3c90c",
        "filename": "src/libANGLE/ProgramExecutable.h",
        "patchSetId": 8
      },
      "lineNbr": 186,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-05-27T00:16:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "63d085b1_4af049aa",
      "range": {
        "startLine": 186,
        "startChar": 33,
        "endLine": 186,
        "endChar": 36
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0c867f2_5ed39b16",
        "filename": "src/libANGLE/ProgramExecutable.h",
        "patchSetId": 8
      },
      "lineNbr": 191,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-05-26T14:12:37Z",
      "side": 1,
      "message": "Because this is only used for immutable textures, and the code is behind if (immutableSampler), I\u0027d suggest for now we don\u0027t cache this and compute it dynamically, in the cpp (not inline). If we ever need it in other instances we could consider caching it.",
      "range": {
        "startLine": 187,
        "startChar": 0,
        "endLine": 191,
        "endChar": 5
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e252fdbc_4396b1a5",
        "filename": "src/libANGLE/ProgramExecutable.h",
        "patchSetId": 8
      },
      "lineNbr": 191,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-05-26T14:50:29Z",
      "side": 1,
      "message": "\u003e I\u0027d suggest for now we don\u0027t cache this and compute it dynamically\n\nthis is what was done in PS1 but i think caching it was a response to a rethink / redesign suggestion",
      "parentUuid": "c0c867f2_5ed39b16",
      "range": {
        "startLine": 187,
        "startChar": 0,
        "endLine": 191,
        "endChar": 5
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ec340c06_0ca407c5",
        "filename": "src/libANGLE/ProgramExecutable.h",
        "patchSetId": 8
      },
      "lineNbr": 191,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-05-26T14:52:52Z",
      "side": 1,
      "message": "if computing this map dynamically is the approach then we will need to do it twice, once in `ContextVk::updateActiveTextures` and another in `ProgramExecutableVk::addTextureDescriptorSetDesc`\n\nim fine either way, just want confirmation so i can fix it and move on to other issues",
      "parentUuid": "e252fdbc_4396b1a5",
      "range": {
        "startLine": 187,
        "startChar": 0,
        "endLine": 191,
        "endChar": 5
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6a83895a_bfc3d41e",
        "filename": "src/libANGLE/ProgramExecutable.h",
        "patchSetId": 8
      },
      "lineNbr": 191,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-05-26T16:05:27Z",
      "side": 1,
      "message": "Hey Mohan,\n\nIn patch set #1 you introduced a loop outside of the existing look in `ContextVk::updateActiveTextures`. Looks like in this patch set you no longer have that loop.\n\nMy suggestion is to leave `ContextVk::updateActiveTextures` and `ProgramExecutableVk::addTexturesDescriptorSetDesc` as they are now in this patch set, and modify `ProgramExecutable` to remove the cache. Instead compute the `SamplerIndexSet` in `ProgramExecutable::`getsamplerIndexSetForTextureUnit`. Then we don\u0027t add any overhead to potential texture state changes. And we can always add the cache back in later if we need it, using this patch set as a reference.",
      "parentUuid": "ec340c06_0ca407c5",
      "range": {
        "startLine": 187,
        "startChar": 0,
        "endLine": 191,
        "endChar": 5
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "70c13bf8_46d46617",
        "filename": "src/libANGLE/ProgramExecutable.h",
        "patchSetId": 8
      },
      "lineNbr": 191,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-05-27T00:16:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6a83895a_bfc3d41e",
      "range": {
        "startLine": 187,
        "startChar": 0,
        "endLine": 191,
        "endChar": 5
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9c3875a8_ffbc92cf",
        "filename": "src/libANGLE/renderer/vulkan/ProgramExecutableVk.h",
        "patchSetId": 8
      },
      "lineNbr": 107,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-05-26T14:12:37Z",
      "side": 1,
      "message": "this structure is particularly obtuse. I think we can either use a map from \u003cTexture Unit Index\u003e to the set structure, or from \u003cSampler Serial\u003e. We should be using an flat array with pairs instead of a HashMap, or at least FlatUnorderedMap. Please also give the set structure a name.",
      "range": {
        "startLine": 107,
        "startChar": 55,
        "endLine": 107,
        "endChar": 74
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b84a69af_0061afe9",
        "filename": "src/libANGLE/renderer/vulkan/ProgramExecutableVk.h",
        "patchSetId": 8
      },
      "lineNbr": 107,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-05-26T14:50:29Z",
      "side": 1,
      "message": "`vk::YcbcrConversionDesc` needs to be the key to the hashmap since it fully qualifies the immutable sampler. if the texture attached to a textureUnit is updated then pipeline layout needs to be recreated",
      "parentUuid": "9c3875a8_ffbc92cf",
      "range": {
        "startLine": 107,
        "startChar": 55,
        "endLine": 107,
        "endChar": 74
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5362b1a6_5559aadd",
        "filename": "src/libANGLE/renderer/vulkan/ProgramExecutableVk.h",
        "patchSetId": 8
      },
      "lineNbr": 107,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-05-26T16:05:27Z",
      "side": 1,
      "message": "Doesn\u0027t the `SamplerSerial` also fully identify the immutable sampler? Can you have two immutable samplers with the same serial?",
      "parentUuid": "b84a69af_0061afe9",
      "range": {
        "startLine": 107,
        "startChar": 55,
        "endLine": 107,
        "endChar": 74
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2fc4b753_4b6d7a99",
        "filename": "src/libANGLE/renderer/vulkan/ProgramExecutableVk.h",
        "patchSetId": 8
      },
      "lineNbr": 107,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-05-27T00:16:07Z",
      "side": 1,
      "message": "IIUC, no. A change in texture state (say, going from full range yuv to narrow range without an intervening draw) will not be covered",
      "parentUuid": "5362b1a6_5559aadd",
      "range": {
        "startLine": 107,
        "startChar": 55,
        "endLine": 107,
        "endChar": 74
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "43f874b9_ae770d47",
        "filename": "src/libANGLE/renderer/vulkan/ProgramExecutableVk.h",
        "patchSetId": 8
      },
      "lineNbr": 107,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-05-27T15:25:20Z",
      "side": 1,
      "message": "What GLES commands would implement the \"going from full range yuv to narrow range\"? Trying to understand to best guide the solution.",
      "parentUuid": "2fc4b753_4b6d7a99",
      "range": {
        "startLine": 107,
        "startChar": 55,
        "endLine": 107,
        "endChar": 74
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1af740ce_b8192176",
        "filename": "src/libANGLE/renderer/vulkan/ProgramExecutableVk.h",
        "patchSetId": 8
      },
      "lineNbr": 107,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-05-27T15:43:43Z",
      "side": 1,
      "message": "a layered extension ontop of gl_angle_yuv_internal_format\n\nmoreover, not all samplerSerial changes need pipeline layout recreation. it is only the immutable sampler state that causes the incompatibility",
      "parentUuid": "43f874b9_ae770d47",
      "range": {
        "startLine": 107,
        "startChar": 55,
        "endLine": 107,
        "endChar": 74
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c2e85810_52780041",
        "filename": "src/libANGLE/renderer/vulkan/ProgramExecutableVk.h",
        "patchSetId": 8
      },
      "lineNbr": 107,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-05-27T16:05:21Z",
      "side": 1,
      "message": "Are you sure? When I look at the pipeline layout creation I see:\n\n                const TextureVk *textureVk          \u003d (*activeTextures)[textureUnit];\n                const vk::Sampler \u0026immutableSampler \u003d textureVk-\u003egetSampler().get();\n                descOut-\u003eupdate(info.binding, VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER, arraySize,\n                                activeStages, \u0026immutableSampler);\n\nCombined with the code in `DescriptorSetLayoutDesc::unpackBindings` it really only seems to reference a SamplerVk.",
      "parentUuid": "1af740ce_b8192176",
      "range": {
        "startLine": 107,
        "startChar": 55,
        "endLine": 107,
        "endChar": 74
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a2a20788_6c1a14ef",
        "filename": "src/libANGLE/renderer/vulkan/ProgramExecutableVk.h",
        "patchSetId": 8
      },
      "lineNbr": 107,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-05-27T16:22:22Z",
      "side": 1,
      "message": "\u003e  it really only seems to reference a SamplerVk\n\nthe same samplerVk can embed a different ycbcrsampler based on ycbcrconversiondesc",
      "parentUuid": "c2e85810_52780041",
      "range": {
        "startLine": 107,
        "startChar": 55,
        "endLine": 107,
        "endChar": 74
      },
      "revId": "72ca30415de859a72193e47fb9b385532a7139c0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}