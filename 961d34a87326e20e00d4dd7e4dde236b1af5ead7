{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "1aa8786e_ba3f72e9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-10-08T21:59:39Z",
      "side": 1,
      "message": "This one has some very odd performance impact that I can not really understand. On S20+, with GPU and memory clock locked. I am seeing this CL has quite sizable negative performance effect with Manhattan 3.0 offscreen scores. But seeing performance improvement with on screen scores. The same thing also reproduced without GPU clock locked. And I further narrow down to the VK_PIPELINE_STAGE_VERTEX_SHADER_BIT in the dstSageMask of the barrier for the depth stencil layout change from VK_IMAGE_LAYOUT_DEPTH_STENCIL_ATTACHMENT_OPTIMAL to VK_IMAGE_LAYOUT_DEPTH_STENCIL_READ_ONLY_OPTIMAL. With the bit, I am seeing good performance. Without the bit, performance goes down. This is the exact opposite of what this CL try to fix (and hope to gain the performance) by avoiding the unnecessary 3D\u003d\u003eTA dependency. Does anyone have any explanation on this?",
      "revId": "961d34a87326e20e00d4dd7e4dde236b1af5ead7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d781450a_07b7919f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-10-08T22:04:01Z",
      "side": 1,
      "message": "Maybe we should ask our partners at ARM. Happy to write up an email if you\u0027d like. To me it\u0027s not at all obvious.",
      "parentUuid": "1aa8786e_ba3f72e9",
      "revId": "961d34a87326e20e00d4dd7e4dde236b1af5ead7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "21e623f2_b976731e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-10-08T22:10:46Z",
      "side": 1,
      "message": "yea, I just send out an email as well. Also CC Sunny on the CL.",
      "parentUuid": "d781450a_07b7919f",
      "revId": "961d34a87326e20e00d4dd7e4dde236b1af5ead7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e7474b03_1e7588cc",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 10
      },
      "lineNbr": 779,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-10-09T02:49:28Z",
      "side": 1,
      "message": "Please avoid this. I\u0027m using mDepthStencilImage for invalidate-related reasons in upcoming changes.\n\nAlso, this is definitely a hack just to avoid `finalizeDepthStencilImageLayout` from getting called. If you can make `finalizeDepthStencilImageLayout` do the job, that would be best. Otherwise, you can have `finalizeDepthStencilImageLayout` early out if `mReadOnlyDepthStencilMode` on the pretext that read-only layout is already set here.",
      "revId": "961d34a87326e20e00d4dd7e4dde236b1af5ead7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "358152d9_acb4a580",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 10
      },
      "lineNbr": 779,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-10-13T22:34:53Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e7474b03_1e7588cc",
      "revId": "961d34a87326e20e00d4dd7e4dde236b1af5ead7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "46b4157a_3cffdb2b",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 10
      },
      "lineNbr": 947,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-10-09T02:49:28Z",
      "side": 1,
      "message": "Tim\u0027s comment on the next change got me thinking. What\u0027s the point of this layout? There are no shader stages in it so it can\u0027t be used for feedback loop. Can mReadOnlyDepthStencilMode even be true in this case?\n\n---\n\nEdit: read the other comment",
      "revId": "961d34a87326e20e00d4dd7e4dde236b1af5ead7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "97a8fba6_9aaa7520",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 10
      },
      "lineNbr": 947,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-10-09T19:48:57Z",
      "side": 1,
      "message": "fyi, will respond to you and Tim\u0027s comments after I figure out the performance issue.",
      "parentUuid": "46b4157a_3cffdb2b",
      "revId": "961d34a87326e20e00d4dd7e4dde236b1af5ead7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "210b52fd_249b8df5",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 10
      },
      "lineNbr": 947,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-10-13T22:34:53Z",
      "side": 1,
      "message": "This is try to optimize the case that the depth buffer is used for depth test only. The feedback loop means used by fragment shader stage.",
      "parentUuid": "97a8fba6_9aaa7520",
      "revId": "961d34a87326e20e00d4dd7e4dde236b1af5ead7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5218ab9a_9adce9d6",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 10
      },
      "lineNbr": 947,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2021-05-27T18:09:41Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "210b52fd_249b8df5",
      "revId": "961d34a87326e20e00d4dd7e4dde236b1af5ead7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}