{
  "comments": [
    {
      "key": {
        "uuid": "3fc6c3a0_329c0315",
        "filename": "src/libANGLE/renderer/vulkan/RendererVk.cpp",
        "patchSetId": 8
      },
      "lineNbr": 970,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-01-17T04:45:04Z",
      "side": 1,
      "message": "I think it\u0027s safer if `kVulkanQueuePriorityMedium \u003d queueCount \u003d\u003d 2 ? 0 : 0.5;`. If the driver has two queues, what if it rounds the priority also to 0 and 1 (as the hardware supported priorities), and 0.5 is rounded to 1? Then you end up with the same real hardware priority for the two queues.\n\nSo I suggest either:\n\n- queueCount \u003d 1: priority whatever\n- queueCount \u003d 2: priorities 0 and 1\n- queueCount \u003d 3: priorities 0, 0.4 and 1\n\nOr just:\n\n- an all cases: priorities 0, 0.4 and 1\n\nThe reason I chose 0.4 is to make sure High is always higher priority than medium, even if the hardware supports only 2 priorities (but at least 3 queues). In that case, the hardware may choose to map 0 and 0.4 both to hw priority low and 1 to hw priority high. If at least 3 priorities, 0.4 also lies between 0.33 and 0.66, which means it would still map to the middle priority.\n\nAlso, the second option is less certain that 0.4 and 1 (in case of queueCount \u003d 2) will map to two different hardware priorities, but chances are they would (while with 0.5 it\u0027s not certain).",
      "range": {
        "startLine": 970,
        "startChar": 40,
        "endLine": 970,
        "endChar": 62
      },
      "revId": "924e9a574fd2026bec37c690f79ceae171575236",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "41a00074_fe00ec4e",
        "filename": "src/libANGLE/renderer/vulkan/RendererVk.cpp",
        "patchSetId": 8
      },
      "lineNbr": 970,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2020-01-17T18:05:57Z",
      "side": 1,
      "message": "I was referencing VkSpec 4.3.4 Queue Priority where priority is between 0.0(Lowest) and 1.0 (Highest). \"levels must be spread evenly over the range\". But we don\u0027t know what rounding will be used - up? nearest? down?\nSo I reasoned, and certainly, the more Qs, the lest likely that it will be an implementation. So if we go for medium at 0.33 to 0.40 and expect round up, then we hit most these cases adequately - and avoiding round up to 1.0. OK. I\u0027ll go with 0.40.\n1:Q \u003d {0.0}\n2:Q \u003d {0.0, 1.0}\n3:Q \u003d {0.0, 0.5, 1.0}\n--------------------------------\n4:Q \u003d {0.0, 0.33, 0.66, 1.0}\n5:Q \u003d {0.0, 0.25, 0.5, 0.75, 1.0}\n6:Q \u003d {0.0, 0.0, 0.4, 0.6, 0.8, 1.0}\n7:Q \u003d {0.0, 0.17, 0.33, 0.5, 0.67, 0.83, 1.0}\n8:Q \u003d {0.0, 0.14, 0.29, 0.43, 0.57, 0.71, 0.86, 1.0}",
      "parentUuid": "3fc6c3a0_329c0315",
      "range": {
        "startLine": 970,
        "startChar": 40,
        "endLine": 970,
        "endChar": 62
      },
      "revId": "924e9a574fd2026bec37c690f79ceae171575236",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f6e70e43_47f18e4e",
        "filename": "src/libANGLE/renderer/vulkan/RendererVk.cpp",
        "patchSetId": 8
      },
      "lineNbr": 970,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2020-01-17T18:33:29Z",
      "side": 1,
      "message": "\"levels must be spread evenly over the range\" is the key language in the spec. Given that -\n1. All prioritites in EGL and Vulkan world are hints and not guarantees\n2. EGL only has 3 priority levels\n\ni do not get the concern/issue here at all",
      "parentUuid": "41a00074_fe00ec4e",
      "range": {
        "startLine": 970,
        "startChar": 40,
        "endLine": 970,
        "endChar": 62
      },
      "revId": "924e9a574fd2026bec37c690f79ceae171575236",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "817920c1_26cec992",
        "filename": "src/libANGLE/renderer/vulkan/RendererVk.cpp",
        "patchSetId": 8
      },
      "lineNbr": 970,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-01-17T18:59:21Z",
      "side": 1,
      "message": "@Mohan, they are a hint, because Vulkan doesn\u0027t want expose the exact hardware priority levels. That doesn\u0027t mean the hardware levels are not real. The issue was about the choice of 0.5 as the medium priority. If the hardware only supports 2 priorities, it would necessarily map [0, 0.5) to low and (0.5, 1] to high priority. It\u0027s unclear what happens if the priority is 0.5. The choice of 0.4 makes sure with 2 hw priorities, low and med map to hw low and high maps to hw high. With 3+ hw priorities, low will map to hw low, high to hw high and med to some priority in between.\n\n@Jeff \"we hit most these cases adequately\", well we hit _all_ these cases adequately. Even in the ambiguous case of 6 priority levels ({0.0, 0.2, 0.4, 0.6, 0.8, 1.0}), it doesn\u0027t matter if priority level 2 or 3 is selected as long as it\u0027s neither the lowest nor highest priority.",
      "parentUuid": "f6e70e43_47f18e4e",
      "range": {
        "startLine": 970,
        "startChar": 40,
        "endLine": 970,
        "endChar": 62
      },
      "revId": "924e9a574fd2026bec37c690f79ceae171575236",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "67142e0e_efa4b0b2",
        "filename": "src/libANGLE/renderer/vulkan/RendererVk.cpp",
        "patchSetId": 8
      },
      "lineNbr": 970,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2020-01-17T19:04:28Z",
      "side": 1,
      "message": "If there are 3 Qs, and the ICD does round down, then 0.4 could become 0.0. Then no real medium.",
      "parentUuid": "817920c1_26cec992",
      "range": {
        "startLine": 970,
        "startChar": 40,
        "endLine": 970,
        "endChar": 62
      },
      "revId": "924e9a574fd2026bec37c690f79ceae171575236",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}