{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "74c6bf56_2ee3a593",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1394635
      },
      "writtenOn": "2022-10-14T17:44:00Z",
      "side": 1,
      "message": "- Tests pass locally on OpenGL and OpenGL ES (NV).\n- Tests fail on `android-arm64-test`. I have no way to debug that myself.\n- Geometry and tesselation shader interactions are still not implemented, see https://anglebug.com/5466",
      "revId": "a8babd6f5d460e390a6920531f665932aa14a381",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6772839a_ee868c84",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-10-14T18:01:55Z",
      "side": 1,
      "message": "The failure on QC is probably because the test is using `GL_APPLE_clip_distance`. `GL_APPLE_clip_distance` is enabled now if GLES supports `GL_EXT_clip_cull_distance`, but I see different behavior between GLSL and ESSL output.\n\nOn GLSL, `GL_ARB_cull_distance` is enabled if `GL_EXT_clip_cull_distance` is. On ESSL, `GL_EXT_clip_cull_distance` is enabled only if the shader enables `GL_APPLE_clip_distance`?! What if the shader uses `GL_EXT_clip_cull_distance` directly?\n\nThe test does use `GL_APPLE_clip_distance`, so not sure what the failure is about, but the interaction of the two seems messy. The QC compiler doesn\u0027t recognize the `gl_ClipDistance` builtin, so there\u0027s probably a mistake in how the shader is generated. If you want to do remote debugging, you can add a printf to `ShaderGL.cpp`, run the bot, and look at what shader your code is generating for ESSL.",
      "parentUuid": "74c6bf56_2ee3a593",
      "revId": "a8babd6f5d460e390a6920531f665932aa14a381",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0ead9d90_f8685b52",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1394635
      },
      "writtenOn": "2022-10-14T18:29:17Z",
      "side": 1,
      "message": "- `GL_APPLE_clip_distance` is an ESSL 2.0/3.0 extension that defines only `gl_ClipDistance`.\n- `GL_EXT_clip_cull_distance` is an ESSL 3.0 extension that defines `gl_ClipDistance` and `gl_CullDistance`.\n- OpenGL 3.0 (desktop) defines `gl_ClipDistance` in the core spec.\n- `GL_ARB_cull_distance` is a GLSL extension that defines `gl_CullDistance`.\n- OpenGL 4.5 (desktop) defines `gl_CullDistance` in the core spec.\n\nIf the shader uses `GL_EXT_clip_cull_distance` directly and ANGLE runs on ES then the extension is enabled as usual because of the last catch-all case in `TranslatorESSL::writeExtensionBehavior`.\n\nFWIW, the ESSL shader generated locally looks and runs fine on NV, so I think it\u0027s something Adreno-specific.",
      "parentUuid": "6772839a_ee868c84",
      "revId": "a8babd6f5d460e390a6920531f665932aa14a381",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8d769ca1_ca14c637",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-10-14T18:40:03Z",
      "side": 1,
      "message": "Thanks for the explanation.\n\nOn NV, desktop GLSL is used. So it\u0027s unknown whether this is broken only on QC or all of ES. Over the weekend, I\u0027ll run this on our (limited) Pixel 6 bots and see what happens. If it passes there, you are welcome to create a feature and disable this on QC.",
      "parentUuid": "0ead9d90_f8685b52",
      "revId": "a8babd6f5d460e390a6920531f665932aa14a381",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e7fa4fbc_d41a476c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1394635
      },
      "writtenOn": "2022-10-14T18:54:59Z",
      "side": 1,
      "message": "Thanks.\n\nI think NV drivers are able to create ES context; the run looks like:\n\n```\nNote: Google Test filter \u003d ClipDistanceTest*OpenGLES\n[\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d] Running 8 tests from 1 test suite.\n[----------] Global test environment set-up.\n[----------] 8 tests from ClipDistanceTest\n[ RUN      ] ClipDistanceTest.StateQuery/ES2_OpenGLES\n[       OK ] ClipDistanceTest.StateQuery/ES2_OpenGLES (94 ms)\n[ RUN      ] ClipDistanceTest.StateQuery/ES3_OpenGLES\n[       OK ] ClipDistanceTest.StateQuery/ES3_OpenGLES (92 ms)\n[ RUN      ] ClipDistanceTest.OneClipDistance/ES2_OpenGLES\n[       OK ] ClipDistanceTest.OneClipDistance/ES2_OpenGLES (134 ms)\n[ RUN      ] ClipDistanceTest.OneClipDistance/ES3_OpenGLES\n[       OK ] ClipDistanceTest.OneClipDistance/ES3_OpenGLES (55 ms)\n[ RUN      ] ClipDistanceTest.ThreeClipDistances/ES2_OpenGLES\n[       OK ] ClipDistanceTest.ThreeClipDistances/ES2_OpenGLES (22 ms)\n[ RUN      ] ClipDistanceTest.ThreeClipDistances/ES3_OpenGLES\n[       OK ] ClipDistanceTest.ThreeClipDistances/ES3_OpenGLES (24 ms)\n[ RUN      ] ClipDistanceTest.ThreeClipDistancesRedeclared/ES2_OpenGLES\n[       OK ] ClipDistanceTest.ThreeClipDistancesRedeclared/ES2_OpenGLES (10 ms)\n[ RUN      ] ClipDistanceTest.ThreeClipDistancesRedeclared/ES3_OpenGLES\n[       OK ] ClipDistanceTest.ThreeClipDistancesRedeclared/ES3_OpenGLES (12 ms)\n[----------] 8 tests from ClipDistanceTest (456 ms total)\n\n[----------] Global test environment tear-down\n[\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d] 8 tests from 1 test suite ran. (464 ms total)\n[  PASSED  ] 8 tests.\n```\n\nand dumping the translated shaders shows that they use ES language.",
      "parentUuid": "8d769ca1_ca14c637",
      "revId": "a8babd6f5d460e390a6920531f665932aa14a381",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5676340d_37a5f5da",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1394635
      },
      "writtenOn": "2022-10-14T20:11:50Z",
      "side": 1,
      "message": "Just tested Adreno 540 shader compiler using a native Android app.\n\n1. `gl_ClipDistance` is not available in `es 100` shaders. This is unfortunate but not too wrong: the `GL_EXT_clip_cull_distance` extension requires ES 3.0 after all. Therefore, we cannot expose `GL_APPLE_clip_distance` there.\n\n2. `gl_ClipDistance` cannot be redeclared - compilation fails with \"reserved built-in name\" error (using the vertex shader from `ClipCullDistanceTest.ThreeClipDistancesRedeclared`). This seems to be a violation of the extension spec that says:\n\u003e The `gl_ClipDistance` array is predeclared as unsized and must be explicitly sized by the shader either redeclaring it with a size or implicitly sized by indexing it only with integral constant expressions.\n\nThese two issues cover all shader compilation errors on QC.",
      "parentUuid": "e7fa4fbc_d41a476c",
      "revId": "a8babd6f5d460e390a6920531f665932aa14a381",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "49b09776_7d0aea28",
        "filename": "src/tests/gl_tests/ClipDistanceTest.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1102,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-10-14T18:01:55Z",
      "side": 1,
      "message": "While you\u0027re at it, please take a quick moment to see if the `IsVulkan()` part can be removed.",
      "range": {
        "startLine": 1102,
        "startChar": 23,
        "endLine": 1102,
        "endChar": 37
      },
      "revId": "a8babd6f5d460e390a6920531f665932aa14a381",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "18bafb8e_012840bc",
        "filename": "src/tests/gl_tests/ClipDistanceTest.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1102,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-10-14T18:04:10Z",
      "side": 1,
      "message": "Also please use angle_end2end_test_expectations.txt",
      "parentUuid": "49b09776_7d0aea28",
      "range": {
        "startLine": 1102,
        "startChar": 23,
        "endLine": 1102,
        "endChar": 37
      },
      "revId": "a8babd6f5d460e390a6920531f665932aa14a381",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4fe2ca3d_ad283a89",
        "filename": "src/tests/gl_tests/ClipDistanceTest.cpp",
        "patchSetId": 1
      },
      "lineNbr": 1102,
      "author": {
        "id": 1394635
      },
      "writtenOn": "2022-10-14T18:29:17Z",
      "side": 1,
      "message": "AFAIU, the shader translator frontend does not support `gl_ClipDistance`/`gl_CullDistance` fields in GS and TS, so this test should actually be skipped everywhere.",
      "parentUuid": "18bafb8e_012840bc",
      "range": {
        "startLine": 1102,
        "startChar": 23,
        "endLine": 1102,
        "endChar": 37
      },
      "revId": "a8babd6f5d460e390a6920531f665932aa14a381",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}