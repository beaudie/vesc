{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "e452ec75_6766a7eb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-11-14T15:52:22Z",
      "side": 1,
      "message": "Thanks for the fix",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ee782eae_74c86c1f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2022-11-14T16:48:45Z",
      "side": 1,
      "message": "thanks for fix.",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f33601b8_9b4e0285",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-11-14T18:36:12Z",
      "side": 1,
      "message": "going to land this since it has been verified internally",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1e50e637_0f6f895f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-11-14T18:42:06Z",
      "side": 1,
      "message": "@sywow.choi@samsung.com can you please confirm you have verified this patch internally?",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f36344de_54346585",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1433074
      },
      "writtenOn": "2022-11-14T23:05:27Z",
      "side": 1,
      "message": "Thank you for the review üòä\n\n@Mohan,\nSure. I verified with the change:\nhttps://chromium-review.googlesource.com/c/angle/angle/+/3596045\n\nHowever, that change which is in-review also has some points to be fixed, in file src/libANGLE/renderer/vulkan/linux/gbm/DisplayVkGbm.cpp, generateConfigs() function.\n1) It\u0027s just overwriting the visual id.\n2) I guess kColorFormats\u003d{GL_BGRA8_EXT} will return ARGB8888 by default. But the Weston\u0027s default format is XRGB8888(Not sure need check again..).\n\nI\u0027ll do more check and leave the comments to that change after this change is merged.",
      "parentUuid": "1e50e637_0f6f895f",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "685c116a_1b9f6f44",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-11-14T23:40:04Z",
      "side": 1,
      "message": "thanks, merging this for now",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b640765c_594be664",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2022-11-14T23:42:07Z",
      "side": 1,
      "message": "@sywow.choi@samsung.com please fix bot failures and ping for retry",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "059f5c82_c2d96ebd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2022-11-28T16:24:58Z",
      "side": 1,
      "message": "\"2) I guess kColorFormats\u003d{GL_BGRA8_EXT} will return ARGB8888 by default. But the Weston\u0027s default format is XRGB8888(Not sure need check again..).\"\n\nThere are no X8 in the Vulkan formats, Blending should be off anyway. This should map to VK_FORMAT_A8B8G8R8_UNORM_PACK32VK_FORMAT_A8B8G8R8_UNORM_PACK32 or VK_FORMAT_A8B8G8R8_SRGB_PACK32 as I understand it.",
      "parentUuid": "f36344de_54346585",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "06fa628c_4105a646",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1433074
      },
      "writtenOn": "2022-11-29T06:45:26Z",
      "side": 1,
      "message": "@Jeff\n\u003e There are no X8 in the Vulkan formats, Blending should be off anyway. This should map to VK_FORMAT_A8B8G8R8_UNORM_PACK32VK_FORMAT_A8B8G8R8_UNORM_PACK32 or VK_FORMAT_A8B8G8R8_SRGB_PACK32 as I understand it.\n\nYou\u0027re right. But I meant the fourcc code. \nIf we use GL_BGRA8_EXT internal format to generate config sets and remove the overwriting part from https://chromium-review.googlesource.com/c/angle/angle/+/3596045/44/src/libANGLE/renderer/vulkan/linux/gbm/DisplayVkGbm.cpp#81, the problem will be occurred because the current \u0027GLInternalFormatToGbmFourCCFormat()\u0027 returns GBM_FORMAT_ARGB8888(\u0027AR24\u0027), which has different fourcc code from GBM_FORMAT_XRGB8888(\u0027XR24\u0027). \nThe configs\u0027s visual id will be set as ARGB8888. And also Weston fails to find matched config set at the first time with default fourcc code, XRGB8888. \n### weston-8.0.0/libweston/renderer-gl/egl-glue.c +260\n``` c\nstatic bool\negl_config_pixel_format_matches(struct gl_renderer *gr,\n¬ª   ¬ª   ¬ª   ¬ª   EGLConfig config,\n¬ª   ¬ª   ¬ª   ¬ª   const struct pixel_format_info *pinfo)\n{\n¬ª   static const EGLint attribs[4] \u003d {\n¬ª   ¬ª   EGL_ALPHA_SIZE, EGL_RED_SIZE, EGL_GREEN_SIZE, EGL_BLUE_SIZE\n¬ª   };\n¬ª   const int *argb[4] \u003d {\n¬ª   ¬ª   \u0026pinfo-\u003ebits.a, \u0026pinfo-\u003ebits.r, \u0026pinfo-\u003ebits.g, \u0026pinfo-\u003ebits.b\n¬ª   };\n¬ª   unsigned i;\n¬ª   EGLint value;\n\n¬ª   if (gr-\u003eplatform \u003d\u003d EGL_PLATFORM_GBM_KHR) {\n¬ª   ¬ª   if (!eglGetConfigAttrib(gr-\u003eegl_display, config,\n¬ª   ¬ª   ¬ª   ¬ª   ¬ª   EGL_NATIVE_VISUAL_ID, \u0026value))\n¬ª   ¬ª   ¬ª   return false;\n\n¬ª   ¬ª   return ((uint32_t)value) \u003d\u003d pinfo-\u003eformat;\n¬ª   }\n\n¬ª   for (i \u003d 0; i \u003c 4; i++) {\n¬ª   ¬ª   if (!eglGetConfigAttrib(gr-\u003eegl_display, config,\n¬ª   ¬ª   ¬ª   ¬ª   ¬ª   attribs[i], \u0026value))\n¬ª   ¬ª   ¬ª   return false;\n¬ª   ¬ª   if (value !\u003d *argb[i])\n¬ª   ¬ª   ¬ª   return false;\n¬ª   }\n\n¬ª   return true;\n}\n```",
      "parentUuid": "059f5c82_c2d96ebd",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f41e4dbc_22b7dba3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2022-11-29T18:17:02Z",
      "side": 1,
      "message": "Then I should fix our configs\n\nfrom:\n\negl::ConfigSet DisplayVkGbm::generateConfigs()\n{\n    // Formats and Depth-Stencil for KITT2 project - DPU compatible.\n    const std::array\u003cGLenum, 3\u003e kColorFormats \u003d {GL_BGRA8_EXT, GL_RGB565, GL_RGB10_A2};\n\n\nto:\n\negl::ConfigSet DisplayVkGbm::generateConfigs()\n{\n    // Formats and Depth-Stencil for KITT2 project - DPU compatible.\n    const std::array\u003cGLenum, 3\u003e kColorFormats \u003d {GL_BGRX8_ANGLEX, GL_RGB565, GL_RGB10_A2};\n    \n    \n    yes? Then we get the correct mapping:\n    \n           case GL_BGRX8_ANGLEX:\n            return GBM_FORMAT_XRGB8888;\n            \n    Or should it be:\n    \n        case GL_RGBX8_ANGLE:\n            return GBM_FORMAT_XBGR8888;",
      "parentUuid": "06fa628c_4105a646",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "31cbe17b_6fdf3589",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1433074
      },
      "writtenOn": "2022-11-30T01:03:35Z",
      "side": 1,
      "message": "@Jeff\nCorrect. The `GL_BGRX8_ANGLEX` format should also be added to the `kColorFormats` list. (But not specific to our internal project.)\n\nAnd below are some test results. (Removed overwriting nativevisualID parts.)\n\n1.\n``` c\nconst std::array\u003cGLenum, 1\u003e kColorFormats \u003d {GL_BGRA8_EXT};\n```\n\n* Weston log:\n\u003e [12:08:07.064] Unable to use first choice EGL config with XRGB8888, succeeded with alternate ARGB8888.\n\n2.\n``` c\nconst std::array\u003cGLenum, 1\u003e kColorFormats \u003d {GL_BGRX8_ANGLEX};\n```\n* Weston log:\n\u003e [12:09:56.485] Chosen EGL config details: id:   1 rgba: 8 8 8 0 buf: 24 dep:  0 stcl: 0 int: 0-1 type: win|pbf vis_id: XRGB8888 (0x34325258)\n\nWeston compositor has a fallback logic. But to satisfy exact expectation of Weston compositor, it seems that we need to add `GL_BGRX8_ANGLEX` format to the list.",
      "parentUuid": "f41e4dbc_22b7dba3",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0bd31465_94e6ee42",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1433074
      },
      "writtenOn": "2022-11-30T01:05:59Z",
      "side": 1,
      "message": "The code diff for test 2 as below.\n```c\ndiff --git a/src/libANGLE/renderer/vulkan/linux/gbm/DisplayVkGbm.cpp b/src/libANGLE/renderer/vulkan/linux/gbm/DisplayVkGbm.cpp\nindex fc8f5792b..ae99a47c1 100644\n--- a/src/libANGLE/renderer/vulkan/linux/gbm/DisplayVkGbm.cpp\n+++ b/src/libANGLE/renderer/vulkan/linux/gbm/DisplayVkGbm.cpp\n@@ -60,7 +60,7 @@ egl::ConfigSet DisplayVkGbm::generateConfigs()\n         return {};  // No configuration supported\n     }\n\n-    const std::array\u003cGLenum, 1\u003e kColorFormats \u003d {GL_BGRA8_EXT};\n+    const std::array\u003cGLenum, 1\u003e kColorFormats \u003d {GL_BGRX8_ANGLEX};\n\n     std::vector\u003cGLenum\u003e depthStencilFormats(\n         egl_vk::kConfigDepthStencilFormats,\n@@ -75,12 +75,6 @@ egl::ConfigSet DisplayVkGbm::generateConfigs()\n         egl_vk::GenerateConfigs(kColorFormats.data(), kColorFormats.size(),\n                                 depthStencilFormats.data(), depthStencilFormats.size(), this);\n\n-    for (std::pair\u003cconst EGLint, egl::Config\u003e \u0026cfgEntry : cfgSet)\n-    {\n-        egl::Config \u0026cfg   \u003d cfgEntry.second;\n-        cfg.nativeVisualID \u003d DRM_FORMAT_XRGB8888;\n-    }\n-\n     return cfgSet;\n }\n\n```",
      "parentUuid": "31cbe17b_6fdf3589",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1f43816c_fa266b08",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2022-11-30T22:58:06Z",
      "side": 1,
      "message": "I have the patch, but proxy issues blocking upload",
      "parentUuid": "0bd31465_94e6ee42",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d1c5418e_f2b102be",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1433074
      },
      "writtenOn": "2022-11-30T23:05:52Z",
      "side": 1,
      "message": "Thank you for the patch! üëç",
      "parentUuid": "1f43816c_fa266b08",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "52fb7bc5_269b4685",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2022-12-01T15:58:50Z",
      "side": 1,
      "message": "Sorry for delay:\nhttps://chromium-review.googlesource.com/c/angle/angle/+/4069770\nChange GBM config to format used by Weston compositor",
      "parentUuid": "d1c5418e_f2b102be",
      "revId": "206785d13a7201f5694d1c1c375d1e93155a1a12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}