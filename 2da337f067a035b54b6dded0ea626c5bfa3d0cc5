{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5c473b31_9c52bcb6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 30
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-11-09T18:28:13Z",
      "side": 1,
      "message": "re-LGTM. non-blocking nit.",
      "revId": "2da337f067a035b54b6dded0ea626c5bfa3d0cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1757154d_436cec8e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 30
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-11-09T21:47:30Z",
      "side": 1,
      "message": "No further comments from me. Will let Ian +2.",
      "revId": "2da337f067a035b54b6dded0ea626c5bfa3d0cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d9dbe8e2_b544d218",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 30
      },
      "lineNbr": 0,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-11-10T00:49:57Z",
      "side": 1,
      "message": "Thanks Courtney and Ian\u0027s help on helping out figure out the android bot failures. There are two category failures here. 1) there are 4 dEQP.GLES2 tests and dEQP.GLES3 tests are failing. I think what happened is that there is a limit on the number of literal constants the shader can use. Before this CL, these are uniforms. With this CL, we are using literal constants for the matrix and this pixel2\u0027s \n shader compiler might not doing enough optimization for to remove the literal constants. These tests already are using the maximum number of literal constants, adding more causing the to fail. But there is no error form compiler or angle, so I think there might be a bug in QC driver/compiler there. All these tests passes on pixel4. The second failure is that gles31 tests shard time out. Courtney is able to reproduce it on pixel2 as well. Before my CL, tests takes 228 seconds. With this CL, it takes 482 seconds on my Pixel 2. On my pixel4 devices, there is almost no difference on the test time, both finish around 46 seconds. Again, I believe this is pixel2 driver bug as well. In some way more compile time is expected since this optimization is try to shift the work from run time to compile time. Apparently some driver able to do better than others on the compile time. The tests are doing the opposite of the real apps, that real app spending more time on executing shaders, but bot tests are spending most of time compiling shaders and only draw a small quad. \n\nI am currently doing the full deqp test localy on the pixel4 device, before and after the CL, with the screen auto rotated. If results looks good, my intention is to add a feature flag and disable this on pixel2. If anyone has other ideas/feedback, please feel free to ping me.\n  ",
      "revId": "2da337f067a035b54b6dded0ea626c5bfa3d0cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9896731d_ddee22e2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 30
      },
      "lineNbr": 0,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2020-11-10T01:10:53Z",
      "side": 1,
      "message": "I re-reviewed this CL and LGTM.\n\nCharlie and I have been communicating about testing.  I reproduced and investigated the EGLPreRotation failures that Charlie saw, and filed a bug.  I support the idea of dropping Pixel 2 in cases where the tests pass on Pixel 4.  I\u0027m happy to land this as soon as we believe test results indicate that no regressions are introduced (seems close).  I\u0027ll +2 contingent on good test results.\n\nGreat job!",
      "revId": "2da337f067a035b54b6dded0ea626c5bfa3d0cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "650603f1_c4731407",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 30
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-11-10T04:04:14Z",
      "side": 1,
      "message": "\"maximum number of literal constants\", that\u0027s so ugh. Sounds like it\u0027s not doing constant propagation when specialization constants are specified, which is just terrible.\n\nDoes the feature flag involve putting back the rotation driver uniforms? In that case, I\u0027d much rather see test suppression or disabling pre-rotation on Pixel 2 (preferably the former).",
      "parentUuid": "d9dbe8e2_b544d218",
      "revId": "2da337f067a035b54b6dded0ea626c5bfa3d0cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e497701b_22e17697",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 30
      },
      "lineNbr": 0,
      "author": {
        "id": 1297197
      },
      "writtenOn": "2020-11-10T15:59:01Z",
      "side": 1,
      "message": "\u003e Does the feature flag involve putting back the rotation driver uniforms? In that case, I\u0027d much rather see test suppression or disabling pre-rotation on Pixel 2 (preferably the former).\n\n\nI agree that we don\u0027t want to keep both code paths around to work around a Pixel 2 issue, and suppressing tests seems better since most (all?) apps will never hit the limit.   That also keeps the testing of the specialization constants enabled for all of the other tests, so we catch more issues in precommit, rather than relying on Android\u0027s dEQP to catch issues for us.",
      "parentUuid": "650603f1_c4731407",
      "revId": "2da337f067a035b54b6dded0ea626c5bfa3d0cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0c749d66_9c064fbf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 30
      },
      "lineNbr": 0,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-11-10T17:09:46Z",
      "side": 1,
      "message": "Let me try to identify a few tests that take more than 2 seconds and disable them on pixel2, hopefully that will get us to the finish line.",
      "parentUuid": "e497701b_22e17697",
      "revId": "2da337f067a035b54b6dded0ea626c5bfa3d0cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "54152c22_1095b804",
        "filename": "include/GLSLANG/ShaderLang.h",
        "patchSetId": 30
      },
      "lineNbr": 29,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-11-09T18:28:13Z",
      "side": 1,
      "message": "nit: can increment",
      "range": {
        "startLine": 29,
        "startChar": 25,
        "endLine": 29,
        "endChar": 28
      },
      "revId": "2da337f067a035b54b6dded0ea626c5bfa3d0cc5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}