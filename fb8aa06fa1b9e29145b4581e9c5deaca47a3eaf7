{
  "comments": [
    {
      "key": {
        "uuid": "56b133f1_67856071",
        "filename": "src/libANGLE/renderer/d3d/HLSLCompiler.cpp",
        "patchSetId": 1
      },
      "lineNbr": 137,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2019-01-07T18:59:19Z",
      "side": 1,
      "message": "This isn\u0027t guaranteed to behave the way we want it to. The compiler may (and probably will, I think) decide to postpone the GetLastError() call until after the calls to Err() and operator\u003c\u003c, thus possibly losing the error code. The code needs to be:\n  DWORD last_error \u003d GetLastError();\n  ERR() \u003c\u003c \"LoadLibrary(\" \u003c\u003c D3DCOMPILER_DLL_A \u003c\u003c \") failed: \" \u003c\u003c last_error;",
      "revId": "fb8aa06fa1b9e29145b4581e9c5deaca47a3eaf7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4247bcc9_3bfb4397",
        "filename": "src/libANGLE/renderer/d3d/HLSLCompiler.cpp",
        "patchSetId": 1
      },
      "lineNbr": 137,
      "author": {
        "id": 1105324
      },
      "writtenOn": "2019-01-07T21:02:54Z",
      "side": 1,
      "message": "ERR() generates a stream class that logs the message on its destructor. It\u0027s a bit non-obvious. I just tried it and it logged correctly on Clang.\n\nSee common/debug.h+cpp for reference.\n\nhttps://cs.chromium.org/chromium/src/third_party/angle/src/common/debug.cpp?sq\u003dpackage:chromium\u0026g\u003d0\u0026l\u003d141",
      "parentUuid": "56b133f1_67856071",
      "revId": "fb8aa06fa1b9e29145b4581e9c5deaca47a3eaf7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c4764d4e_2e1cd719",
        "filename": "src/libANGLE/renderer/d3d/HLSLCompiler.cpp",
        "patchSetId": 1
      },
      "lineNbr": 137,
      "author": {
        "id": 1128439
      },
      "writtenOn": "2019-01-07T21:56:06Z",
      "side": 1,
      "message": "My point is that GetLastError() will be called too late. GetLastError() needs to be called immediately after LoadLibrary or else it may end up being the wrong last error.\n\nI hit this years ago when for a while the VC++ alloc functions would clear last error (https://codereview.chromium.org/1320673016 to fix that). Most functions don\u0027t clear last error on success, but some do.\n\nThis pattern is guaranteed to work, but I don\u0027t think the streams variant is:\n    LogError(CreateError::INITIALIZE_ACL_FAILURE, GetLastError());",
      "parentUuid": "4247bcc9_3bfb4397",
      "revId": "fb8aa06fa1b9e29145b4581e9c5deaca47a3eaf7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}