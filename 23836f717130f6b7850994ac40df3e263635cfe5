{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "971fa4aa_5d3966c9",
        "filename": "scripts/run_code_generation.py",
        "patchSetId": 3
      },
      "lineNbr": 145,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-04-02T15:27:47Z",
      "side": 1,
      "message": "The fix for \"unicode\" is open as binary, right? Maybe move that part of the comment up?",
      "revId": "23836f717130f6b7850994ac40df3e263635cfe5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e04b5e4c_e036a293",
        "filename": "scripts/run_code_generation.py",
        "patchSetId": 3
      },
      "lineNbr": 145,
      "author": {
        "id": 1531247
      },
      "writtenOn": "2024-04-02T15:33:28Z",
      "side": 1,
      "message": "This is just a warning if anyone decides to do something else other than crlf-\u003elf on Windows, so I think this is the right place for it.\nOpening file in text mode to calculate md5 is weird in the first place. I think it was done this way to get around crlf. Now there is explicit crlf handling in binary mode and nothing else.",
      "parentUuid": "971fa4aa_5d3966c9",
      "revId": "23836f717130f6b7850994ac40df3e263635cfe5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d20ffb00_0c7c271e",
        "filename": "scripts/run_code_generation.py",
        "patchSetId": 3
      },
      "lineNbr": 145,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-04-02T15:36:08Z",
      "side": 1,
      "message": "I\u0027m not objecting to anything, just saying that the open as binary applies to not just windows, so the comment can move up to be clearer.",
      "parentUuid": "e04b5e4c_e036a293",
      "revId": "23836f717130f6b7850994ac40df3e263635cfe5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "20d53a9d_c1d01255",
        "filename": "scripts/run_code_generation.py",
        "patchSetId": 3
      },
      "lineNbr": 145,
      "author": {
        "id": 1531247
      },
      "writtenOn": "2024-04-02T15:47:04Z",
      "side": 1,
      "message": "The file _should be_ opened in binary mode, there is no point in decoding the file into text just to encode it on the next line (`chunk.encode()` before this CL). It looks like there is something that is concerning you about opening files in binary mode, but I\u0027m not sure what it is?..",
      "parentUuid": "d20ffb00_0c7c271e",
      "revId": "23836f717130f6b7850994ac40df3e263635cfe5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2c727ae0_264bb220",
        "filename": "scripts/run_code_generation.py",
        "patchSetId": 3
      },
      "lineNbr": 145,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-04-02T15:55:09Z",
      "side": 1,
      "message": "No objections there, it was just a tiny suggestion. Let me clarify (see other comment)",
      "parentUuid": "20d53a9d_c1d01255",
      "revId": "23836f717130f6b7850994ac40df3e263635cfe5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e10c41b9_2210b79b",
        "filename": "scripts/run_code_generation.py",
        "patchSetId": 3
      },
      "lineNbr": 149,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-04-02T15:55:09Z",
      "side": 1,
      "message": "```suggestion\n    # Open in binary to avoid unicode differences between platforms\n    with open(fname, \u0027rb\u0027) as f:\n        if sys.platform.startswith(\u0027win\u0027) or sys.platform \u003d\u003d \u0027cygwin\u0027:\n            # Beware: Windows crlf + git behavior\n            hash_md5.update(f.read().replace(b\u0027\\r\\n\u0027, b\u0027\\n\u0027))\n        else:\n            for chunk in iter(lambda: f.read(4096), b\u0027\u0027):\n                hash_md5.update(chunk)\n```",
      "range": {
        "startLine": 143,
        "startChar": 0,
        "endLine": 149,
        "endChar": 38
      },
      "revId": "23836f717130f6b7850994ac40df3e263635cfe5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "71b3af93_017e723a",
        "filename": "scripts/run_code_generation.py",
        "patchSetId": 3
      },
      "lineNbr": 149,
      "author": {
        "id": 1531247
      },
      "writtenOn": "2024-04-02T16:17:10Z",
      "side": 1,
      "message": "Yeah but we\u0027re not opening in binary mode just to avoid unicode differences, we\u0027re doing it to avoid any interpretation of the bytes as text (including \u0027\\r\\n\u0027 or \u0027\\0\u0027 or anything else). That\u0027s essentially how `/usr/bin/md5sum` would compute the md5 of the file. The reason we need to do crlf handling is because on Windows this file (vk.xml) ends up having \\r\\n in it (with git global crlf set to false). This file comes from a different repo and I\u0027m not sure if configuration of that repo might apply. In an ideal world we wouldn\u0027t need the crlf handling hack and would just open the file in binary mode and calculate the md5, but Windows tooling behavior makes it hard due to all that magical crlf conversions that can happen at different stages of file\u0027s life.\n\nI\u0027m not sure how I can make this comment more clear, but IMO opening the file in binary mode is the right thing to do in the first place, so I don\u0027t think we need a comment explaining that.",
      "parentUuid": "e10c41b9_2210b79b",
      "range": {
        "startLine": 143,
        "startChar": 0,
        "endLine": 149,
        "endChar": 38
      },
      "revId": "23836f717130f6b7850994ac40df3e263635cfe5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "31f9238b_1ed70849",
        "filename": "scripts/run_code_generation.py",
        "patchSetId": 3
      },
      "lineNbr": 149,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-04-02T17:23:21Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "71b3af93_017e723a",
      "range": {
        "startLine": 143,
        "startChar": 0,
        "endLine": 149,
        "endChar": 38
      },
      "revId": "23836f717130f6b7850994ac40df3e263635cfe5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}