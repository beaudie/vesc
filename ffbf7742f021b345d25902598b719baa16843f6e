{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "a3cb4f9c_9ad2b035",
        "filename": "src/libANGLE/renderer/d3d/d3d11/DebugAnnotator11.cpp",
        "patchSetId": 5
      },
      "lineNbr": 53,
      "author": {
        "id": 1105284
      },
      "writtenOn": "2022-09-26T17:42:14Z",
      "side": 1,
      "message": "I\u0027d like to avoid referencing gCurrentValidContext if possible, it\u0027s a performance optimization for some other code and doesn\u0027t always exist depending on the platform.\n\nCan we not rely on the context passed in being valid? IMO it\u0027s ok if we can\u0027t log some EGL calls due to no current context.",
      "range": {
        "startLine": 53,
        "startChar": 18,
        "endLine": 53,
        "endChar": 42
      },
      "revId": "ffbf7742f021b345d25902598b719baa16843f6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fbec2a1c_f60aa861",
        "filename": "src/libANGLE/renderer/d3d/d3d11/DebugAnnotator11.cpp",
        "patchSetId": 5
      },
      "lineNbr": 53,
      "author": {
        "id": 1543187
      },
      "writtenOn": "2022-09-27T08:59:48Z",
      "side": 1,
      "message": "But this code is specific to Windows, at least gCurrentValidContext always exists on this platform, doesn\u0027t it?\n\nAlso `setMarker()` doesn\u0027t have `context` as argument. Not sure how we should obtain current context in that function without gCurrentValidContext.",
      "parentUuid": "a3cb4f9c_9ad2b035",
      "range": {
        "startLine": 53,
        "startChar": 18,
        "endLine": 53,
        "endChar": 42
      },
      "revId": "ffbf7742f021b345d25902598b719baa16843f6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "27c68b87_beeda524",
        "filename": "src/libANGLE/renderer/d3d/d3d11/DebugAnnotator11.cpp",
        "patchSetId": 5
      },
      "lineNbr": 53,
      "author": {
        "id": 1543187
      },
      "writtenOn": "2022-10-04T08:51:10Z",
      "side": 1,
      "message": "Hi, @geofflang@chromium.org, @jmadill@chromium.org\nPlease advice, what should we do for `setMarker()` and `getStatus()` if we don\u0027t want to use `gCurrentValidContext`. What could be a best way to know the current context? In those functions, context is not passed in as an argument.\n\nWe cannot reuse single `ID3DUserDefinedAnnotation` for every `Renderer11` either, because it is stored globally and shared by multiple `Renderer11`. If used by a wrong `Renderer11` on a different thread, it will crash saying the device context is being used on multiple threads (`CORRUPTED_MULTITHREADING`).",
      "parentUuid": "fbec2a1c_f60aa861",
      "range": {
        "startLine": 53,
        "startChar": 18,
        "endLine": 53,
        "endChar": 42
      },
      "revId": "ffbf7742f021b345d25902598b719baa16843f6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1a0e250d_f5bacb3c",
        "filename": "src/libANGLE/renderer/d3d/d3d11/DebugAnnotator11.cpp",
        "patchSetId": 5
      },
      "lineNbr": 53,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-10-04T12:07:35Z",
      "side": 1,
      "message": "Hey Quyen, please make a small CL to pass down the current context to setMarker and getStatus, refactoring all the different versions of these in ANGLE. Then rebase this CL on top of that refactor CL. Would that be sufficient?",
      "parentUuid": "27c68b87_beeda524",
      "range": {
        "startLine": 53,
        "startChar": 18,
        "endLine": 53,
        "endChar": 42
      },
      "revId": "ffbf7742f021b345d25902598b719baa16843f6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "00225149_ece99628",
        "filename": "src/libANGLE/renderer/d3d/d3d11/DebugAnnotator11.cpp",
        "patchSetId": 5
      },
      "lineNbr": 53,
      "author": {
        "id": 1543187
      },
      "writtenOn": "2022-10-04T12:45:26Z",
      "side": 1,
      "message": "Currently `setMarker` is being called by `gl::Trace` function. And `gl::Trace` seems to be invoked by:\n- `Display_logError`/`Display_logWarning`\n- `LogMessage::~LogMessage()` which is in turn used by various `ASSERT`, `UNREACHABLE`, etc macros.\n\nI don\u0027t think we can pass the current context to the above places. Are we ok to pass nullptr instead? That means the `annotator-\u003esetMarker` could be a no-op at those points where the macros are used (i.e `ASSERT`, `UNREACHABLE`, etc).",
      "parentUuid": "1a0e250d_f5bacb3c",
      "range": {
        "startLine": 53,
        "startChar": 18,
        "endLine": 53,
        "endChar": 42
      },
      "revId": "ffbf7742f021b345d25902598b719baa16843f6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a5fdeec6_2dcc25f6",
        "filename": "src/libANGLE/renderer/d3d/d3d11/DebugAnnotator11.cpp",
        "patchSetId": 5
      },
      "lineNbr": 53,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2022-10-04T13:07:03Z",
      "side": 1,
      "message": "Yeah if you want to pass nullptr, that\u0027s fine, just leave some comments and make sure you test for nullptr in places where it could be an expected value.",
      "parentUuid": "00225149_ece99628",
      "range": {
        "startLine": 53,
        "startChar": 18,
        "endLine": 53,
        "endChar": 42
      },
      "revId": "ffbf7742f021b345d25902598b719baa16843f6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}