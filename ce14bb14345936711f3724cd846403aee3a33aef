{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "68f9456e_43e66d36",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1340649
      },
      "writtenOn": "2024-05-16T00:35:21Z",
      "side": 1,
      "message": "shabi - bot failures aside, we have encountered apps that perform a program link on different threads with the exact same shaders (either vert or frag or both) causing ANGLE to spawn multiple warmup tasks that end up compiling the same GPL pipelines.\n\nThis is an attempt to deduplicate such tasks and i would like to get your inputs before proceeding further",
      "revId": "ce14bb14345936711f3724cd846403aee3a33aef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "22d26678_dab80db6",
        "filename": "src/libANGLE/renderer/vulkan/ProgramExecutableVk.cpp",
        "patchSetId": 3
      },
      "lineNbr": 883,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-05-16T13:28:55Z",
      "side": 1,
      "message": "FYI, `ShaderState` has `mSourceHash`. If you copy that over to `ProgramExecutableVk` on link, you can use that here instead of doing an expensive hash over the whole SPIR-V. Operating on the assumption that if the source GLSL is the same, generated SPIR-V would be the same too.",
      "revId": "ce14bb14345936711f3724cd846403aee3a33aef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bdaf999e_8da7b71a",
        "filename": "src/libANGLE/renderer/vulkan/ProgramExecutableVk.cpp",
        "patchSetId": 3
      },
      "lineNbr": 889,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-05-16T13:28:55Z",
      "side": 1,
      "message": "If you return a flag and set it in `LinkTaskVk`, you can have `getResult` instead use `ANGLE_PERF_WARNING`. That\u0027s both less spammy, and lets the application control how to deal with the message.\n\nThe warning could be more helpful, like \"Detected multiple programs with the same shaders, which is inefficient. Optimize by sharing the program between contexts\".\n\nOn a similar note, I suggest moving the `mWarmUpTaskSignatures` hash map to the share group (assuming the app you found is using share groups). It\u0027ll likely be rare to hit this with unshared contexts, but if you do, the app\u0027s need for duplicate work is legitimate (and the perf warning won\u0027t apply).",
      "revId": "ce14bb14345936711f3724cd846403aee3a33aef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e31de431_965129a3",
        "filename": "src/libANGLE/renderer/vulkan/vk_renderer.h",
        "patchSetId": 3
      },
      "lineNbr": 1087,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-05-16T13:28:55Z",
      "side": 1,
      "message": "We use `angle::SimpleMutex` now",
      "range": {
        "startLine": 1087,
        "startChar": 4,
        "endLine": 1087,
        "endChar": 14
      },
      "revId": "ce14bb14345936711f3724cd846403aee3a33aef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2a22cde4_5be572ca",
        "filename": "src/libANGLE/renderer/vulkan/vk_renderer.h",
        "patchSetId": 3
      },
      "lineNbr": 1088,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2024-05-16T13:28:55Z",
      "side": 1,
      "message": "`angle::HashMap`",
      "revId": "ce14bb14345936711f3724cd846403aee3a33aef",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}