{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "2beace60_240affbe",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2022-06-10T21:59:53Z",
      "side": 1,
      "message": "I thought the change should be much simpler, mostly a few lines of change:\n \nRenderPassDesc::mHasFramebufferFetch will be set based on ContextVk::mHasFramebufferFetch.\n\nDetecting if we should switch to new mode will change to \nIf(!RenderPassDesc-\u003ehasFramebufferFetch() \u0026\u0026 program_\u003ehasFramebufferFetch())\n{\ncontextVk-\u003eforceFramebufferFetchMode();\n...\n// All other code remains as is, which will close renderPass etc.\n// Next time when you see a program does not have fetch, since context\u0027s fetch is enabled, renderPassDesc will have fetch enabled and the above if() will be false, thus nothing will happen.\n// If the same program also used on another context, same thing will happen on other context. if not, other context will keep non-fetch mode.\n}\n",
      "revId": "b63b30ceccc39252e06a69abc3329953989a1e70",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7f226c80_70673fd6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-06-11T02:20:19Z",
      "side": 1,
      "message": "Instead of switching to framebuffer fetch on first _use_, I do it on first _link_. My reasoning is that switch on first use means a potential render pass break. The performance impact of this is kind of negligible (although would be worst if we ever support multiple open render passes, but nevertheless it\u0027s a one time thing), but I dislike that more because of how it can affect debugging experience.\n\nLike imagine a few years from now a developer is trying to optimize their GL game that\u0027s running on ANGLE, they use AGI, and start inspecting frame 1 and wonder why there\u0027s a render pass break where there shouldn\u0027t be. If they don\u0027t happen to notice that other frames don\u0027t have this render pass break and that it\u0027s rather benign, they may do all sorts of things from getting frustrated to hacks like rendering offscreen once during loading just to get ANGLE to switch to this mode.\n\nIn terms of code maintainability, I also think it\u0027s better if `ContextVk::invalidateProgramExecutableHelper` simply doesn\u0027t have code to break the render pass, rather than a condition that \"we promise\" only runs once.\n\n---\n\nThe change is not really big, but it\u0027s cluttered by random changes. Let me split that up into a cleanup CL.",
      "parentUuid": "2beace60_240affbe",
      "revId": "b63b30ceccc39252e06a69abc3329953989a1e70",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "62ce5c9c_d75260ee",
        "filename": "src/libANGLE/renderer/vulkan/DisplayVk.h",
        "patchSetId": 5
      },
      "lineNbr": 101,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2022-06-10T21:59:53Z",
      "side": 1,
      "message": "Why not be part of context instead of shareGroup? If they only use fetch on one context, there is no need to change other context to be using fetch as well.",
      "range": {
        "startLine": 101,
        "startChar": 9,
        "endLine": 101,
        "endChar": 32
      },
      "revId": "b63b30ceccc39252e06a69abc3329953989a1e70",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c2dc352_22c7388c",
        "filename": "src/libANGLE/renderer/vulkan/DisplayVk.h",
        "patchSetId": 5
      },
      "lineNbr": 101,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-06-11T02:20:19Z",
      "side": 1,
      "message": "So, first, do we agree that multi context and framebuffer fetch is exceedingly rare, if at all used by any app?\n\nI think switching to framebuffer fetch earlier than on first use (i.e. on link, which this CL does) leads to a better experience (see other thread). Trying to keep the other contexts from not switching to framebuffer fetch is an optimization that likely affects no app (while hurting apps that normally use framebuffer fetch).",
      "parentUuid": "62ce5c9c_d75260ee",
      "range": {
        "startLine": 101,
        "startChar": 9,
        "endLine": 101,
        "endChar": 32
      },
      "revId": "b63b30ceccc39252e06a69abc3329953989a1e70",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "72db4c7b_1869098e",
        "filename": "src/libANGLE/renderer/vulkan/DisplayVk.h",
        "patchSetId": 5
      },
      "lineNbr": 101,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2022-06-13T16:53:00Z",
      "side": 1,
      "message": "\u003e do we agree that multi context and framebuffer fetch is exceedingly rare\nAgree. but that could argue the other way around as well, that there is no point to optimize that.\n\nMy main concern is that it is anti-opengl convention. rendering state is context state, and buffer/textures are shared group owned. This framebuffer fetch is a rendering state, so it is reasonable to store it in context. And it is one less pointer indirection to retrieve from context versus from sharedGroup. The other part of concern is that what if app load and compile/link all shaders at launch and only used that program when certain effects are enabled or a certain game level? Not sure if there is real use on that, mostly speculation. (maybe you can find out with app traces we have). \n\nI understand your debugging thing, but I realistic don\u0027t think it is a real problem. No one should expect every frame is the same, especially the first frame where tons of texture load/buffer update/program compile occurring.",
      "parentUuid": "6c2dc352_22c7388c",
      "range": {
        "startLine": 101,
        "startChar": 9,
        "endLine": 101,
        "endChar": 32
      },
      "revId": "b63b30ceccc39252e06a69abc3329953989a1e70",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "53d20978_d11bb8ee",
        "filename": "src/libANGLE/renderer/vulkan/DisplayVk.h",
        "patchSetId": 5
      },
      "lineNbr": 101,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2022-06-15T03:20:46Z",
      "side": 1,
      "message": "\u003e My main concern is that it is anti-opengl convention. rendering state is context state\n\nOk that\u0027s fair. I moved it to context.",
      "parentUuid": "72db4c7b_1869098e",
      "range": {
        "startLine": 101,
        "startChar": 9,
        "endLine": 101,
        "endChar": 32
      },
      "revId": "b63b30ceccc39252e06a69abc3329953989a1e70",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}