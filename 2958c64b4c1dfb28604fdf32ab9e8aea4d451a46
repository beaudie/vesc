{
  "comments": [
    {
      "key": {
        "uuid": "11a66b02_40ca2544",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1806,
      "author": {
        "id": 1002745
      },
      "writtenOn": "2020-09-15T04:15:20Z",
      "side": 1,
      "message": "This can still result in an integer overflow.\nTo prevent it, you\u0027d need the conditions in this order:\nloc \u003e\u003d mMaxUniformLocations ||\nobjectLocationCount \u003e mMaxUniformLocations ||\nloc + objectLocationCount \u003e mMaxUniformLocations",
      "range": {
        "startLine": 1806,
        "startChar": 43,
        "endLine": 1806,
        "endChar": 68
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "566324de_13b90731",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1806,
      "author": {
        "id": 1106294
      },
      "writtenOn": "2020-09-15T04:40:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "11a66b02_40ca2544",
      "range": {
        "startLine": 1806,
        "startChar": 43,
        "endLine": 1806,
        "endChar": 68
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af2149ec_733e5e02",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1806,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-15T09:19:18Z",
      "side": 1,
      "message": "Signed integer overflow has undefined behavior. The compiler can assume overflow doesn\u0027t happen and optimize accordingly, including stripping away the extra checks added before:\n\n    loc \u003e\u003d mMaxUniformLocations ||\n    objectLocationCount \u003e mMaxUniformLocations ||\n\nIf you are guarding against overflow, you need to cast loc and objectLocationCount to unsigned int.",
      "parentUuid": "566324de_13b90731",
      "range": {
        "startLine": 1806,
        "startChar": 43,
        "endLine": 1806,
        "endChar": 68
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a6563cad_79f62f68",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1806,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-15T09:19:53Z",
      "side": 1,
      "message": "\u003cUnresolved\u003e",
      "parentUuid": "af2149ec_733e5e02",
      "range": {
        "startLine": 1806,
        "startChar": 43,
        "endLine": 1806,
        "endChar": 68
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "78729709_18012cbf",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1806,
      "author": {
        "id": 1002767
      },
      "writtenOn": "2020-09-15T12:26:46Z",
      "side": 1,
      "message": "Casting to unsigned simply prevents the undefined behavior from happening, which would silence the UBSAN bot, but it doesn\u0027t prevent the overflow from happening. These if statement conditions actually prevent any overflow from happening.",
      "parentUuid": "a6563cad_79f62f68",
      "range": {
        "startLine": 1806,
        "startChar": 43,
        "endLine": 1806,
        "endChar": 68
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b102e3b0_444ede7e",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1806,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-15T14:03:12Z",
      "side": 1,
      "message": "I\u0027m not saying cast to unsigned then do nothing. The check is good (including `loc \u003e\u003d mMaxUniformLocations || objectLocationCount \u003e mMaxUniformLocations`), just the last part that says `loc + objectLocationCount \u003e mMaxUniformLocations` (which could overflow) needs casts to have well defined behavior.",
      "parentUuid": "78729709_18012cbf",
      "range": {
        "startLine": 1806,
        "startChar": 43,
        "endLine": 1806,
        "endChar": 68
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5f41844c_f2a68a2b",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1806,
      "author": {
        "id": 1402268
      },
      "writtenOn": "2020-09-15T14:25:04Z",
      "side": 1,
      "message": "I don\u0027t think it\u0027s mathematically possible for the last part of the condition to be evaluated with values which would cause an overflow",
      "parentUuid": "b102e3b0_444ede7e",
      "range": {
        "startLine": 1806,
        "startChar": 43,
        "endLine": 1806,
        "endChar": 68
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "64701e42_ac6a57b0",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1806,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-09-15T14:39:03Z",
      "side": 1,
      "message": "No it\u0027s not. That\u0027s why it works when cast to unsigned.\n\nBut, since it\u0027s UB, the optimizer can assume there wouldn\u0027t be an overflow and make assumptions about what it can do to the code that could be wrong. For example, it could test the last  part first, and if the result is not \u003e\u003d mMaxUniformLocations, it could assume the other two conditions are not true either and don\u0027t test them.",
      "parentUuid": "5f41844c_f2a68a2b",
      "range": {
        "startLine": 1806,
        "startChar": 43,
        "endLine": 1806,
        "endChar": 68
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a3d9c60f_d42a1925",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1806,
      "author": {
        "id": 1002745
      },
      "writtenOn": "2020-09-15T14:42:04Z",
      "side": 1,
      "message": "Ah, I see, it\u0027s for optimization purposes. I thought we were still only trying to prevent UB. Yeah, casting to unsigned wouldn\u0027t hurt.",
      "parentUuid": "64701e42_ac6a57b0",
      "range": {
        "startLine": 1806,
        "startChar": 43,
        "endLine": 1806,
        "endChar": 68
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "19a35f66_b27db0c9",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1806,
      "author": {
        "id": 1106294
      },
      "writtenOn": "2020-09-15T17:44:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a3d9c60f_d42a1925",
      "range": {
        "startLine": 1806,
        "startChar": 43,
        "endLine": 1806,
        "endChar": 68
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "80ca554c_72635878",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1822,
      "author": {
        "id": 1002745
      },
      "writtenOn": "2020-09-15T04:15:20Z",
      "side": 1,
      "message": "Same",
      "range": {
        "startLine": 1821,
        "startChar": 12,
        "endLine": 1822,
        "endChar": 51
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ea70d29c_1675e7c0",
        "filename": "src/compiler/translator/ParseContext.cpp",
        "patchSetId": 5
      },
      "lineNbr": 1822,
      "author": {
        "id": 1106294
      },
      "writtenOn": "2020-09-15T04:40:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "80ca554c_72635878",
      "range": {
        "startLine": 1821,
        "startChar": 12,
        "endLine": 1822,
        "endChar": 51
      },
      "revId": "2958c64b4c1dfb28604fdf32ab9e8aea4d451a46",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}