{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "20b02b85_fdb50133",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1359667
      },
      "writtenOn": "2021-09-21T20:46:41Z",
      "side": 1,
      "message": "PTAL",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "de45e189_e7839659",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2021-09-21T20:51:29Z",
      "side": 1,
      "message": "In patch set 3 I tried to put log messages to indicate that the vulkan extension was supported, and to print when switching from multi-image swapchain to a single image swapchain. But, that never prints out. But some suites run the tests without any message. Only those that do not support the extension printed that and printed out \"Not Supported\" by the test. So it doesn\u0027t seem definitive that we have a pass case.",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3dbe6cb6_2bb69490",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2021-09-21T23:59:59Z",
      "side": 1,
      "message": "One missing requirement is the Image needs to transition to SHARED_LAYOUT before first use. - This is not done.",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f9be4c0d_eedc4d28",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2021-09-22T19:37:37Z",
      "side": 1,
      "message": "Spec says:\n\"After acquiring the shared presentable image, the application must transition it to the VK_IMAGE_LAYOUT_SHARED_PRESENT_KHR layout prior to it being used. After this initial transition, any image usage that was requested during swapchain creation can be performed on the image without layout transitions being performed.\"\n\nIf you have guidance where and how best to do this - it would be greatly appreciated.",
      "parentUuid": "3dbe6cb6_2bb69490",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0147f9b_1b5d55b3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-09-24T18:20:25Z",
      "side": 1,
      "message": "Hm, it\u0027s a bit tricky, because it means that internally the ImageHelper needs to know if this is a \"mutable\" image, transition once, then ignore all following image transitions. It\u0027s like a weird form of GENERAL. It\u0027ll interact with all of the image layout ImageHelper APIs. Having a lot of testing with validation layer checks would be recommended. ANGLE calls the image layout APIs throughout, we might need to rethink it to support this usage, not sure.",
      "parentUuid": "f9be4c0d_eedc4d28",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "13cd0ab7_cddfa03b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-09-24T19:15:38Z",
      "side": 1,
      "message": "We can add a new `vk::ImageLayout` entry for that, and make sure image layout transitions from that layout are turned into execution barriers only.",
      "parentUuid": "c0147f9b_1b5d55b3",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "40a3b2b6_3e213a3c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2021-09-24T20:54:02Z",
      "side": 1,
      "message": "I did notice that, I was thinking to add ImageLayout::SharedPresent right after ImageLayout::Present. But where to put the barrier call? I have no clue at this time.\n\nI am supposing that UNDEFINED-\u003eSharedPresent would likely do nothing? After that it just stays that way, which I guess anywhere else it might change and we needed to do something?\n\nWhile the tests are not failing, And I can see logs that say \"Not Supported\u0027 and other logs that just list the dEQP-EGL...render_buffer.* test, I haven\u0027t had a log that says - extension enabled (from by debug messages), transitioned to single image mode (from debug messages), and passed. So I\u0027m not sure if the tests are actually running, or if running and skipping without a message.\n\nThe lack of transition doesn\u0027t seem to cause issue so far, but maybe tests are not fully ran.",
      "parentUuid": "13cd0ab7_cddfa03b",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "beb8de1d_3008d298",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-09-25T02:12:17Z",
      "side": 1,
      "message": "So the barrier-related data go in vk_helpers.cpp in kImageMemoryBarrierData. You should add an entry for ImageLayout::SharedPresent in there. Then you should add a layout transition in the code to that layout.\n\nYou said:\n\n\u003e After this initial transition, any image usage that was requested during swapchain creation can be performed on the image without layout transitions being performed\n\nI have a question here. Is that saying that `SHARED_PRESENT` works for all usage, but also other layouts work? Or is it saying that the image *must* stay in `SHARED_PRESENT`? The former case is easy, and means that ImageLayout::Present and ImageLayout::SharedPresent can be pretty much treated the same. The latter case would require some special-casing in a few places in code that manipulate ImageHelper::mCurrentLayout, ideally such that it\u0027s not a mess.",
      "parentUuid": "40a3b2b6_3e213a3c",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7437137e_4a01fea5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2021-09-27T20:21:23Z",
      "side": 1,
      "message": "My interpretation is that it transitions once to SHARED_PRESENT and stays there.",
      "parentUuid": "beb8de1d_3008d298",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9b414f45_c4410817",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-09-27T21:20:55Z",
      "side": 1,
      "message": "Ok then, when you add `ImageLayout::SharedPresent`, you could try something like this:\n\n     bool ImageHelper::updateLayoutAndBarrier(Context *context,\n                                              VkImageAspectFlags aspectMask,\n                                              ImageLayout newLayout,\n                                              PipelineBarrier *barrier)\n     {\n+        // Once you transition to ImageLayout::SharedPresent, you never transition out of it.\n+        if (mCurrentLayout \u003d\u003d ImageLayout::SharedPresent)\n+        {\n+            newLayout \u003d ImageLayout::SharedPresent;\n+        }\n         bool barrierModified \u003d false;\n         if (newLayout \u003d\u003d mCurrentLayout)\n\nYou can also add an ASSERT in ImageHelper::barrierImpl like this:\n\n    // Make sure we never transition out of SharedPresent\n    ASSERT(mCurrentLayout !\u003d ImageLayout::SharedPresent || newLayout \u003d\u003d ImageLayout::SharedPresent)\n\nYou might need to adjust a few ASSERTs elsewhere too, for example where ImageHelper::clearColor ASSERTs that the layout is TransferDst, it can now also be ImageLayout::SharedPresent.",
      "parentUuid": "7437137e_4a01fea5",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "50021a60_1f8ff02f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2021-09-28T20:49:36Z",
      "side": 1,
      "message": "Done. Added to ImageHelper::resolve(...) also.",
      "parentUuid": "9b414f45_c4410817",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d7d8afcd_31ee5624",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1359249
      },
      "writtenOn": "2021-09-28T20:49:36Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9b414f45_c4410817",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d809dcbe_93a7c5ef",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-11-12T01:58:38Z",
      "side": 1,
      "message": "Ref",
      "parentUuid": "d7d8afcd_31ee5624",
      "revId": "eff967a67f101aef52c33c4b73155592a4f1efc1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}