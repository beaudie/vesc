{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d218ad84_65ecc982",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-10-12T12:38:13Z",
      "side": 1,
      "message": "Thanks for the fix! Is there a way to add a regression test for this? We can test the async command queue in angle_end2end_tests.",
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "124cdfb1_24de6cb0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-12T14:02:14Z",
      "side": 1,
      "message": "I haven\u0027t yet looked into fixing end2end tests to actually test async queue. Maybe this fixes it? :D\n\nhttps://chromium-review.googlesource.com/c/angle/angle/+/3193420",
      "parentUuid": "d218ad84_65ecc982",
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "58c36deb_1025fe8f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1446209
      },
      "writtenOn": "2021-10-14T06:17:16Z",
      "side": 1,
      "message": "I think this null pointer issue can be easy to re-produce when running traces with asynccommandqueue.",
      "parentUuid": "124cdfb1_24de6cb0",
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f6190c81_6ae38371",
        "filename": "src/libANGLE/renderer/vulkan/vk_cache_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 1523,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-12T14:02:14Z",
      "side": 1,
      "message": "Are we losing anything in CPU perf by using unordered_map instead of abseil?\n\nI\u0027m assuming the issue is that we are passing the address of RenderPassHelper::mRenderPass to the worker thread. What if instead we copied that? I realize we generally don\u0027t copy wrapped Vulkan objects, but if it\u0027s a cause of inefficiency/bugs, I think we should find a way to do that. We might want to add a \"weak\" class to make it clear who owns the actual Vulkan object.",
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a57b1387_6107499a",
        "filename": "src/libANGLE/renderer/vulkan/vk_cache_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 1523,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-10-12T14:52:28Z",
      "side": 1,
      "message": "Yeah adding a weak reference class would be the best solution. Maybe in Debug it can keep a back-pointer to the original unique pointer (vk wrapper type) to ensure validity.\n\nIt will add (slight) extra cost to the render pass lookup if we change to unordered_map.",
      "parentUuid": "f6190c81_6ae38371",
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "340bf3a4_ca0f7a9b",
        "filename": "src/libANGLE/renderer/vulkan/vk_cache_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 1523,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-10-12T14:53:01Z",
      "side": 1,
      "message": "Given that this is a bug fix though we might want to land this first with the small perf regression.",
      "parentUuid": "a57b1387_6107499a",
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "072a71a4_b4c27dca",
        "filename": "src/libANGLE/renderer/vulkan/vk_cache_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 1523,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-12T15:03:57Z",
      "side": 1,
      "message": "SGTM",
      "parentUuid": "340bf3a4_ca0f7a9b",
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "74985e0a_213f67e8",
        "filename": "src/libANGLE/renderer/vulkan/vk_cache_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 1523,
      "author": {
        "id": 1446209
      },
      "writtenOn": "2021-10-14T03:39:16Z",
      "side": 1,
      "message": "Shahbaz,yes,you\u0027re right,this is the null renderpass pointer issue,which could be found in https://bugs.chromium.org/p/angleproject/issues/detail?id\u003d6436.",
      "parentUuid": "072a71a4_b4c27dca",
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bf60da4c_40ac014e",
        "filename": "src/libANGLE/renderer/vulkan/vk_cache_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 1523,
      "author": {
        "id": 1446209
      },
      "writtenOn": "2021-10-14T03:43:50Z",
      "side": 1,
      "message": "May I have a commitqueue +2?",
      "parentUuid": "74985e0a_213f67e8",
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6cd50207_fd6f8a76",
        "filename": "src/libANGLE/renderer/vulkan/vk_cache_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 1523,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-14T04:43:47Z",
      "side": 1,
      "message": "I\u0027ll do that. Would you please take care of Jamie\u0027s other comments first?",
      "parentUuid": "bf60da4c_40ac014e",
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "14499c4a_c5320fe0",
        "filename": "src/libANGLE/renderer/vulkan/vk_cache_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 1525,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2021-10-12T12:38:13Z",
      "side": 1,
      "message": "you can take out the #ifdef, if abseil is false this resolves to unordered map. Can you leave a comment about the need for pointer stability?",
      "range": {
        "startLine": 1518,
        "startChar": 0,
        "endLine": 1525,
        "endChar": 0
      },
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8b6c50ad_2a687506",
        "filename": "src/libANGLE/renderer/vulkan/vk_cache_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 1525,
      "author": {
        "id": 1446209
      },
      "writtenOn": "2021-10-14T06:17:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "14499c4a_c5320fe0",
      "range": {
        "startLine": 1518,
        "startChar": 0,
        "endLine": 1525,
        "endChar": 0
      },
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b27f2e67_e19a9c89",
        "filename": "src/libANGLE/renderer/vulkan/vk_cache_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 1525,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-14T13:55:02Z",
      "side": 1,
      "message": "This part is still not done\n\n\u003e you can take out the #ifdef\n\nJamie\u0027s suggestion was to just apply this diff:\n\n-    using InnerCache \u003d angle::HashMap\u003cvk::AttachmentOpsArray, vk::RenderPassHelper\u003e;\n-    using OuterCache \u003d angle::HashMap\u003cvk::RenderPassDesc, InnerCache\u003e;\n+    using InnerCache \u003d std::unordered_map\u003cvk::AttachmentOpsArray, vk::RenderPassHelper\u003e;\n+    using OuterCache \u003d std::unordered_map\u003cvk::RenderPassDesc, InnerCache\u003e;\n\nThat is, unconditionally switch to unordered_map.",
      "parentUuid": "8b6c50ad_2a687506",
      "range": {
        "startLine": 1518,
        "startChar": 0,
        "endLine": 1525,
        "endChar": 0
      },
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee3e1d66_31400be7",
        "filename": "src/libANGLE/renderer/vulkan/vk_cache_utils.h",
        "patchSetId": 1
      },
      "lineNbr": 1525,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2021-10-14T13:55:54Z",
      "side": 1,
      "message": "Ugh, the - signs got itemized. It meant to say:\n\n    -    using InnerCache \u003d angle::HashMap\u003cvk::AttachmentOpsArray, vk::RenderPassHelper\u003e;\n    -    using OuterCache \u003d angle::HashMap\u003cvk::RenderPassDesc, InnerCache\u003e;\n    +    using InnerCache \u003d std::unordered_map\u003cvk::AttachmentOpsArray, vk::RenderPassHelper\u003e;\n    +    using OuterCache \u003d std::unordered_map\u003cvk::RenderPassDesc, InnerCache\u003e;",
      "parentUuid": "b27f2e67_e19a9c89",
      "range": {
        "startLine": 1518,
        "startChar": 0,
        "endLine": 1525,
        "endChar": 0
      },
      "revId": "5a9725460cb48cd464b4a6c32701264a8af40fa0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}