{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "2af784fa_7e974a83",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1557704
      },
      "writtenOn": "2024-08-22T17:08:01Z",
      "side": 1,
      "message": "LGTM. Just curious, did you try building with `angle_enable_vulkan_gpu_trace_events` and running? IIRC, I was still getting a crash similar to b/361570359, but in a different place, after this fix.",
      "revId": "9e5e325d43a9529d6a1995c98558cb978b81c424",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "75a2acea_f1d03cb3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2024-08-22T17:17:48Z",
      "side": 1,
      "message": "PS1 has bug that caused bots to fail. Maybe try it again?",
      "parentUuid": "2af784fa_7e974a83",
      "revId": "9e5e325d43a9529d6a1995c98558cb978b81c424",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "252ef728_e5e41ba5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1557704
      },
      "writtenOn": "2024-08-22T17:18:41Z",
      "side": 1,
      "message": "I\u0027m sorry what\u0027s PS1?",
      "parentUuid": "75a2acea_f1d03cb3",
      "revId": "9e5e325d43a9529d6a1995c98558cb978b81c424",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "975bf2e7_9b139669",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2024-08-22T17:20:03Z",
      "side": 1,
      "message": "Patchset 1. Try with patchset 2.",
      "parentUuid": "252ef728_e5e41ba5",
      "revId": "9e5e325d43a9529d6a1995c98558cb978b81c424",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7fd53900_46db447a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1557704
      },
      "writtenOn": "2024-08-22T20:27:48Z",
      "side": 1,
      "message": "Tried with PS2, this is the stack trace I get:\n\n```\n08-22 19:19:32.643  2429  2429 F DEBUG   : *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***\n08-22 19:19:32.643  2429  2429 F DEBUG   : Build fingerprint: \u0027google/kiwi_x86_64/vsoc_kiwi_x86_64:14/UQ1A.240205.004/eng.gregsc.20240416.152701:userdebug/test-keys\u0027\n08-22 19:19:32.643  2429  2429 F DEBUG   : Revision: \u00270\u0027\n08-22 19:19:32.643  2429  2429 F DEBUG   : ABI: \u0027x86_64\u0027\n08-22 19:19:32.643  2429  2429 F DEBUG   : Timestamp: 2024-08-22 19:19:32.502460399+0000\n08-22 19:19:32.643  2429  2429 F DEBUG   : Process uptime: 1s\n08-22 19:19:32.643  2429  2429 F DEBUG   : Cmdline: com.android.vending\n08-22 19:19:32.643  2429  2429 F DEBUG   : pid: 2326, tid: 2361, name: bgExecutor #1  \u003e\u003e\u003e com.android.vending \u003c\u003c\u003c\n08-22 19:19:32.643  2429  2429 F DEBUG   : uid: 10024\n08-22 19:19:32.643  2429  2429 F DEBUG   : signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0x00007a00831db628\n08-22 19:19:32.643  2429  2429 F DEBUG   :     rax 0000000000000001  rbx 000079f69ae431d8  rcx 000079f8831ce440  rdx 00000000ffffffff\n08-22 19:19:32.643  2429  2429 F DEBUG   :     r8  0000000000000000  r9  0000000000000000  r10 0000000000002238  r11 0000000000000012\n08-22 19:19:32.643  2429  2429 F DEBUG   :     r12 000079f5a9180b18  r13 000079f70ada7e01  r14 000079f69ae432a8  r15 000079f69ae41128\n08-22 19:19:32.643  2429  2429 F DEBUG   :     rdi 000079f88e5d3164  rsi 0000000000000045\n08-22 19:19:32.643  2429  2429 F DEBUG   :     rbp 0000000000000001  rsp 000079f562feedc0  rip 000079f5a93185f6\n08-22 19:19:32.643  2429  2429 F DEBUG   : 38 total frames\n08-22 19:19:32.643  2429  2429 F DEBUG   : backtrace:\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #00 pc 000000000021c5f6  /system/lib64/libGLESv2_angle.so (rx::ContextVk::flushOutsideRenderPassCommands()+854) (BuildId: 999ddf4fe317a2c35e1b432cedc38ab5)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #01 pc 0000000000228bc4  /system/lib64/libGLESv2_angle.so (rx::ContextVk::flushCommandsAndEndRenderPassWithoutSubmit(rx::RenderPassClosureReason)+20) (BuildId: 999ddf4fe317a2c35e1b432cedc38ab5)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #02 pc 000000000021c7e3  /system/lib64/libGLESv2_angle.so (rx::ContextVk::flushImpl(rx::vk::Semaphore const*, rx::vk::Fence const*, rx::RenderPassClosureReason)+291) (BuildId: 999ddf4fe317a2c35e1b432cedc38ab5)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #03 pc 0000000000225a91  /system/lib64/libGLESv2_angle.so (rx::ContextVk::onUnMakeCurrent(gl::Context const*)+17) (BuildId: 999ddf4fe317a2c35e1b432cedc38ab5)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #04 pc 0000000000304b46  /system/lib64/libGLESv2_angle.so (gl::Context::unMakeCurrent(egl::Display const*)+38) (BuildId: 999ddf4fe317a2c35e1b432cedc38ab5)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #05 pc 0000000000303b55  /system/lib64/libGLESv2_angle.so (gl::Context::onDestroy(egl::Display const*)+197) (BuildId: 999ddf4fe317a2c35e1b432cedc38ab5)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #06 pc 00000000003337d0  /system/lib64/libGLESv2_angle.so (egl::Display::releaseContextImpl(gl::Context*, absl::flat_hash_map\u003cunsigned int, gl::Context*, absl::hash_internal::Hash\u003cunsigned int\u003e, std::__1::equal_to\u003cunsigned int\u003e, std::__1::allocator\u003cstd::__1::pair\u003cunsigned int const, gl::Context*\u003e \u003e \u003e*)+480) (BuildId: 999ddf4fe317a2c35e1b432cedc38ab5)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #07 pc 00000000003370ac  /system/lib64/libGLESv2_angle.so (egl::Display::makeCurrent(egl::Thread*, gl::Context*, egl::Surface*, egl::Surface*, gl::Context*)+284) (BuildId: 999ddf4fe317a2c35e1b432cedc38ab5)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #08 pc 0000000000337504  /system/lib64/libGLESv2_angle.so (egl::Display::destroyContext(egl::Thread*, gl::Context*)+452) (BuildId: 999ddf4fe317a2c35e1b432cedc38ab5)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #09 pc 00000000004414ec  /system/lib64/libGLESv2_angle.so (egl::DestroyContext(egl::Thread*, egl::Display*, gl::ContextID)+76) (BuildId: 999ddf4fe317a2c35e1b432cedc38ab5)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #10 pc 00000000004436a8  /system/lib64/libGLESv2_angle.so (EGL_DestroyContext+296) (BuildId: 999ddf4fe317a2c35e1b432cedc38ab5)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #11 pc 0000000000022189  /system/lib64/libEGL.so (android::eglDestroyContextImpl(void*, void*)+57) (BuildId: 2d9709cb2c72846fc4285e0190fa691b)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #12 pc 00000000000ef291  /system/lib64/libandroid_runtime.so (android::jni_eglDestroyContext(_JNIEnv*, _jobject*, _jobject*, _jobject*)+81) (BuildId: d4d12369d2e6886987d524ff07eba3ff)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #13 pc 0000000000202696  /system/framework/x86_64/boot-framework.oat (art_jni_trampoline+166) (BuildId: 4570736cefda1db61827ebd2f6fd3b0138be8eb2)\n08-22 19:19:32.643  2429  2429 F DEBUG   :       #14 pc 0000000000170efd  /apex/com.android.art/lib64/libart.so (nterp_helper+9101) (BuildId: ccdbfbe2face572197fe30076a6a01e1)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #15 pc 00000000001f8684  /product/priv-app/Phonesky/Phonesky.apk (oz.l+4)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #16 pc 000000000016fa08  /apex/com.android.art/lib64/libart.so (nterp_helper+3736) (BuildId: ccdbfbe2face572197fe30076a6a01e1)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #17 pc 0000000000306d2c  /product/priv-app/Phonesky/Phonesky.apk (oby.bB+296)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #18 pc 000000000016f41c  /apex/com.android.art/lib64/libart.so (nterp_helper+2220) (BuildId: ccdbfbe2face572197fe30076a6a01e1)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #19 pc 00000000003058b2  /product/priv-app/Phonesky/Phonesky.apk (oby.U+362)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #20 pc 000000000016eba8  /apex/com.android.art/lib64/libart.so (nterp_helper+56) (BuildId: ccdbfbe2face572197fe30076a6a01e1)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #21 pc 00000000003c0bae  /product/priv-app/Phonesky/Phonesky.apk (ntn.call+182)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #22 pc 0000000000170765  /apex/com.android.art/lib64/libart.so (nterp_helper+7157) (BuildId: ccdbfbe2face572197fe30076a6a01e1)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #23 pc 000000000018d3e4  /product/priv-app/Phonesky/Phonesky.apk (auxh.a+4)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #24 pc 000000000016fa08  /apex/com.android.art/lib64/libart.so (nterp_helper+3736) (BuildId: ccdbfbe2face572197fe30076a6a01e1)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #25 pc 000000000018cbb0  /product/priv-app/Phonesky/Phonesky.apk (auwn.run+36)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #26 pc 000000000016fa08  /apex/com.android.art/lib64/libart.so (nterp_helper+3736) (BuildId: ccdbfbe2face572197fe30076a6a01e1)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #27 pc 000000000018d514  /product/priv-app/Phonesky/Phonesky.apk (auxi.run+8)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #28 pc 00000000002f2a29  /system/framework/x86_64/boot.oat (java.util.concurrent.ThreadPoolExecutor.runWorker+857) (BuildId: 94b4420e503dcd2d26f828df57ea83cbe451a8a6)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #29 pc 00000000002ef4f4  /system/framework/x86_64/boot.oat (java.util.concurrent.ThreadPoolExecutor$Worker.run+68) (BuildId: 94b4420e503dcd2d26f828df57ea83cbe451a8a6)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #30 pc 00000000001707ca  /apex/com.android.art/lib64/libart.so (nterp_helper+7258) (BuildId: ccdbfbe2face572197fe30076a6a01e1)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #31 pc 0000000000271c9c  /product/priv-app/Phonesky/Phonesky.apk (pxa.run+2380)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #32 pc 0000000000175324  /system/framework/x86_64/boot.oat (java.lang.Thread.run+84) (BuildId: 94b4420e503dcd2d26f828df57ea83cbe451a8a6)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #33 pc 0000000000178444  /apex/com.android.art/lib64/libart.so (art_quick_invoke_stub+756) (BuildId: ccdbfbe2face572197fe30076a6a01e1)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #34 pc 00000000001c52dc  /apex/com.android.art/lib64/libart.so (art::ArtMethod::Invoke(art::Thread*, unsigned int*, unsigned int, art::JValue*, char const*)+204) (BuildId: ccdbfbe2face572197fe30076a6a01e1)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #35 pc 00000000006530f6  /apex/com.android.art/lib64/libart.so (art::Thread::CreateCallback(void*)+1510) (BuildId: ccdbfbe2face572197fe30076a6a01e1)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #36 pc 00000000000cc03a  /apex/com.android.runtime/lib64/bionic/libc.so (__pthread_start(void*)+58) (BuildId: de7bbdd3899257619582b2782ea66459)\n08-22 19:19:32.644  2429  2429 F DEBUG   :       #37 pc 0000000000061d58  /apex/com.android.runtime/lib64/bionic/libc.so (__start_thread+56) (BuildId: de7bbdd3899257619582b2782ea66459)\n```\n\nIt\u0027s the same issue as in b/361570359, but with a different stack trace. I believe the change in this CL fixes the original issue and is good to submit, but it\u0027s not sufficient to fully make the GPU events work.",
      "parentUuid": "975bf2e7_9b139669",
      "revId": "9e5e325d43a9529d6a1995c98558cb978b81c424",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e267eb78_7ce145c6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2024-08-22T20:54:53Z",
      "side": 1,
      "message": "Hi Greg, could you put reproduce steps in the bug so that I can reproduce t here?",
      "parentUuid": "7fd53900_46db447a",
      "revId": "9e5e325d43a9529d6a1995c98558cb978b81c424",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "436baa11_e48fe301",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1557704
      },
      "writtenOn": "2024-08-22T22:23:38Z",
      "side": 1,
      "message": "I\u0027m using Battlestar, so I\u0027m not sure how easy it would be for you to reproduce, but here are the steps:\n\n1. Apply your patch to Android\u0027s udc-kiwi-dev branch: https://source.corp.google.com/h/googleplex-android/platform/superproject/udc/+/udc-kiwi-dev:external/angle/src/libANGLE/renderer/vulkan/ContextVk.cpp\n\n2. Modify the Android.bp file here https://source.corp.google.com/h/googleplex-android/platform/superproject/udc/+/udc-kiwi-dev:external/angle/Android.bp;l\u003d808;drc\u003d5179d3cf830dd1f25e739dd4814db9d1694c6a3c to include `\"-DANGLE_ENABLE_VULKAN_GPU_TRACE_EVENTS\u003d1\",`\n\n3. Build the Android image as usual\n\n4. Launch Battlestar with that image.\n\n5. Look for the crash stack trace in Logcat",
      "parentUuid": "e267eb78_7ce145c6",
      "revId": "9e5e325d43a9529d6a1995c98558cb978b81c424",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}