{
  "comments": [
    {
      "key": {
        "uuid": "db5beed3_8da9601c",
        "filename": "src/libANGLE/renderer/vulkan/BufferVk.cpp",
        "patchSetId": 5
      },
      "lineNbr": 510,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-04-28T19:53:11Z",
      "side": 1,
      "message": "This is the access mask of how the data was written to the staging buffer. It was a memcpy, so should remain HOST_WRITE.",
      "range": {
        "startLine": 510,
        "startChar": 37,
        "endLine": 510,
        "endChar": 65
      },
      "revId": "0f1e943fc59ba47ad5971ca010a29a8460ab3061",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e70f1c75_f6c45e63",
        "filename": "src/libANGLE/renderer/vulkan/BufferVk.cpp",
        "patchSetId": 5
      },
      "lineNbr": 510,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-04-28T20:00:40Z",
      "side": 1,
      "message": "Wait no sorry, I misread the function. Something there still looks strange though, as the access type is taken as parameter, but not the stage.",
      "parentUuid": "db5beed3_8da9601c",
      "range": {
        "startLine": 510,
        "startChar": 37,
        "endLine": 510,
        "endChar": 65
      },
      "revId": "0f1e943fc59ba47ad5971ca010a29a8460ab3061",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5e2a3be9_b8bfa12c",
        "filename": "src/libANGLE/renderer/vulkan/BufferVk.cpp",
        "patchSetId": 5
      },
      "lineNbr": 510,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-04-28T20:07:09Z",
      "side": 1,
      "message": "It is handled inside copyFromBuffer. I think some of these APIs should clean up, but I will defer it to another CL for non-functional changes.",
      "parentUuid": "e70f1c75_f6c45e63",
      "range": {
        "startLine": 510,
        "startChar": 37,
        "endLine": 510,
        "endChar": 65
      },
      "revId": "0f1e943fc59ba47ad5971ca010a29a8460ab3061",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d8eeb97c_09495634",
        "filename": "src/libANGLE/renderer/vulkan/BufferVk.cpp",
        "patchSetId": 5
      },
      "lineNbr": 510,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-04-28T20:11:36Z",
      "side": 1,
      "message": "I should stop replying too early. Looks like copyFromBuffer has been a little butchered over time, and the bufferAccessType parameter doesn\u0027t make sense anymore. It should be removed here and hardcoded in the function (after all, the function is doing a transfer from src to dst, so it has all the necessary information).\n\nProbably what\u0027s missing here is something like `onExternalWrite` or maybe:\n\n     ANGLE_TRY(contextVk-\u003eonBufferWrite(VK_ACCESS_HOST_WRITE_BIT, VK_PIPELINE_STAGE_HOST_BIT, mStagingBuffer.getCurrentBuffer()));\n\nbefore `copyFromBuffer` (not sure if onExternalWrite is correct, or even necessary nowadays)\n\n---\n\nIn other words, there is probably stale data in the GPU cache that\u0027s not being invalidated because of a missing barrier whose src access is HOST_WRITE.",
      "parentUuid": "e70f1c75_f6c45e63",
      "range": {
        "startLine": 510,
        "startChar": 37,
        "endLine": 510,
        "endChar": 65
      },
      "revId": "0f1e943fc59ba47ad5971ca010a29a8460ab3061",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "43b96d8e_0816aae3",
        "filename": "src/libANGLE/renderer/vulkan/BufferVk.cpp",
        "patchSetId": 5
      },
      "lineNbr": 510,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-04-28T20:28:06Z",
      "side": 1,
      "message": "I totally agree with you on the hard code bufferAccessType. Lets do it as a follow up CL.\nI just kicked trybot with onExternalWrite to see if fix the issue or not.",
      "parentUuid": "d8eeb97c_09495634",
      "range": {
        "startLine": 510,
        "startChar": 37,
        "endLine": 510,
        "endChar": 65
      },
      "revId": "0f1e943fc59ba47ad5971ca010a29a8460ab3061",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c6be04ef_e206c014",
        "filename": "src/libANGLE/renderer/vulkan/BufferVk.cpp",
        "patchSetId": 5
      },
      "lineNbr": 510,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-04-29T04:32:42Z",
      "side": 1,
      "message": "That\u0027s fine by me, but FYI this is the only user of copyFromBuffer, so the change in this CL might as well be to remove this parameter, instead of changing it.",
      "parentUuid": "43b96d8e_0816aae3",
      "range": {
        "startLine": 510,
        "startChar": 37,
        "endLine": 510,
        "endChar": 65
      },
      "revId": "0f1e943fc59ba47ad5971ca010a29a8460ab3061",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5db00566_605f4e5a",
        "filename": "src/libANGLE/renderer/vulkan/BufferVk.cpp",
        "patchSetId": 5
      },
      "lineNbr": 510,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-04-29T18:08:24Z",
      "side": 1,
      "message": "I am thinking other APIs as well. But anyway let me address this one here to simplify discussion",
      "parentUuid": "c6be04ef_e206c014",
      "range": {
        "startLine": 510,
        "startChar": 37,
        "endLine": 510,
        "endChar": 65
      },
      "revId": "0f1e943fc59ba47ad5971ca010a29a8460ab3061",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cda83809_7631216d",
        "filename": "src/libANGLE/renderer/vulkan/BufferVk.cpp",
        "patchSetId": 5
      },
      "lineNbr": 510,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-04-29T18:28:05Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5db00566_605f4e5a",
      "range": {
        "startLine": 510,
        "startChar": 37,
        "endLine": 510,
        "endChar": 65
      },
      "revId": "0f1e943fc59ba47ad5971ca010a29a8460ab3061",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}