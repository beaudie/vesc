{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "190bb077_8272de72",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-10-07T12:44:18Z",
      "side": 1,
      "message": "Shabi\u0027s doing all the work on this review. :)",
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3f33ec2d_3a00670a",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1498,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-10-07T01:55:47Z",
      "side": 1,
      "message": "You should be able to ASSERT this. If firstShader is Fragment, there can\u0027t be any other stages!",
      "range": {
        "startLine": 1498,
        "startChar": 63,
        "endLine": 1498,
        "endChar": 89
      },
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c1abf5c2_76d929a9",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1498,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-10-07T12:44:18Z",
      "side": 1,
      "message": "+1",
      "parentUuid": "3f33ec2d_3a00670a",
      "range": {
        "startLine": 1498,
        "startChar": 63,
        "endLine": 1498,
        "endChar": 89
      },
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a49427fd_c10ff361",
        "filename": "src/libANGLE/renderer/vulkan/ContextVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 1498,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-10-07T18:20:04Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c1abf5c2_76d929a9",
      "range": {
        "startLine": 1498,
        "startChar": 63,
        "endLine": 1498,
        "endChar": 89
      },
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c5b6979a_85eae1ac",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 4
      },
      "lineNbr": 132,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-10-07T01:55:47Z",
      "side": 1,
      "message": "Didn\u0027t you say that specifying early fragment tests is having a negative effect?",
      "range": {
        "startLine": 132,
        "startChar": 52,
        "endLine": 132,
        "endChar": 94
      },
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38dee488_b73a4d8d",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 4
      },
      "lineNbr": 132,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-10-07T02:21:39Z",
      "side": 1,
      "message": "If there is no shader bit, specifying early fragment test will block fragment shader from start until previous late fragment shader stage finishes. This is addressed in next CL crrev.com/c/2454509",
      "parentUuid": "c5b6979a_85eae1ac",
      "range": {
        "startLine": 132,
        "startChar": 52,
        "endLine": 132,
        "endChar": 94
      },
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "911f24c5_81b6bbf4",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 4
      },
      "lineNbr": 132,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2021-05-26T22:22:13Z",
      "side": 1,
      "message": "I think early fragment test probably won\u0027t be much difference. At least on some GPU I know it actually makes zero difference. We will split it out in future if we find a need.",
      "parentUuid": "38dee488_b73a4d8d",
      "range": {
        "startLine": 132,
        "startChar": 52,
        "endLine": 132,
        "endChar": 94
      },
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc32aee6_ac2fcb87",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 4
      },
      "lineNbr": 158,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-10-07T01:55:47Z",
      "side": 1,
      "message": "It feels like this is rather redundant. If dstStage is EARLY_FRAGMENT_TESTS, it probably doesn\u0027t matter to anyone if it also includes FRAGMENT. In other words, I *think* any usage of this can be replaced with DepthStencilFragmentShaderReadOnly and there wouldn\u0027t be any practical difference.",
      "range": {
        "startLine": 158,
        "startChar": 21,
        "endLine": 158,
        "endChar": 51
      },
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81214682_f4320052",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 4
      },
      "lineNbr": 158,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2020-10-07T12:44:18Z",
      "side": 1,
      "message": "+1",
      "parentUuid": "bc32aee6_ac2fcb87",
      "range": {
        "startLine": 158,
        "startChar": 21,
        "endLine": 158,
        "endChar": 51
      },
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e52ddc3c_a5b9782b",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 4
      },
      "lineNbr": 158,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-10-07T18:20:04Z",
      "side": 1,
      "message": "dstStage is EARLY_FRAGMENT_TESTS or FRAGMENT probably does not matter much. But this layout specifically says that shader is not using it, so it does not have VK_ACCESS_SHADER_READ_BIT which may avoid unnecessary cache invalidation on the shader core. I don\u0027t know how much difference it may have, probably depends on GPU architecture as well. And there is almost no cost for us to have this layout to describe the exact usage, so I think still worth it.",
      "parentUuid": "81214682_f4320052",
      "range": {
        "startLine": 158,
        "startChar": 21,
        "endLine": 158,
        "endChar": 51
      },
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5a61c8dc_45d3dfdc",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 4
      },
      "lineNbr": 775,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-10-07T01:55:47Z",
      "side": 1,
      "message": "Could you explain this change a bit more? It looks unrelated to this CL. Is it fixing something? Optimizing something?",
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "240a468d_459a4666",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 4
      },
      "lineNbr": 775,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-10-07T02:21:39Z",
      "side": 1,
      "message": "This is required. Maybe my comment is not clear enough. The way it works right now is that if there is no feedback loop, the layout is determined at endRenderPass time. But if there is feedback loop, then the texture handling code will pick layout and insert barrier, because updateDescriptorSet needs image\u0027s layout information. Then we should not let endRenderPass to pick layout again (it may pick a different layout because it does not have information of it been used as texture and at which shader stage it is used). This two lines of code is essentially doing that.",
      "parentUuid": "5a61c8dc_45d3dfdc",
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5c608913_caad3310",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 4
      },
      "lineNbr": 775,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2020-10-07T04:33:54Z",
      "side": 1,
      "message": "Ok. Can you ASSERT that `image` is not `mDepthStencilResolveImage`?\n\n        if (!usesImageInRenderPass(*image))\n        {\n            mRenderPassUsedImages.insert(image-\u003egetImageSerial().getValue());\n        }\n        else\n        {\n            // Feedback loop for multisampled-render-to-texture depth/stencil doesn\u0027t make sense.  Renderbuffers cannot be bound as samplers, and depth/stencil textures are entirely transient.\n            ASSERT(image !\u003d mDepthStencilResolveImage);\n            if (image \u003d\u003d mDepthStencilImage) {...}\n        }\n\nDespite what the comment (that I added above) says, MSRTT depth/stencil textures _could_ form a feedback loop, but that\u0027s contrived given that they can\u0027t possibly have meaningful data.",
      "parentUuid": "240a468d_459a4666",
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3367aaaf_2efa32aa",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 4
      },
      "lineNbr": 775,
      "author": {
        "id": 1392020
      },
      "writtenOn": "2020-10-07T18:20:04Z",
      "side": 1,
      "message": "Done. Also reworded the comment with more detail.",
      "parentUuid": "5c608913_caad3310",
      "revId": "265956a5e79e286e95b524f7014546f52a9371c8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}