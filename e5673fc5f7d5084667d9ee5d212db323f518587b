{
  "comments": [
    {
      "key": {
        "uuid": "2395e82b_cdb4e67a",
        "filename": "src/libANGLE/renderer/vulkan/TextureVk.cpp",
        "patchSetId": 3
      },
      "lineNbr": 247,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2019-07-22T17:11:06Z",
      "side": 1,
      "message": "Hopefully we can find a way to nuke this.",
      "range": {
        "startLine": 246,
        "startChar": 0,
        "endLine": 247,
        "endChar": 49
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "54f5a61f_8e9c1eb6",
        "filename": "src/libANGLE/renderer/vulkan/vk_format_utils.cpp",
        "patchSetId": 3
      },
      "lineNbr": 199,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2019-07-22T17:11:06Z",
      "side": 1,
      "message": "requests -\n\n1. don\u0027t need renderer\n2. inline in the header\n3. how about calling this isEmulated or isNative?",
      "range": {
        "startLine": 193,
        "startChar": 0,
        "endLine": 199,
        "endChar": 1
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9961f48d_256806dc",
        "filename": "src/libANGLE/renderer/vulkan/vk_format_utils.cpp",
        "patchSetId": 3
      },
      "lineNbr": 199,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2019-07-23T22:03:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "54f5a61f_8e9c1eb6",
      "range": {
        "startLine": 193,
        "startChar": 0,
        "endLine": 199,
        "endChar": 1
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4ee4b95c_431c2b30",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 3
      },
      "lineNbr": 2159,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2019-07-22T17:11:06Z",
      "side": 1,
      "message": "I think we should do a slow-but-secure path first. Unpack from the pixel to the staging buffer here, then enqueue a staging buffer update. We can implement a direct copy later. We\u0027re focused on feature completion.",
      "range": {
        "startLine": 2157,
        "startChar": 0,
        "endLine": 2159,
        "endChar": 85
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cbabb54d_1f09f476",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 3
      },
      "lineNbr": 2159,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2019-07-23T22:03:47Z",
      "side": 1,
      "message": "To clarify, this is what you consider a \"direct copy\"?\n\nAssuming yes, since we have a direct copy, should we keep this and add the slow-but-secure path (which is what I was planning to do)?  Or, are there enough problems with this implementation that we should just do the slow path now and add the direct copy later?",
      "parentUuid": "4ee4b95c_431c2b30",
      "range": {
        "startLine": 2157,
        "startChar": 0,
        "endLine": 2159,
        "endChar": 85
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9cca7d02_d9cd31e4",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 3
      },
      "lineNbr": 2159,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2019-07-24T12:18:59Z",
      "side": 1,
      "message": "Direct copy won\u0027t happen here. It\u0027ll bypass the pixel buffer. Since the pixel buffer (here) is mainly for updates that can\u0027t use the graph. The slow-but-secure path will happen here. \n\nShabi can you help Ian work through this?",
      "parentUuid": "cbabb54d_1f09f476",
      "range": {
        "startLine": 2157,
        "startChar": 0,
        "endLine": 2159,
        "endChar": 85
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6a7902a8_cdb84292",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 3
      },
      "lineNbr": 2159,
      "author": {
        "id": 1300114
      },
      "writtenOn": "2019-07-24T19:51:10Z",
      "side": 1,
      "message": "Sure.\n\nIan, take a look at `TextureVk::copySubImageImplWithDraw` as an example, there should be two code paths:\n\n    // If destination is valid, copy the source directly into it.\n    if (mImage-\u003evalid())\n    {\n        // Make sure any updates to the image are already flushed.\n        ANGLE_TRY(ensureImageInitialized(contextVk));\n\n        // recordCommands on image, set dependency to buffer and do the copy right now\n    }\n    else\n    {\n        // Allocate staging buffer, copy buffer to staging buffer\n        // Stage the buffer update in the image\n    }\n\nThis should be done outside `ImageHelper::stageSubresourceUpdate`, in `TextureVk::setSubImageImpl` as this CL suggests.\n\nThere is a `stageSubresourceUpdateFromImage` in `ImageHelper` to stage image copies, you would need to add a similar `stageSubresourceUpdateFromBuffer` to stage the prepared buffer in the else case.\n\nYou should be able to undo the changes here.",
      "parentUuid": "9cca7d02_d9cd31e4",
      "range": {
        "startLine": 2157,
        "startChar": 0,
        "endLine": 2159,
        "endChar": 85
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eb04e351_80ed5a8b",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 3
      },
      "lineNbr": 2165,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2019-07-22T17:11:06Z",
      "side": 1,
      "message": "probably should implement this in this CL. Or do this path first.",
      "range": {
        "startLine": 2163,
        "startChar": 1,
        "endLine": 2165,
        "endChar": 43
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bff55fe8_fd8dd10d",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 3
      },
      "lineNbr": 2165,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2019-07-23T22:03:47Z",
      "side": 1,
      "message": "Agreed.",
      "parentUuid": "eb04e351_80ed5a8b",
      "range": {
        "startLine": 2163,
        "startChar": 1,
        "endLine": 2165,
        "endChar": 43
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b228d3aa_73f84b1f",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 3
      },
      "lineNbr": 2183,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2019-07-22T17:11:06Z",
      "side": 1,
      "message": "this should be\n\nelse\n{\n    ASSERT(pixels !\u003d nullptr);\n    ....\n}\n\nNo point in checking in release if we assume a condition.",
      "range": {
        "startLine": 2168,
        "startChar": 0,
        "endLine": 2183,
        "endChar": 0
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6ef3cf11_414279ef",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 3
      },
      "lineNbr": 2183,
      "author": {
        "id": 1290487
      },
      "writtenOn": "2019-07-23T22:03:47Z",
      "side": 1,
      "message": "Not sure I follow.  Given the \"if\" and \"else if\" code above this \"else\" (the \"else if\" checks what you suggest we assert on), do we really need anything here?",
      "parentUuid": "b228d3aa_73f84b1f",
      "range": {
        "startLine": 2168,
        "startChar": 0,
        "endLine": 2183,
        "endChar": 0
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ebdcedbc_e7fd8c10",
        "filename": "src/libANGLE/renderer/vulkan/vk_helpers.cpp",
        "patchSetId": 3
      },
      "lineNbr": 2183,
      "author": {
        "id": 1329751
      },
      "writtenOn": "2019-07-24T12:18:59Z",
      "side": 1,
      "message": "yeah... remove the \"else if (pixels !\u003d nullptr)\"\n\njust make it \"else\".\n\nThis will save one \"if\" check.",
      "parentUuid": "6ef3cf11_414279ef",
      "range": {
        "startLine": 2168,
        "startChar": 0,
        "endLine": 2183,
        "endChar": 0
      },
      "revId": "e5673fc5f7d5084667d9ee5d212db323f518587b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}